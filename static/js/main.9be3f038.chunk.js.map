{"version":3,"sources":["wallet-adapters/ledger/core.ts","assets/logo.png","utils/utils.tsx","utils/fetch-loop.tsx","utils/connection.tsx","components/Link.js","utils/notifications.tsx","wallet-adapters/types.ts","wallet-adapters/ledger/index.tsx","wallet-adapters/phantom/index.tsx","wallet-adapters/math/index.tsx","wallet-adapters/solflare-extension/index.tsx","utils/wallet.tsx","wallet-adapters/sollet-extension/index.tsx","global_style.ts","components/ErrorBoundary.jsx","utils/send.tsx","utils/tokens.tsx","utils/bonfidaConnector.tsx","utils/markets.tsx","utils/useInterval.tsx","components/layout/FloatingElement.jsx","components/Orderbook.jsx","utils/usePrevious.tsx","components/layout/DataTable.jsx","utils/referrer.tsx","components/UserInfoTable/BalancesTable.jsx","components/UserInfoTable/OpenOrderTable.tsx","components/UserInfoTable/FillsTable.jsx","components/UserInfoTable/FeesTable.js","components/UserInfoTable/index.jsx","components/DepositDialog.jsx","components/StandaloneTokenAccountSelect.tsx","components/LinkAddress.tsx","utils/preferences.tsx","components/StandaloneBalancesDisplay.tsx","components/TradeForm.tsx","components/TradesTable.tsx","components/DeprecatedMarketsInstructions.js","pages/TradePage.tsx","components/WalletConnect.tsx","pages/OpenOrdersPage.tsx","components/UserInfoTable/WalletBalancesTable.tsx","pages/BalancesPage.tsx","components/Settings.jsx","components/CustomClusterEndpointDialog.tsx","components/AppSearch.tsx","components/TopBar.tsx","components/BasicLayout.js","routes.tsx","App.tsx","serviceWorker.js","index.js"],"names":["ledgerSend","transport","instruction","p1","payload","a","p2","payloadOffset","length","chunk","slice","console","log","toString","send","Error","reply","harden","n","getSolanaDerivationPath","account","change","undefined","derivationPath","Buffer","alloc","offset","writeUInt8","writeUInt32BE","signTransaction","transaction","messageBytes","serializeMessage","signBytes","bytes","numPaths","concat","getPublicKey","publicKeyBytes","PublicKey","module","exports","sleep","ms","Promise","resolve","setTimeout","percentFormat","Intl","NumberFormat","style","minimumFractionDigits","maximumFractionDigits","floorToDecimal","value","decimals","Math","floor","roundToDecimal","round","getDecimalCount","isNaN","includes","split","parseInt","divideBnToNumber","numerator","denominator","quotient","div","toNumber","rem","umod","gcd","getTokenMultiplierFromDecimals","BN","pow","localStorageListeners","useLocalStorageStringState","key","defaultState","state","localStorage","getItem","useState","notify","useEffect","push","filter","listener","setState","useCallback","newState","removeItem","setItem","forEach","useLocalStorageState","JSON","stringify","stringState","setStringState","useMemo","parse","abbreviateAddress","address","size","base58","toBase58","isEqual","obj1","obj2","keys","Object","k","pageLoadTime","Date","globalCache","Map","FetchLoopListener","cacheKey","fn","refreshInterval","refreshIntervalOnError","callback","cacheNullValues","this","FetchLoopInternal","timeoutId","listeners","errors","refresh","clearTimeout","stopped","errored","data","set","notifyListeners","warn","waitTime","min","timeSincePageLoad","document","visibilityState","hasFocus","random","Set","map","refreshIntervalsOnError","x","previousRefreshInterval","add","assert","delete","globalLoops","loops","has","get","addListener","loop","removeListener","all","values","useAsyncData","asyncFn","useReducer","i","rerender","loaded","refreshCache","clearCache","ENDPOINTS","name","endpoint","custom","accountListenerCount","ConnectionContext","React","createContext","ConnectionProvider","children","setEndpoint","customEndpoints","setCustomEndpoints","availableEndpoints","connection","Connection","sendConnection","id","onAccountChange","Account","publicKey","removeAccountChangeListener","onSlotChange","removeSlotChangeListener","Provider","useConnection","context","useContext","useSendConnection","useConnectionConfig","endpointInfo","find","info","useAccountInfo","tuple","getAccountInfo","accountInfo","count","previousInfo","subscriptionId","equals","lamports","initializeOnly","setCache","currentItem","previousInfoRef","useRef","current","useAccountData","Link","external","props","to","rest","href","target","rel","message","description","txid","type","placement","color","notification","opacity","backgroundColor","DEFAULT_PUBLIC_KEY","LedgerWalletAdapter","_connecting","_publicKey","_transport","transactions","result","signed","signature","addSignature","TransportWebUSB","create","emit","disconnect","close","EventEmitter","PhantomWalletAdapter","_handleConnect","args","_handleDisconnect","connect","bind","window","solana","isPhantom","_provider","isConnected","autoApprove","signAllTransactions","open","on","MathWalletAdapter","_onProcess","_connected","isMathWallet","getAccount","then","catch","finally","SolflareExtensionWalletAdapter","off","solflare","isSolflare","ASSET_URL","WALLET_PROVIDERS","url","icon","adapter","_","network","sollet","Wallet","WalletContext","WalletProvider","autoConnect","setAutoConnect","providerUrl","setProviderUrl","provider","wallet","setWallet","updateWallet","readyState","removeEventListener","addEventListener","connected","setConnected","walletPublicKey","substring","isModalVisible","setIsModalVisible","select","providerName","title","okText","visible","okButtonProps","display","onCancel","width","onClick","alt","height","src","marginRight","textAlign","marginBottom","useWallet","setProvider","GlobalStyle","createGlobalStyle","Title","Typography","ErrorBoundary","hasError","level","error","Component","createTokenAccountTransaction","mintPublicKey","Token","getAssociatedTokenAddress","ASSOCIATED_TOKEN_PROGRAM_ID","TOKEN_PROGRAM_ID","ata","Transaction","createAssociatedTokenAccountInstruction","newAccountPubkey","settleFunds","market","openOrders","baseCurrencyAccount","quoteCurrencyAccount","sendNotification","usdcRef","usdtRef","baseCurrencyAccountPubkey","pubkey","quoteCurrencyAccountPubkey","baseMintAddress","createAccountTransaction","quoteMintAddress","referrerQuoteWallet","supportsReferralFees","usdt","TOKEN_MINTS","usdc","makeSettleFundsTransaction","settleFundsTransaction","settleFundsSigners","signers","mergeTransactions","sendTransaction","sendingMessage","settleAllFunds","tokenAccounts","markets","selectedTokenAccounts","programIds","reduce","cumulative","m","_programId","programId","p","getOpenOrdersAccountsForProgramId","OpenOrders","findForOwner","openOrdersAccounts","baseTokenFree","quoteTokenFree","openOrdersAccountsForProgramIds","accounts","openOrdersAccount","_decoded","ownAddress","isZero","baseMint","quoteMint","selectedBaseTokenAccount","getSelectedTokenAccountForMint","selectedQuoteTokenAccount","settleTransactions","t","signer","s","cancelOrder","params","cancelOrders","orders","order","makeMatchOrdersTransaction","makeCancelOrderInstruction","placeOrder","side","price","orderType","feeDiscountPubkey","formattedMinOrderSize","minOrderSize","toFixed","formattedTickSize","tickSize","isIncrement","num","step","abs","owner","payer","matchOrderstransaction","startTime","getUnixTs","makePlaceOrderTransaction","placeOrderTx","placeOrderSigners","endTime","getTime","sentMessage","successMessage","timeout","signedTransaction","sendSignedTransaction","getRecentBlockhash","recentBlockhash","blockhash","setSigners","partialSign","rawTransaction","serialize","sendRawTransaction","skipPreflight","done","awaitTransactionSignatureConfirmation","simulateResult","simulateTransaction","err","logs","line","startsWith","parsedErrorInfo","parseInstructionErrorResponse","parsedError","reject","onSignature","e","getSignatureStatuses","signatureStatuses","confirmations","resultDescription","AccountInfoResult","struct","executable","rentEpoch","GetMultipleAccountsAndContextRpcResult","array","union","jsonRpcVersion","literal","jsonrpc","jsonRpcResult","slot","getMultipleSolanaAccounts","publicKeys","commitment","_rpcRequest","unsafeRes","res","join","from","fromEntries","_recentBlockhash","_disableBlockhashCaching","signData","wireTransaction","_serialize","encodedTransaction","encoding","ACCOUNT_LAYOUT","BufferLayout","MINT_LAYOUT","parseTokenAccountData","decode","mint","amount","parseTokenMintData","initialized","supply","getOwnedAccountsFilters","memcmp","offsetOf","dataSize","span","getOwnedTokenAccounts","filters","getProgramAccounts","resp","getTokenAccountInfo","ownerAddress","splAccounts","parsedSplAccounts","effectiveMint","WRAPPED_SOL_MINT","useMintInfos","useTokenAccounts","useAllMarkets","allMarkets","allMints","marketInfo","uniqueMints","stringMint","mintInfos","entries","BonfidaApi","path","fetch","URL","response","ok","json","responseJson","success","marketAddress","USE_MARKETS","MARKETS","customMarkets","useCustomMarkets","getMarketInfos","Market","load","marketName","_VERY_SLOW_REFRESH_INTERVAL","useUnmigratedOpenOrdersAccounts","deprecatedOpenOrdersAccounts","deprecatedProgramIds","Array","deprecated","publicKeyStr","baseTokenTotal","quoteTokenTotal","some","MarketContext","DEFAULT_MARKET","getMarketDetails","otherMarket","baseCurrency","token","baseLabel","quoteCurrency","quoteLabel","setCustomMarkets","MarketProvider","setMarketAddress","marketInfos","setMarket","getTradePageUrl","saved","useSelectedTokenAccounts","useMarket","useMarkPrice","markPrice","setMarkPrice","useOrderbook","orderbook","trades","limit","_useUnfilteredTrades","eventFlags","maker","trade","useTrades","bb","bids","Number","ba","asks","last","sort","b","getUnfilteredTrades","loadFills","useOrderbookAccounts","bidData","askData","bidOrderbook","Orderbook","askOrderbook","depth","getL2","useOpenOrdersAccounts","fast","getOpenOrdersAccounts","findOpenOrdersAccountsForOwner","useSelectedOpenOrdersAccount","selectedPubKey","filtered","useSelectedQuoteCurrencyAccount","mintAddress","useSelectedBaseCurrencyAccount","useSelectedQuoteCurrencyBalances","TokenInstructions","quoteSplSizeToNumber","useSelectedBaseCurrencyBalances","baseSplSizeToNumber","useLocallyStoredFeeDiscountKey","storedFeeDiscountKey","setStoredFeeDiscountKey","useFeeDiscountKeys","findFeeDiscountKeys","feeDiscountKey","useAllOpenOrdersBalances","useMarketInfos","stringProgramId","flat","useAllOpenOrdersAccounts","loadedOpenOrdersAccounts","mintInfosConnected","marketsByAddress","openOrdersBalances","baseMintInfo","baseFree","baseTotal","quoteMintInfo","quoteFree","quoteTotal","free","total","useBalances","baseCurrencyBalances","quoteCurrencyBalances","baseExists","quoteExists","coin","sub","unsettled","useUnmigratedDeprecatedMarkets","marketsList","deps","getMarket","openOrdersList","customMarketsInfo","useInterval","delay","savedCallback","setInterval","clearInterval","Wrapper","styled","FloatingElement","stretchVertical","SizeTitle","Row","MarkPriceTitle","Line","css","Price","smallScreen","onPrice","onSize","currentOrderbookData","lastOrderbookData","orderbookData","setOrderbookData","getCumulativeOrderbookSide","totalSize","backwards","cumulativeSize","sizePercent","reverse","sum","index","bidsToDisplay","asksToDisplay","flex","overflow","OrderbookRow","onPriceClick","onSizeClick","MarkPriceComponent","memo","element","classList","contains","remove","formattedSize","formattedPrice","ref","data-width","data-bgcolor","prevProps","nextProps","previousMarkPrice","usePrevious","markPriceColor","formattedMarkPrice","justify","ArrowUpOutlined","ArrowDownOutlined","DataTable","dataSource","columns","emptyLabel","pagination","loading","pageSize","renderEmpty","padding","justifyContent","alignItems","ReferrerContext","USDC_MINT","USDT_MINT","findAssociatedTokenAddress","walletAddress","tokenMintAddress","findProgramAddress","toBuffer","SOL_TLD_AUTHORITY","getInputKey","input","getHashedName","hashed_input_name","getNameAccountKey","inputDomainKey","hashedInputName","ReferrerProvider","allowRefLink","process","REACT_APP_ALLOW_REF_LINK","refCode","setRefCode","setUsdc","setUsdt","usdcAddress","usdtAddress","replace","NameRegistryState","retrieve","nameRegistryState","getTwitterRegistry","usdcAccountInfo","usdtAccountInfo","useFeesAccountsFromRefCode","useReferrer","BalancesTable","balances","showMarket","hideWalletBalance","onSettleSuccess","dataIndex","render","ghost","onSettleFunds","CancelButton","Button","OpenOrderTable","onCancelSuccess","marketFilter","cancelId","setCancelId","orderId","marketFilters","orderInfos","text","onFilter","record","indexOf","fontWeight","charAt","toUpperCase","sorter","showSorterTooltip","DeleteOutlined","cancel","FillsTable","fills","fill","useFills","liquidity","FeesTable","feeTier","row","marginLeft","format","getFeeRates","taker","SRM_MINT","MSRM_MINT","marginTop","FeeScheduleTable","balance","Paragraph","TabPane","Tabs","Index","paddingTop","defaultActiveKey","tab","supportsSrmFeeDiscounts","OpenOrdersTab","filterForOpenOrders","useOpenOrders","BalancesTab","DepositDialog","coinMint","depositCoin","onClose","baseOrQuote","onOk","StandaloneTokenAccountsSelect","selectedValue","label","setSelectedTokenAccounts","Fragment","onSelect","newSelectedTokenAccounts","Option","Text","code","shape","CopyOutlined","navigator","clipboard","writeText","LinkAddress","shorten","LinkOutlined","cursor","PreferencesContext","PreferencesProvider","autoSettleEnabled","setAutoSettleEnabled","marketInfoList","currentlyFetchingMarkets","setCurrentlyFetchingMarkets","setMarkets","addToMarketsMap","marketId","prev","autoSettle","fetchMarkets","RowBox","Tip","ActionButton","StandaloneBalancesDisplay","setBaseOrQuote","lastSettledAt","setLastSettledAt","now","formattedBalances","currency","borderColor","content","trigger","InfoCircleOutlined","align","paddingBottom","block","SellButton","BuyButton","sliderMarks","0","25","50","75","100","TradeForm","setChangeOrderRef","setSide","postOnly","setPostOnly","ioc","setIoc","baseSize","setBaseSize","quoteSize","setQuoteSize","setPrice","submitting","setSubmitting","sizeFraction","setSizeFraction","quoteBalance","baseBalance","sizeDecimalCount","priceDecimalCount","doChangeOrder","onSliderChange","updateSizeFraction","warmUpCache","findBestFeeDiscountKey","onSetBaseSize","usePrice","maxSize","parseFloat","newSize","formatted","onSubmit","flexDirection","Group","onChange","buttonStyle","background","addonBefore","suffix","fontSize","compact","onSetQuoteSize","tipFormatter","marks","checked","disabled","PublicTrades","getRecentTrades","useBonfidaTrades","minHeight","maxHeight","paddingRight","overflowY","time","toLocaleTimeString","DeprecatedMarketsInstructions","switchToLiveMarkets","openOrderAccountBalances","inOrdersBase","inOrdersQuote","unsettledBase","unsettledQuote","useBalancesForDeprecatedMarkets","marketsAndOrders","getOrders","loadOrdersForOwner","refreshOpenOrders","useGetOpenOrdersForDeprecatedMarkets","needToCancelOrders","filteredBalances","needToSettleFunds","Select","OptGroup","TradePage","useParams","history","useHistory","TradePageInner","handleDeprecated","setHandleDeprecated","deprecatedMarkets","innerHeight","innerWidth","dimensions","setDimensions","changeOrderRef","handleResize","componentProps","onChangeOrderRef","component","paddingLeft","gutter","MarketSelector","placeholder","onDeleteCustomMarket","extractBase","extractQuote","selectedMarket","proposedMarket","showSearch","optionFilterProp","listHeight","filterOption","option","toLowerCase","nanoid","stopPropagation","nativeEvent","stopImmediatePropagation","DeprecatedMarketsPage","RenderSmall","RenderSmaller","xs","sm","WalletConnect","menu","Item","overlay","OpenOrdersPage","setLoaded","setRefresh","setOpenOrders","lastRefresh","setLastRefresh","_openOrders","getOpenOrdersForMarket","getAllOpenOrders","useAllOpenOrders","marketAddressesToNames","WalletBalancesTable","walletBalances","tokenAccountsConnected","allMarketsConnected","settlingFunds","setSettlingFunds","walletBalance","BalancesPage","parsedAccount","mintInfo","additionalAmount","useWalletBalancesForAllMarkets","mintToTickers","useMintToTickers","openOrdersFree","openOrdersTotal","Settings","usePreferences","CustomClusterEndpointDialog","testingConnection","onAddCustomEndpoint","customEndpoint","setCustomEndpoint","customEndpointName","setCustomEndpointName","onDoClose","canSubmit","appsAndTokens","apps","tags","AppSearch","searchMatches","setSearchMatches","searchValue","setSearchValue","handleClear","options","d","allowClear","focussed","onSearch","filteredApps","app","searchString","lowerSearchStr","tag","matchApp","onClear","onFocus","onBlur","notFoundContent","transition","dropdownStyle","dropdownMatchSelectWidth","suffixIcon","SearchOutlined","focus","LogoWrapper","EXTERNAL_LINKS","TopBar","addEndpointVisible","setAddEndpointVisible","setTestingConnection","location","useLocation","searchFocussed","setSearchFocussed","handleClick","endpointInfoCustom","handler","tradePageUrl","pathname","handleError","getBlockTime","newCustomEndpoints","logo","mode","selectedKeys","borderBottom","margin","SubMenu","PlusCircleOutlined","SettingOutlined","Header","Layout","Content","BasicLayout","search","parsed","queryString","Routes","basename","exact","App","fallback","Boolean","hostname","match","ReactDOM","StrictMode","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.9be3f038.chunk.js","sourcesContent":["import type Transport from '@ledgerhq/hw-transport';\r\nimport type { Transaction } from '@solana/web3.js';\r\n\r\nimport { PublicKey } from '@solana/web3.js';\r\n\r\nconst INS_GET_PUBKEY = 0x05;\r\nconst INS_SIGN_MESSAGE = 0x06;\r\n\r\nconst P1_NON_CONFIRM = 0x00;\r\nconst P1_CONFIRM = 0x01;\r\n\r\nconst P2_EXTEND = 0x01;\r\nconst P2_MORE = 0x02;\r\n\r\nconst MAX_PAYLOAD = 255;\r\n\r\nconst LEDGER_CLA = 0xe0;\r\n\r\n/*\r\n * Helper for chunked send of large payloads\r\n */\r\nasync function ledgerSend(\r\n  transport: Transport,\r\n  instruction: number,\r\n  p1: number,\r\n  payload: Buffer,\r\n) {\r\n  let p2 = 0;\r\n  let payloadOffset = 0;\r\n\r\n  if (payload.length > MAX_PAYLOAD) {\r\n    while (payload.length - payloadOffset > MAX_PAYLOAD) {\r\n      const chunk = payload.slice(payloadOffset, payloadOffset + MAX_PAYLOAD);\r\n      payloadOffset += MAX_PAYLOAD;\r\n      console.log(\r\n        'send',\r\n        (p2 | P2_MORE).toString(16),\r\n        chunk.length.toString(16),\r\n        chunk,\r\n      );\r\n      const reply = await transport.send(\r\n        LEDGER_CLA,\r\n        instruction,\r\n        p1,\r\n        p2 | P2_MORE,\r\n        chunk,\r\n      );\r\n      if (reply.length !== 2) {\r\n        throw new Error('Received unexpected reply payload');\r\n      }\r\n      p2 |= P2_EXTEND;\r\n    }\r\n  }\r\n\r\n  const chunk = payload.slice(payloadOffset);\r\n  console.log('send', p2.toString(16), chunk.length.toString(16), chunk);\r\n  const reply = await transport.send(LEDGER_CLA, instruction, p1, p2, chunk);\r\n\r\n  return reply.slice(0, reply.length - 2);\r\n}\r\n\r\nconst BIP32_HARDENED_BIT = (1 << 31) >>> 0;\r\nfunction harden(n: number = 0) {\r\n  return (n | BIP32_HARDENED_BIT) >>> 0;\r\n}\r\n\r\nexport function getSolanaDerivationPath(account?: number, change?: number) {\r\n  var length;\r\n  if (account !== undefined) {\r\n    if (change !== undefined) {\r\n      length = 4;\r\n    } else {\r\n      length = 3;\r\n    }\r\n  } else {\r\n    length = 2;\r\n  }\r\n\r\n  var derivationPath = Buffer.alloc(1 + length * 4);\r\n  // eslint-disable-next-line\r\n  var offset = 0;\r\n  offset = derivationPath.writeUInt8(length, offset);\r\n  offset = derivationPath.writeUInt32BE(harden(44), offset); // Using BIP44\r\n  offset = derivationPath.writeUInt32BE(harden(501), offset); // Solana's BIP44 path\r\n\r\n  if (length > 2) {\r\n    offset = derivationPath.writeUInt32BE(harden(account), offset);\r\n    if (length === 4) {\r\n      // @FIXME: https://github.com/project-serum/spl-token-wallet/issues/59\r\n      offset = derivationPath.writeUInt32BE(harden(change), offset);\r\n    }\r\n  }\r\n\r\n  return derivationPath;\r\n}\r\n\r\nexport async function signTransaction(\r\n  transport: Transport,\r\n  transaction: Transaction,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const messageBytes = transaction.serializeMessage();\r\n  return signBytes(transport, messageBytes, derivationPath);\r\n}\r\n\r\nexport async function signBytes(\r\n  transport: Transport,\r\n  bytes: Buffer,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const numPaths = Buffer.alloc(1);\r\n  numPaths.writeUInt8(1, 0);\r\n\r\n  const payload = Buffer.concat([numPaths, derivationPath, bytes]);\r\n\r\n  // @FIXME: must enable blind signing in Solana Ledger App per https://github.com/project-serum/spl-token-wallet/issues/71\r\n  // See also https://github.com/project-serum/spl-token-wallet/pull/23#issuecomment-712317053\r\n  return ledgerSend(transport, INS_SIGN_MESSAGE, P1_CONFIRM, payload);\r\n}\r\n\r\nexport async function getPublicKey(\r\n  transport: Transport,\r\n  derivationPath: Buffer = getSolanaDerivationPath(),\r\n) {\r\n  const publicKeyBytes = await ledgerSend(\r\n    transport,\r\n    INS_GET_PUBKEY,\r\n    P1_NON_CONFIRM,\r\n    derivationPath,\r\n  );\r\n\r\n  return new PublicKey(publicKeyBytes);\r\n}\r\n","module.exports = __webpack_public_path__ + \"static/media/logo.da50543d.png\";","import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport BN from 'bn.js';\r\n\r\nexport function isValidPublicKey(key) {\r\n  if (!key) {\r\n    return false;\r\n  }\r\n  try {\r\n    new PublicKey(key);\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport async function sleep(ms) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\nexport const percentFormat = new Intl.NumberFormat(undefined, {\r\n  style: 'percent',\r\n  minimumFractionDigits: 2,\r\n  maximumFractionDigits: 2,\r\n});\r\n\r\nexport function floorToDecimal(\r\n  value: number,\r\n  decimals: number | undefined | null,\r\n) {\r\n  return decimals\r\n    ? Math.floor(value * 10 ** decimals) / 10 ** decimals\r\n    : Math.floor(value);\r\n}\r\n\r\nexport function roundToDecimal(\r\n  value: number,\r\n  decimals: number | undefined | null,\r\n) {\r\n  return decimals ? Math.round(value * 10 ** decimals) / 10 ** decimals : value;\r\n}\r\n\r\nexport function getDecimalCount(value): number {\r\n  if (\r\n    !isNaN(value) &&\r\n    Math.floor(value) !== value &&\r\n    value.toString().includes('.')\r\n  )\r\n    return value.toString().split('.')[1].length || 0;\r\n  if (\r\n    !isNaN(value) &&\r\n    Math.floor(value) !== value &&\r\n    value.toString().includes('e')\r\n  )\r\n    return parseInt(value.toString().split('e-')[1] || '0');\r\n  return 0;\r\n}\r\n\r\nexport function divideBnToNumber(numerator: BN, denominator: BN): number {\r\n  const quotient = numerator.div(denominator).toNumber();\r\n  const rem = numerator.umod(denominator);\r\n  const gcd = rem.gcd(denominator);\r\n  return quotient + rem.div(gcd).toNumber() / denominator.div(gcd).toNumber();\r\n}\r\n\r\nexport function getTokenMultiplierFromDecimals(decimals: number): BN {\r\n  return new BN(10).pow(new BN(decimals));\r\n}\r\n\r\nconst localStorageListeners = {};\r\n\r\nexport function useLocalStorageStringState(\r\n  key: string,\r\n  defaultState: string | null = null,\r\n): [string | null, (newState: string | null) => void] {\r\n  const state = localStorage.getItem(key) || defaultState;\r\n\r\n  const [, notify] = useState(key + '\\n' + state);\r\n\r\n  useEffect(() => {\r\n    if (!localStorageListeners[key]) {\r\n      localStorageListeners[key] = [];\r\n    }\r\n    localStorageListeners[key].push(notify);\r\n    return () => {\r\n      localStorageListeners[key] = localStorageListeners[key].filter(\r\n        (listener) => listener !== notify,\r\n      );\r\n      if (localStorageListeners[key].length === 0) {\r\n        delete localStorageListeners[key];\r\n      }\r\n    };\r\n  }, [key]);\r\n\r\n  const setState = useCallback<(newState: string | null) => void>(\r\n    (newState) => {\r\n      const changed = state !== newState;\r\n      if (!changed) {\r\n        return;\r\n      }\r\n\r\n      if (newState === null) {\r\n        localStorage.removeItem(key);\r\n      } else {\r\n        localStorage.setItem(key, newState);\r\n      }\r\n      localStorageListeners[key]?.forEach((listener) =>\r\n        listener(key + '\\n' + newState),\r\n      );\r\n    },\r\n    [state, key],\r\n  );\r\n\r\n  return [state, setState];\r\n}\r\n\r\nexport function useLocalStorageState<T = any>(\r\n  key: string,\r\n  defaultState: T | null = null,\r\n): [T, (newState: T) => void] {\r\n  let [stringState, setStringState] = useLocalStorageStringState(\r\n    key,\r\n    JSON.stringify(defaultState),\r\n  );\r\n  return [\r\n    useMemo(() => stringState && JSON.parse(stringState), [stringState]),\r\n    (newState) => setStringState(JSON.stringify(newState)),\r\n  ];\r\n}\r\n\r\nexport function useEffectAfterTimeout(effect, timeout) {\r\n  useEffect(() => {\r\n    const handle = setTimeout(effect, timeout);\r\n    return () => clearTimeout(handle);\r\n  });\r\n}\r\n\r\nexport function useListener(emitter, eventName) {\r\n  const [, forceUpdate] = useState(0);\r\n  useEffect(() => {\r\n    const listener = () => forceUpdate((i) => i + 1);\r\n    emitter.on(eventName, listener);\r\n    return () => emitter.removeListener(eventName, listener);\r\n  }, [emitter, eventName]);\r\n}\r\n\r\nexport function abbreviateAddress(address: PublicKey, size = 4) {\r\n  const base58 = address.toBase58();\r\n  return base58.slice(0, size) + '…' + base58.slice(-size);\r\n}\r\n\r\nexport function isEqual(obj1, obj2, keys) {\r\n  if (!keys && Object.keys(obj1).length !== Object.keys(obj2).length) {\r\n    return false;\r\n  }\r\n  keys = keys || Object.keys(obj1);\r\n  for (const k of keys) {\r\n    if (obj1[k] !== obj2[k]) {\r\n      // shallow comparison\r\n      return false;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function flatten(obj, { prefix = '', restrictTo }) {\r\n  let restrict = restrictTo;\r\n  if (restrict) {\r\n    restrict = restrict.filter((k) => obj.hasOwnProperty(k));\r\n  }\r\n  const result = {};\r\n  (function recurse(obj, current, keys) {\r\n    (keys || Object.keys(obj)).forEach((key) => {\r\n      const value = obj[key];\r\n      const newKey = current ? current + '.' + key : key; // joined key with dot\r\n      if (value && typeof value === 'object') {\r\n        // @ts-ignore\r\n        recurse(value, newKey); // nested object\r\n      } else {\r\n        result[newKey] = value;\r\n      }\r\n    });\r\n  })(obj, prefix, restrict);\r\n  return result;\r\n}\r\n","import { useEffect, useReducer } from 'react';\r\n\r\nimport assert from 'assert';\r\n\r\nconst pageLoadTime = new Date();\r\n\r\nconst globalCache: Map<any, any> = new Map();\r\n\r\nclass FetchLoopListener<T = any> {\r\n  cacheKey: any;\r\n  fn: () => Promise<T>;\r\n  refreshInterval: number;\r\n  refreshIntervalOnError: number | null;\r\n  callback: () => void;\r\n  cacheNullValues: Boolean = true;\r\n\r\n  constructor(\r\n    cacheKey: any,\r\n    fn: () => Promise<T>,\r\n    refreshInterval: number,\r\n    refreshIntervalOnError: number | null,\r\n    callback: () => void,\r\n    cacheNullValues: Boolean,\r\n  ) {\r\n    this.cacheKey = cacheKey;\r\n    this.fn = fn;\r\n    this.refreshInterval = refreshInterval;\r\n    this.refreshIntervalOnError = refreshIntervalOnError;\r\n    this.callback = callback;\r\n    this.cacheNullValues = cacheNullValues;\r\n  }\r\n}\r\n\r\nclass FetchLoopInternal<T = any> {\r\n  cacheKey: any;\r\n  fn: () => Promise<T>;\r\n  timeoutId: null | any;\r\n  listeners: Set<FetchLoopListener<T>>;\r\n  errors: number;\r\n  cacheNullValues: Boolean = true;\r\n\r\n  constructor(cacheKey: any, fn: () => Promise<T>, cacheNullValues: Boolean) {\r\n    this.cacheKey = cacheKey;\r\n    this.fn = fn;\r\n    this.timeoutId = null;\r\n    this.listeners = new Set();\r\n    this.errors = 0;\r\n    this.cacheNullValues = cacheNullValues;\r\n  }\r\n\r\n  get refreshInterval(): number {\r\n    return Math.min(\r\n      ...[...this.listeners].map((listener) => listener.refreshInterval),\r\n    );\r\n  }\r\n\r\n  get refreshIntervalOnError(): number | null {\r\n    const refreshIntervalsOnError: number[] = [...this.listeners]\r\n      .map((listener) => listener.refreshIntervalOnError)\r\n      .filter((x): x is number => x !== null);\r\n    if (refreshIntervalsOnError.length === 0) {\r\n      return null;\r\n    }\r\n    return Math.min(...refreshIntervalsOnError);\r\n  }\r\n\r\n  get stopped(): boolean {\r\n    return this.listeners.size === 0;\r\n  }\r\n\r\n  addListener(listener: FetchLoopListener<T>): void {\r\n    const previousRefreshInterval = this.refreshInterval;\r\n    this.listeners.add(listener);\r\n    if (this.refreshInterval < previousRefreshInterval) {\r\n      this.refresh();\r\n    }\r\n  }\r\n\r\n  removeListener(listener: FetchLoopListener<T>): void {\r\n    assert(this.listeners.delete(listener));\r\n    if (this.stopped) {\r\n      if (this.timeoutId) {\r\n        clearTimeout(this.timeoutId);\r\n        this.timeoutId = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  notifyListeners(): void {\r\n    this.listeners.forEach((listener) => listener.callback());\r\n  }\r\n\r\n  refresh = async () => {\r\n    if (this.timeoutId) {\r\n      clearTimeout(this.timeoutId);\r\n      this.timeoutId = null;\r\n    }\r\n    if (this.stopped) {\r\n      return;\r\n    }\r\n\r\n    let errored = false;\r\n    try {\r\n      const data = await this.fn();\r\n      if (!this.cacheNullValues && data === null) {\r\n        console.log(`Not caching null value for ${this.cacheKey}`);\r\n        // cached data has not changed so no need to re-render\r\n        this.errors = 0;\r\n        return data;\r\n      } else {\r\n        globalCache.set(this.cacheKey, data);\r\n        this.errors = 0;\r\n        this.notifyListeners();\r\n        return data;\r\n      }\r\n    } catch (error) {\r\n      ++this.errors;\r\n      console.warn(error);\r\n      errored = true;\r\n    } finally {\r\n      if (!this.timeoutId && !this.stopped) {\r\n        let waitTime = this.refreshInterval;\r\n        if (\r\n          errored &&\r\n          this.refreshIntervalOnError &&\r\n          this.refreshIntervalOnError > 0\r\n        ) {\r\n          waitTime = this.refreshIntervalOnError;\r\n        }\r\n\r\n        // Back off on errors.\r\n        if (this.errors > 0) {\r\n          waitTime = Math.min(1000 * 2 ** (this.errors - 1), 60000);\r\n        }\r\n\r\n        // Don't do any refreshing for the first five seconds, to make way for other things to load.\r\n        const timeSincePageLoad = +new Date() - +pageLoadTime;\r\n        if (timeSincePageLoad < 5000) {\r\n          waitTime += 5000 - timeSincePageLoad / 2;\r\n        }\r\n\r\n        // Refresh background pages slowly.\r\n        if (document.visibilityState === 'hidden') {\r\n          waitTime = 60000;\r\n        } else if (!document.hasFocus()) {\r\n          waitTime *= 1.5;\r\n        }\r\n\r\n        // Add jitter so we don't send all requests at the same time.\r\n        waitTime *= 0.8 + 0.4 * Math.random();\r\n\r\n        this.timeoutId = setTimeout(this.refresh, waitTime);\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nclass FetchLoops {\r\n  loops = new Map();\r\n\r\n  addListener<T>(listener: FetchLoopListener<T>) {\r\n    if (!this.loops.has(listener.cacheKey)) {\r\n      this.loops.set(\r\n        listener.cacheKey,\r\n        new FetchLoopInternal<T>(\r\n          listener.cacheKey,\r\n          listener.fn,\r\n          listener.cacheNullValues,\r\n        ),\r\n      );\r\n    }\r\n    this.loops.get(listener.cacheKey).addListener(listener);\r\n  }\r\n\r\n  removeListener<T>(listener: FetchLoopListener<T>) {\r\n    const loop = this.loops.get(listener.cacheKey);\r\n    loop.removeListener(listener);\r\n    if (loop.stopped) {\r\n      this.loops.delete(listener.cacheKey);\r\n      globalCache.delete(listener.cacheKey);\r\n    }\r\n  }\r\n\r\n  refresh(cacheKey) {\r\n    if (this.loops.has(cacheKey)) {\r\n      this.loops.get(cacheKey).refresh();\r\n    }\r\n  }\r\n\r\n  refreshAll() {\r\n    return Promise.all([...this.loops.values()].map((loop) => loop.refresh()));\r\n  }\r\n}\r\nconst globalLoops = new FetchLoops();\r\n\r\nexport function useAsyncData<T = any>(\r\n  asyncFn: () => Promise<T>,\r\n  cacheKey: any,\r\n  { refreshInterval = 60000, refreshIntervalOnError = null } = {},\r\n  cacheNullValues: Boolean = true,\r\n): [null | undefined | T, boolean] {\r\n  const [, rerender] = useReducer((i) => i + 1, 0);\r\n\r\n  useEffect(() => {\r\n    if (!cacheKey) {\r\n      // eslint-disable-next-line @typescript-eslint/no-empty-function\r\n      return () => {};\r\n    }\r\n    const listener = new FetchLoopListener<T>(\r\n      cacheKey,\r\n      asyncFn,\r\n      refreshInterval,\r\n      refreshIntervalOnError,\r\n      rerender,\r\n      cacheNullValues,\r\n    );\r\n    globalLoops.addListener(listener);\r\n    return () => globalLoops.removeListener(listener);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [cacheKey, refreshInterval]);\r\n\r\n  if (!cacheKey) {\r\n    return [null, false];\r\n  }\r\n\r\n  const loaded = globalCache.has(cacheKey);\r\n  const data = loaded ? globalCache.get(cacheKey) : undefined;\r\n  return [data, loaded];\r\n}\r\n\r\nexport function refreshCache(cacheKey: any, clearCache = false): void {\r\n  if (clearCache) {\r\n    globalCache.delete(cacheKey);\r\n  }\r\n  const loop = globalLoops.loops.get(cacheKey);\r\n  if (loop) {\r\n    loop.refresh();\r\n    if (clearCache) {\r\n      loop.notifyListeners();\r\n    }\r\n  }\r\n}\r\n\r\nexport function refreshAllCaches(): void {\r\n  for (const loop of globalLoops.loops.values()) {\r\n    loop.refresh();\r\n  }\r\n}\r\n\r\nexport function setCache(\r\n  cacheKey: any,\r\n  value: any,\r\n  { initializeOnly = false } = {},\r\n): void {\r\n  if (initializeOnly && globalCache.has(cacheKey)) {\r\n    return;\r\n  }\r\n  globalCache.set(cacheKey, value);\r\n  const loop = globalLoops.loops.get(cacheKey);\r\n  if (loop) {\r\n    loop.notifyListeners();\r\n  }\r\n}\r\n\r\nexport function getCache(\r\n  cacheKey: any\r\n) {\r\n  return globalCache.get(cacheKey);\r\n}\r\n","import { useLocalStorageState } from './utils';\r\nimport { Account, AccountInfo, Connection, PublicKey } from '@solana/web3.js';\r\nimport React, { useContext, useEffect, useMemo, useRef } from 'react';\r\nimport { setCache, useAsyncData } from './fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\nimport { ConnectionContextValues, EndpointInfo } from './types';\r\n\r\nexport const ENDPOINTS: EndpointInfo[] = [\r\n  {\r\n    name: 'mainnet-beta',\r\n    endpoint: 'https://solana-api.projectserum.com',\r\n    custom: false,\r\n  },\r\n  { name: 'localnet', endpoint: 'http://127.0.0.1:8899', custom: false },\r\n];\r\n\r\nconst accountListenerCount = new Map();\r\n\r\nconst ConnectionContext: React.Context<null | ConnectionContextValues> = React.createContext<null | ConnectionContextValues>(\r\n  null,\r\n);\r\n\r\nexport function ConnectionProvider({ children }) {\r\n  const [endpoint, setEndpoint] = useLocalStorageState<string>(\r\n    'connectionEndpts',\r\n    ENDPOINTS[0].endpoint,\r\n  );\r\n  const [customEndpoints, setCustomEndpoints] = useLocalStorageState<\r\n    EndpointInfo[]\r\n  >('customConnectionEndpoints', []);\r\n  const availableEndpoints = ENDPOINTS.concat(customEndpoints);\r\n\r\n  const connection = useMemo(() => new Connection(endpoint, 'recent'), [\r\n    endpoint,\r\n  ]);\r\n  const sendConnection = useMemo(() => new Connection(endpoint, 'recent'), [\r\n    endpoint,\r\n  ]);\r\n\r\n  // The websocket library solana/web3.js uses closes its websocket connection when the subscription list\r\n  // is empty after opening its first time, preventing subsequent subscriptions from receiving responses.\r\n  // This is a hack to prevent the list from every getting empty\r\n  useEffect(() => {\r\n    const id = connection.onAccountChange(new Account().publicKey, () => {});\r\n    return () => {\r\n      connection.removeAccountChangeListener(id);\r\n    };\r\n  }, [connection]);\r\n\r\n  useEffect(() => {\r\n    const id = connection.onSlotChange(() => null);\r\n    return () => {\r\n      connection.removeSlotChangeListener(id);\r\n    };\r\n  }, [connection]);\r\n\r\n  useEffect(() => {\r\n    const id = sendConnection.onAccountChange(\r\n      new Account().publicKey,\r\n      () => {},\r\n    );\r\n    return () => {\r\n      sendConnection.removeAccountChangeListener(id);\r\n    };\r\n  }, [sendConnection]);\r\n\r\n  useEffect(() => {\r\n    const id = sendConnection.onSlotChange(() => null);\r\n    return () => {\r\n      sendConnection.removeSlotChangeListener(id);\r\n    };\r\n  }, [sendConnection]);\r\n\r\n  return (\r\n    <ConnectionContext.Provider\r\n      value={{\r\n        endpoint,\r\n        setEndpoint,\r\n        connection,\r\n        sendConnection,\r\n        availableEndpoints,\r\n        setCustomEndpoints,\r\n      }}\r\n    >\r\n      {children}\r\n    </ConnectionContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useConnection() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return context.connection;\r\n}\r\n\r\nexport function useSendConnection() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return context.sendConnection;\r\n}\r\n\r\nexport function useConnectionConfig() {\r\n  const context = useContext(ConnectionContext);\r\n  if (!context) {\r\n    throw new Error('Missing connection context');\r\n  }\r\n  return {\r\n    endpoint: context.endpoint,\r\n    endpointInfo: context.availableEndpoints.find(\r\n      (info) => info.endpoint === context.endpoint,\r\n    ),\r\n    setEndpoint: context.setEndpoint,\r\n    availableEndpoints: context.availableEndpoints,\r\n    setCustomEndpoints: context.setCustomEndpoints,\r\n  };\r\n}\r\n\r\nexport function useAccountInfo(\r\n  publicKey: PublicKey | undefined | null,\r\n): [AccountInfo<Buffer> | null | undefined, boolean] {\r\n  const connection = useConnection();\r\n  const cacheKey = tuple(connection, publicKey?.toBase58());\r\n  const [accountInfo, loaded] = useAsyncData<AccountInfo<Buffer> | null>(\r\n    async () => (publicKey ? connection.getAccountInfo(publicKey) : null),\r\n    cacheKey,\r\n    { refreshInterval: 60_000 },\r\n  );\r\n  useEffect(() => {\r\n    if (!publicKey) {\r\n      return;\r\n    }\r\n    if (accountListenerCount.has(cacheKey)) {\r\n      let currentItem = accountListenerCount.get(cacheKey);\r\n      ++currentItem.count;\r\n    } else {\r\n      let previousInfo: AccountInfo<Buffer> | null = null;\r\n      const subscriptionId = connection.onAccountChange(publicKey, (info) => {\r\n        if (\r\n          !previousInfo ||\r\n          !previousInfo.data.equals(info.data) ||\r\n          previousInfo.lamports !== info.lamports\r\n        ) {\r\n          previousInfo = info;\r\n          setCache(cacheKey, info);\r\n        }\r\n      });\r\n      accountListenerCount.set(cacheKey, { count: 1, subscriptionId });\r\n    }\r\n    return () => {\r\n      let currentItem = accountListenerCount.get(cacheKey);\r\n      let nextCount = currentItem.count - 1;\r\n      if (nextCount <= 0) {\r\n        connection.removeAccountChangeListener(currentItem.subscriptionId);\r\n        accountListenerCount.delete(cacheKey);\r\n      } else {\r\n        --currentItem.count;\r\n      }\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [cacheKey]);\r\n  const previousInfoRef = useRef<AccountInfo<Buffer> | null | undefined>(null);\r\n  if (\r\n    !accountInfo ||\r\n    !previousInfoRef.current ||\r\n    !previousInfoRef.current.data.equals(accountInfo.data) ||\r\n    previousInfoRef.current.lamports !== accountInfo.lamports\r\n  ) {\r\n    previousInfoRef.current = accountInfo;\r\n  }\r\n  return [previousInfoRef.current, loaded];\r\n}\r\n\r\nexport function useAccountData(publicKey) {\r\n  const [accountInfo] = useAccountInfo(publicKey);\r\n  return accountInfo && accountInfo.data;\r\n}\r\n","import React from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\n\r\nexport default function Link({ external = false, ...props }) {\r\n  let { to, children, ...rest } = props;\r\n  if (external) {\r\n    return (\r\n      <a href={to} target=\"_blank\" rel=\"noopener noreferrer\" {...rest}>\r\n        {children}\r\n      </a>\r\n    );\r\n  }\r\n  return (\r\n    <RouterLink to={to} {...rest}>\r\n      {children}\r\n    </RouterLink>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { notification } from 'antd';\r\nimport Link from '../components/Link';\r\n\r\nexport function notify({\r\n  message,\r\n  description,\r\n  txid,\r\n  type = 'info',\r\n  placement = 'bottomLeft',\r\n}: {\r\n  message: string;\r\n  description?: string | JSX.Element;\r\n  txid?: string;\r\n  type?: string;\r\n  placement?: string;\r\n}) {\r\n  if (txid) {\r\n    description = (\r\n      <Link\r\n        external\r\n        to={'https://solscan.io/tx/' + txid}\r\n        style={{ color: '#0000ff' }}\r\n      >\r\n        View transaction {txid.slice(0, 8)}...{txid.slice(txid.length - 8)}\r\n      </Link>\r\n    );\r\n  }\r\n  notification[type]({\r\n    message: <span style={{ color: 'black' }}>{message}</span>,\r\n    description: (\r\n      <span style={{ color: 'black', opacity: 0.5 }}>{description}</span>\r\n    ),\r\n    placement,\r\n    style: {\r\n      backgroundColor: 'white',\r\n    },\r\n  });\r\n}\r\n","import { PublicKey, Transaction } from '@solana/web3.js';\r\n\r\nexport const DEFAULT_PUBLIC_KEY = new PublicKey(\r\n  '11111111111111111111111111111111',\r\n);\r\n\r\nexport interface WalletAdapter {\r\n  publicKey: PublicKey;\r\n  autoApprove: boolean;\r\n  connected: boolean;\r\n  signTransaction: (transaction: Transaction) => Promise<Transaction>;\r\n  signAllTransactions: (transaction: Transaction[]) => Promise<Transaction[]>;\r\n  connect: () => any;\r\n  disconnect: () => any;\r\n  on<T>(event: string, fn: () => void): this;\r\n}\r\n","import type Transport from '@ledgerhq/hw-transport';\r\nimport type { Transaction } from '@solana/web3.js';\r\n\r\nimport EventEmitter from 'eventemitter3';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport TransportWebUSB from '@ledgerhq/hw-transport-webusb';\r\nimport { notify } from '../../utils/notifications';\r\nimport { getPublicKey, signTransaction } from './core';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\nexport class LedgerWalletAdapter extends EventEmitter implements WalletAdapter {\r\n  _connecting: boolean;\r\n  _publicKey: PublicKey | null;\r\n  _transport: Transport | null;\r\n\r\n  constructor() {\r\n    super();\r\n    this._connecting = false;\r\n    this._publicKey = null;\r\n    this._transport = null;\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  get connected() {\r\n    return this._publicKey !== null;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return false;\r\n  }\r\n\r\n  public async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    const result: Transaction[] = [];\r\n    for (let i = 0; i < transactions.length; i++) {\r\n      const transaction = transactions[i];\r\n      const signed = await this.signTransaction(transaction);\r\n      result.push(signed);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._transport || !this._publicKey) {\r\n      throw new Error('Not connected to Ledger');\r\n    }\r\n\r\n    // @TODO: account selection (derivation path changes with account)\r\n    const signature = await signTransaction(this._transport, transaction);\r\n\r\n    transaction.addSignature(this._publicKey, signature);\r\n\r\n    return transaction;\r\n  }\r\n\r\n  async connect() {\r\n    if (this._connecting) {\r\n      return;\r\n    }\r\n\r\n    this._connecting = true;\r\n\r\n    try {\r\n      // @TODO: transport selection (WebUSB, WebHID, bluetooth, ...)\r\n      this._transport = await TransportWebUSB.create();\r\n      // @TODO: account selection\r\n      this._publicKey = await getPublicKey(this._transport);\r\n      this.emit('connect', this._publicKey);\r\n    } catch (error) {\r\n      notify({\r\n        message: 'Ledger Error',\r\n        description: error.message,\r\n      });\r\n      await this.disconnect();\r\n    } finally {\r\n      this._connecting = false;\r\n    }\r\n  }\r\n\r\n  async disconnect() {\r\n    let emit = false;\r\n    if (this._transport) {\r\n      await this._transport.close();\r\n      this._transport = null;\r\n      emit = true;\r\n    }\r\n\r\n    this._connecting = false;\r\n    this._publicKey = null;\r\n\r\n    if (emit) {\r\n      this.emit('disconnect');\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\ntype PhantomEvent = 'disconnect' | 'connect';\r\ntype PhantomRequestMethod =\r\n  | 'connect'\r\n  | 'disconnect'\r\n  | 'signTransaction'\r\n  | 'signAllTransactions';\r\n\r\ninterface PhantomProvider {\r\n  publicKey?: PublicKey;\r\n  isConnected?: boolean;\r\n  autoApprove?: boolean;\r\n  signTransaction: (transaction: Transaction) => Promise<Transaction>;\r\n  signAllTransactions: (transactions: Transaction[]) => Promise<Transaction[]>;\r\n  connect: () => Promise<void>;\r\n  disconnect: () => Promise<void>;\r\n  on: (event: PhantomEvent, handler: (args: any) => void) => void;\r\n  request: (method: PhantomRequestMethod, params: any) => Promise<any>;\r\n  listeners: (event: PhantomEvent) => (() => void)[];\r\n}\r\n\r\nexport class PhantomWalletAdapter\r\n  extends EventEmitter\r\n  implements WalletAdapter {\r\n  constructor() {\r\n    super();\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  private get _provider(): PhantomProvider | undefined {\r\n    if ((window as any)?.solana?.isPhantom) {\r\n      return (window as any).solana;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private _handleConnect = (...args) => {\r\n    this.emit('connect', ...args);\r\n  }\r\n\r\n  private _handleDisconnect = (...args) => {\r\n    this.emit('disconnect', ...args);\r\n  }\r\n\r\n  get connected() {\r\n    return this._provider?.isConnected || false;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return this._provider?.autoApprove || false;\r\n  }\r\n\r\n  async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    if (!this._provider) {\r\n      return transactions;\r\n    }\r\n\r\n    return this._provider.signAllTransactions(transactions);\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._provider?.publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._provider) {\r\n      return transaction;\r\n    }\r\n\r\n    return this._provider.signTransaction(transaction);\r\n  }\r\n\r\n  connect() {\r\n    if (!this._provider) {\r\n      window.open('https://phantom.app/', '_blank');\r\n      notify({\r\n        message: 'Connection Error',\r\n        description: 'Please install Phantom wallet',\r\n      });\r\n      return;\r\n    }\r\n    if (!this._provider.listeners('connect').length) {\r\n      this._provider?.on('connect', this._handleConnect);\r\n    }\r\n    if (!this._provider.listeners('disconnect').length) {\r\n      this._provider?.on('disconnect', this._handleDisconnect);\r\n    }\r\n    return this._provider?.connect();\r\n  }\r\n\r\n  disconnect() {\r\n    if (this._provider) {\r\n      this._provider.disconnect();\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\nexport class MathWalletAdapter extends EventEmitter implements WalletAdapter {\r\n  _publicKey?: PublicKey;\r\n  _onProcess: boolean;\r\n  _connected: boolean;\r\n  constructor() {\r\n    super();\r\n    this._onProcess = false;\r\n    this._connected = false;\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  get connected() {\r\n    return this._connected;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return false;\r\n  }\r\n\r\n  public async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    if (!this._provider) {\r\n      return transactions;\r\n    }\r\n\r\n    return this._provider.signAllTransactions(transactions);\r\n  }\r\n\r\n  private get _provider() {\r\n    if ((window as any)?.solana?.isMathWallet) {\r\n      return (window as any).solana;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._provider) {\r\n      return transaction;\r\n    }\r\n\r\n    return this._provider.signTransaction(transaction);\r\n  }\r\n\r\n  connect() {\r\n    if (this._onProcess) {\r\n      return;\r\n    }\r\n\r\n    if (!this._provider) {\r\n      window.open('https://mathwallet.org/', '_blank');\r\n      notify({\r\n        message: 'Math Wallet Error',\r\n        description: 'Please install mathwallet',\r\n      });\r\n      return;\r\n    }\r\n\r\n    this._onProcess = true;\r\n    this._provider\r\n      .getAccount()\r\n      .then((account: any) => {\r\n        this._publicKey = new PublicKey(account);\r\n        this._connected = true;\r\n        this.emit('connect', this._publicKey);\r\n      })\r\n      .catch(() => {\r\n        this.disconnect();\r\n      })\r\n      .finally(() => {\r\n        this._onProcess = false;\r\n      });\r\n  }\r\n\r\n  disconnect() {\r\n    if (this._publicKey) {\r\n      this._publicKey = undefined;\r\n      this._connected = false;\r\n      this.emit('disconnect');\r\n    }\r\n  }\r\n}\r\n","import EventEmitter from 'eventemitter3';\r\nimport { PublicKey, Transaction } from '@solana/web3.js';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DEFAULT_PUBLIC_KEY, WalletAdapter } from '../types';\r\n\r\ntype SolflareExtensionEvent = 'disconnect' | 'connect';\r\ntype SolflareExtensionRequestMethod =\r\n  | 'connect'\r\n  | 'disconnect'\r\n  | 'signTransaction'\r\n  | 'signAllTransactions';\r\n\r\ninterface SolflareExtensionProvider {\r\n  publicKey?: PublicKey;\r\n  isConnected?: boolean;\r\n  autoApprove?: boolean;\r\n  signTransaction: (transaction: Transaction) => Promise<Transaction>;\r\n  signAllTransactions: (transactions: Transaction[]) => Promise<Transaction[]>;\r\n  connect: () => Promise<void>;\r\n  disconnect: () => Promise<void>;\r\n  on: (event: SolflareExtensionEvent, handler: (args: any) => void) => void;\r\n  off: (event: SolflareExtensionEvent, handler: (args: any) => void) => void;\r\n  request: (method: SolflareExtensionRequestMethod, params: any) => Promise<any>;\r\n}\r\n\r\nexport class SolflareExtensionWalletAdapter\r\n  extends EventEmitter\r\n  implements WalletAdapter {\r\n  constructor() {\r\n    super();\r\n    this.connect = this.connect.bind(this);\r\n  }\r\n\r\n  private get _provider(): SolflareExtensionProvider | undefined {\r\n    if ((window as any)?.solflare?.isSolflare) {\r\n      return (window as any).solflare;\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private _handleConnect = (...args) => {\r\n    this.emit('connect', ...args);\r\n  }\r\n\r\n  private _handleDisconnect = (...args) => {\r\n    this._provider?.off('connect', this._handleConnect);\r\n    this._provider?.off('disconnect', this._handleDisconnect);\r\n    this.emit('disconnect', ...args);\r\n  }\r\n\r\n  get connected() {\r\n    return this._provider?.isConnected || false;\r\n  }\r\n\r\n  get autoApprove() {\r\n    return this._provider?.autoApprove || false;\r\n  }\r\n\r\n  async signAllTransactions(\r\n    transactions: Transaction[],\r\n  ): Promise<Transaction[]> {\r\n    if (!this._provider) {\r\n      return transactions;\r\n    }\r\n\r\n    return this._provider.signAllTransactions(transactions);\r\n  }\r\n\r\n  get publicKey() {\r\n    return this._provider?.publicKey || DEFAULT_PUBLIC_KEY;\r\n  }\r\n\r\n  async signTransaction(transaction: Transaction) {\r\n    if (!this._provider) {\r\n      return transaction;\r\n    }\r\n\r\n    return this._provider.signTransaction(transaction);\r\n  }\r\n\r\n  async connect() {\r\n    if (!this._provider) {\r\n      window.open('https://solflare.com/', '_blank');\r\n      notify({\r\n        message: 'Connection Error',\r\n        description: 'Please install Solflare extension',\r\n      });\r\n      return;\r\n    }\r\n    this._provider?.on('connect', this._handleConnect);\r\n    this._provider?.on('disconnect', this._handleDisconnect);\r\n    return this._provider?.connect();\r\n  }\r\n\r\n  async disconnect() {\r\n    if (this._provider) {\r\n      this._provider.disconnect();\r\n    }\r\n  }\r\n}\r\n","import React, {\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useMemo,\r\n  useState,\r\n} from 'react';\r\nimport Wallet from '@project-serum/sol-wallet-adapter';\r\nimport { notify } from './notifications';\r\nimport { useConnectionConfig } from './connection';\r\nimport { useLocalStorageState } from './utils';\r\nimport { WalletContextValues } from './types';\r\nimport { Button, Modal } from 'antd';\r\nimport {\r\n  WalletAdapter,\r\n  LedgerWalletAdapter,\r\n  PhantomWalletAdapter,\r\n  SolletExtensionAdapter,\r\n  MathWalletAdapter,\r\n  SolflareExtensionWalletAdapter,\r\n} from '../wallet-adapters';\r\n\r\nconst ASSET_URL =\r\n  'https://cdn.jsdelivr.net/gh/solana-labs/oyster@main/assets/wallets';\r\nexport const WALLET_PROVIDERS = [\r\n  {\r\n    name: 'sollet.io',\r\n    url: 'https://www.sollet.io',\r\n    icon: `${ASSET_URL}/sollet.svg`,\r\n  },\r\n  {\r\n    name: 'Sollet Extension',\r\n    url: 'https://www.sollet.io/extension',\r\n    icon: `${ASSET_URL}/sollet.svg`,\r\n    adapter: SolletExtensionAdapter as any,\r\n  },\r\n  {\r\n    name: 'Ledger',\r\n    url: 'https://www.ledger.com',\r\n    icon: `${ASSET_URL}/ledger.svg`,\r\n    adapter: LedgerWalletAdapter,\r\n  },\r\n  {\r\n    name: 'Solflare',\r\n    url: 'https://solflare.com/access-wallet',\r\n    icon: `${ASSET_URL}/solflare.svg`,\r\n  },\r\n  {\r\n    name: 'Solflare Extension',\r\n    url: 'https://solflare.com',\r\n    icon: `${ASSET_URL}/solflare.svg`,\r\n    adapter: SolflareExtensionWalletAdapter,\r\n  },\r\n  {\r\n    name: 'Phantom',\r\n    url: 'https://www.phantom.app',\r\n    icon: `https://www.phantom.app/img/logo.png`,\r\n    adapter: PhantomWalletAdapter,\r\n  },\r\n  {\r\n    name: 'MathWallet',\r\n    url: 'https://www.mathwallet.org',\r\n    icon: `${ASSET_URL}/mathwallet.svg`,\r\n    adapter: MathWalletAdapter,\r\n  },\r\n];\r\n\r\nconst WalletContext = React.createContext<null | WalletContextValues>(null);\r\n\r\nexport function WalletProvider({ children }) {\r\n  const { endpoint } = useConnectionConfig();\r\n\r\n  const [autoConnect, setAutoConnect] = useState(false);\r\n  const [providerUrl, setProviderUrl] = useLocalStorageState('walletProvider');\r\n\r\n  const provider = useMemo(\r\n    () => WALLET_PROVIDERS.find(({ url }) => url === providerUrl),\r\n    [providerUrl],\r\n  );\r\n\r\n  let [wallet, setWallet] = useState<WalletAdapter | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    if (provider) {\r\n      const updateWallet = () => {\r\n        // hack to also update wallet synchronously in case it disconnects\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n        wallet = new (provider.adapter || Wallet)(\r\n          providerUrl,\r\n          endpoint,\r\n        ) as WalletAdapter;\r\n        setWallet(wallet);\r\n      };\r\n\r\n      if (document.readyState !== 'complete') {\r\n        // wait to ensure that browser extensions are loaded\r\n        const listener = () => {\r\n          updateWallet();\r\n          window.removeEventListener('load', listener);\r\n        };\r\n        window.addEventListener('load', listener);\r\n        return () => window.removeEventListener('load', listener);\r\n      } else {\r\n        updateWallet();\r\n      }\r\n    }\r\n  }, [provider, providerUrl, endpoint]);\r\n\r\n  const [connected, setConnected] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (wallet) {\r\n      wallet.on('connect', () => {\r\n        if (wallet?.publicKey) {\r\n          console.log('connected');\r\n          localStorage.removeItem('feeDiscountKey');\r\n          setConnected(true);\r\n          const walletPublicKey = wallet.publicKey.toBase58();\r\n          const keyToDisplay =\r\n            walletPublicKey.length > 20\r\n              ? `${walletPublicKey.substring(\r\n                  0,\r\n                  7,\r\n                )}.....${walletPublicKey.substring(\r\n                  walletPublicKey.length - 7,\r\n                  walletPublicKey.length,\r\n                )}`\r\n              : walletPublicKey;\r\n\r\n          notify({\r\n            message: 'Wallet update',\r\n            description: 'Connected to wallet ' + keyToDisplay,\r\n          });\r\n        }\r\n      });\r\n\r\n      wallet.on('disconnect', () => {\r\n        setConnected(false);\r\n        notify({\r\n          message: 'Wallet update',\r\n          description: 'Disconnected from wallet',\r\n        });\r\n        localStorage.removeItem('feeDiscountKey');\r\n      });\r\n    }\r\n\r\n    return () => {\r\n      setConnected(false);\r\n      if (wallet && wallet.connected) {\r\n        wallet.disconnect();\r\n        setConnected(false);\r\n      }\r\n    };\r\n  }, [wallet]);\r\n\r\n  useEffect(() => {\r\n    if (wallet && autoConnect) {\r\n      wallet.connect();\r\n      setAutoConnect(false);\r\n    }\r\n\r\n    return () => {};\r\n  }, [wallet, autoConnect]);\r\n\r\n  const [isModalVisible, setIsModalVisible] = useState(false);\r\n\r\n  const select = useCallback(() => setIsModalVisible(true), []);\r\n  const close = useCallback(() => setIsModalVisible(false), []);\r\n\r\n  return (\r\n    <WalletContext.Provider\r\n      value={{\r\n        wallet,\r\n        connected,\r\n        select,\r\n        providerUrl,\r\n        setProviderUrl,\r\n        providerName:\r\n          WALLET_PROVIDERS.find(({ url }) => url === providerUrl)?.name ??\r\n          providerUrl,\r\n      }}\r\n    >\r\n      {children}\r\n      <Modal\r\n        title=\"Select Wallet\"\r\n        okText=\"Connect\"\r\n        visible={isModalVisible}\r\n        okButtonProps={{ style: { display: 'none' } }}\r\n        onCancel={close}\r\n        width={400}\r\n      >\r\n        {WALLET_PROVIDERS.map((provider) => {\r\n          const onClick = function () {\r\n            setProviderUrl(provider.url);\r\n            setAutoConnect(true);\r\n            close();\r\n          };\r\n\r\n          return (\r\n            <Button\r\n              size=\"large\"\r\n              type={providerUrl === provider.url ? 'primary' : 'ghost'}\r\n              onClick={onClick}\r\n              icon={\r\n                <img\r\n                  alt={`${provider.name}`}\r\n                  width={20}\r\n                  height={20}\r\n                  src={provider.icon}\r\n                  style={{ marginRight: 8 }}\r\n                />\r\n              }\r\n              style={{\r\n                display: 'block',\r\n                width: '100%',\r\n                textAlign: 'left',\r\n                marginBottom: 8,\r\n              }}\r\n            >\r\n              {provider.name}\r\n            </Button>\r\n          );\r\n        })}\r\n      </Modal>\r\n    </WalletContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useWallet() {\r\n  const context = useContext(WalletContext);\r\n  if (!context) {\r\n    throw new Error('Missing wallet context');\r\n  }\r\n\r\n  const wallet = context.wallet;\r\n  return {\r\n    connected: context.connected,\r\n    wallet: wallet,\r\n    providerUrl: context.providerUrl,\r\n    setProvider: context.setProviderUrl,\r\n    providerName: context.providerName,\r\n    select: context.select,\r\n    connect() {\r\n      wallet ? wallet.connect() : context.select();\r\n    },\r\n    disconnect() {\r\n      wallet?.disconnect();\r\n    },\r\n  };\r\n}\r\n","import Wallet from '@project-serum/sol-wallet-adapter';\r\nimport { notify } from '../../utils/notifications';\r\n\r\nexport function SolletExtensionAdapter(_, network) {\r\n  const sollet = (window as any).sollet;\r\n  if (sollet) {\r\n    return new Wallet(sollet, network);\r\n  }\r\n\r\n  return {\r\n    on: () => {},\r\n    connect: () => {\r\n      notify({\r\n        message: 'Sollet Extension Error',\r\n        description: 'Please install the Sollet Extension for Chrome',\r\n      });\r\n    }\r\n  }\r\n}","import { createGlobalStyle } from 'styled-components';\r\n\r\nexport const GlobalStyle = createGlobalStyle`\r\nhtml,body{\r\n  background: green;\r\n}\r\ninput[type=number]::-webkit-inner-spin-button {\r\n  opacity: 0;\r\n}\r\ninput[type=number]:hover::-webkit-inner-spin-button,\r\ninput[type=number]:focus::-webkit-inner-spin-button {\r\n  opacity: 0.25;\r\n}\r\n/* width */\r\n::-webkit-scrollbar {\r\n  width: 15px;\r\n}\r\n/* Track */\r\n::-webkit-scrollbar-track {\r\n  background: #2d313c;\r\n}\r\n/* Handle */\r\n::-webkit-scrollbar-thumb {\r\n  background: #5b5f67;\r\n}\r\n/* Handle on hover */\r\n::-webkit-scrollbar-thumb:hover {\r\n  background: #5b5f67;\r\n}\r\n.ant-slider-track, .ant-slider:hover .ant-slider-track {\r\n  background-color: #3ea018;\r\n  opacity: 0.75;\r\n}\r\n.ant-slider-track,\r\n.ant-slider ant-slider-track:hover {\r\n  background-color: #3ea018;\r\n  opacity: 0.75;\r\n}\r\n.ant-slider-dot-active,\r\n.ant-slider-handle,\r\n.ant-slider-handle-click-focused,\r\n.ant-slider:hover .ant-slider-handle:not(.ant-tooltip-open)  {\r\n  border: 2px solid #3ea018; \r\n}\r\n.ant-table-tbody > tr.ant-table-row:hover > td {\r\n  background: #273043;\r\n}\r\n\r\n.ant-table-tbody > tr > td {\r\n  border-bottom: 8px solid #000001;\r\n}\r\n.ant-table-container table > thead > tr:first-child th {\r\n  border-bottom: none;\r\n}\r\n.ant-divider-horizontal.ant-divider-with-text::before, .ant-divider-horizontal.ant-divider-with-text::after {\r\n  border-top: 1px solid #434a59 !important;\r\n}\r\n.ant-layout {\r\n    background: black;\r\n  }\r\n  .ant-table {\r\n    background: #191919;\r\n  }\r\n  .ant-table-thead > tr > th {\r\n    background: #000001;\r\n  }\r\n.ant-select-item-option-content {\r\n  img {\r\n    margin-right: 4px;\r\n  }\r\n}\r\n.ant-modal-content {\r\n  background-color: #191919;\r\n}\r\n\r\n@-webkit-keyframes highlight {\r\n  from { background-color: #3ea018;}\r\n  to {background-color: #000001;}\r\n}\r\n@-moz-keyframes highlight {\r\n  from { background-color: #3ea018;}\r\n  to {background-color: #000001;}\r\n}\r\n@-keyframes highlight {\r\n  from { background-color: #3ea018;}\r\n  to {background-color: #000001;}\r\n}\r\n.flash {\r\n  -moz-animation: highlight 0.5s ease 0s 1 alternate ;\r\n  -webkit-animation: highlight 0.5s ease 0s 1 alternate;\r\n  animation: highlight 0.5s ease 0s 1 alternate;\r\n}`;\r\n","import React, { Component } from 'react';\r\nimport { Typography } from 'antd';\r\n\r\nconst { Title } = Typography;\r\n\r\nexport default class ErrorBoundary extends Component {\r\n  state = {\r\n    hasError: false,\r\n  };\r\n\r\n  static getDerivedStateFromError(error) {\r\n    return { hasError: true };\r\n  }\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      return (\r\n        <div>\r\n          <div>\r\n            <Title level={2}>Something went wrong.</Title>\r\n            <Title level={4}>Please try again later.</Title>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n","import { notify } from './notifications';\r\nimport { getDecimalCount, sleep } from './utils';\r\nimport { getSelectedTokenAccountForMint } from './markets';\r\nimport {\r\n  Account,\r\n  AccountInfo,\r\n  Commitment,\r\n  Connection,\r\n  PublicKey,\r\n  RpcResponseAndContext,\r\n  SimulatedTransactionResponse,\r\n  SystemProgram,\r\n  Transaction,\r\n  TransactionSignature,\r\n} from '@solana/web3.js';\r\nimport {\r\n  Token,\r\n  ASSOCIATED_TOKEN_PROGRAM_ID,\r\n  TOKEN_PROGRAM_ID,\r\n} from '@solana/spl-token';\r\nimport BN from 'bn.js';\r\nimport {\r\n  DexInstructions,\r\n  Market,\r\n  OpenOrders,\r\n  parseInstructionErrorResponse,\r\n  TOKEN_MINTS,\r\n  TokenInstructions,\r\n} from '@project-serum/serum';\r\nimport { SelectedTokenAccounts, TokenAccount } from './types';\r\nimport { Order } from '@project-serum/serum/lib/market';\r\nimport { Buffer } from 'buffer';\r\nimport assert from 'assert';\r\nimport { struct } from 'superstruct';\r\nimport { WalletAdapter } from '../wallet-adapters';\r\n\r\nexport async function createTokenAccountTransaction({\r\n  connection,\r\n  wallet,\r\n  mintPublicKey,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  mintPublicKey: PublicKey;\r\n}): Promise<{\r\n  transaction: Transaction;\r\n  newAccountPubkey: PublicKey;\r\n}> {\r\n  const ata = await Token.getAssociatedTokenAddress(\r\n    ASSOCIATED_TOKEN_PROGRAM_ID,\r\n    TOKEN_PROGRAM_ID,\r\n    mintPublicKey,\r\n    wallet.publicKey,\r\n  );\r\n  const transaction = new Transaction();\r\n  transaction.add(\r\n    Token.createAssociatedTokenAccountInstruction(\r\n      ASSOCIATED_TOKEN_PROGRAM_ID,\r\n      TOKEN_PROGRAM_ID,\r\n      mintPublicKey,\r\n      ata,\r\n      wallet.publicKey,\r\n      wallet.publicKey,\r\n    ),\r\n  );\r\n  return {\r\n    transaction,\r\n    newAccountPubkey: ata,\r\n  };\r\n}\r\n\r\nexport async function settleFunds({\r\n  market,\r\n  openOrders,\r\n  connection,\r\n  wallet,\r\n  baseCurrencyAccount,\r\n  quoteCurrencyAccount,\r\n  sendNotification = true,\r\n  usdcRef = undefined,\r\n  usdtRef = undefined,\r\n}: {\r\n  market: Market;\r\n  openOrders: OpenOrders;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseCurrencyAccount: TokenAccount;\r\n  quoteCurrencyAccount: TokenAccount;\r\n  sendNotification?: boolean;\r\n  usdcRef?: PublicKey;\r\n  usdtRef?: PublicKey;\r\n}): Promise<string | undefined> {\r\n  if (\r\n    !market ||\r\n    !wallet ||\r\n    !connection ||\r\n    !openOrders ||\r\n    (!baseCurrencyAccount && !quoteCurrencyAccount)\r\n  ) {\r\n    if (sendNotification) {\r\n      notify({ message: 'Not connected' });\r\n    }\r\n    return;\r\n  }\r\n\r\n  let createAccountTransaction: Transaction | undefined;\r\n  let baseCurrencyAccountPubkey = baseCurrencyAccount?.pubkey;\r\n  let quoteCurrencyAccountPubkey = quoteCurrencyAccount?.pubkey;\r\n\r\n  if (!baseCurrencyAccountPubkey) {\r\n    const result = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.baseMintAddress,\r\n    });\r\n    baseCurrencyAccountPubkey = result?.newAccountPubkey;\r\n    createAccountTransaction = result?.transaction;\r\n  }\r\n  if (!quoteCurrencyAccountPubkey) {\r\n    const result = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.quoteMintAddress,\r\n    });\r\n    quoteCurrencyAccountPubkey = result?.newAccountPubkey;\r\n    createAccountTransaction = result?.transaction;\r\n  }\r\n  let referrerQuoteWallet: PublicKey | null = null;\r\n  if (market.supportsReferralFees) {\r\n    const usdt = TOKEN_MINTS.find(({ name }) => name === 'USDT');\r\n    const usdc = TOKEN_MINTS.find(({ name }) => name === 'USDC');\r\n    if (usdtRef && usdt && market.quoteMintAddress.equals(usdt.address)) {\r\n      referrerQuoteWallet = usdtRef;\r\n    } else if (\r\n      usdcRef &&\r\n      usdc &&\r\n      market.quoteMintAddress.equals(usdc.address)\r\n    ) {\r\n      referrerQuoteWallet = usdcRef;\r\n    }\r\n  }\r\n  const {\r\n    transaction: settleFundsTransaction,\r\n    signers: settleFundsSigners,\r\n  } = await market.makeSettleFundsTransaction(\r\n    connection,\r\n    openOrders,\r\n    baseCurrencyAccountPubkey,\r\n    quoteCurrencyAccountPubkey,\r\n    referrerQuoteWallet,\r\n  );\r\n\r\n  let transaction = mergeTransactions([\r\n    createAccountTransaction,\r\n    settleFundsTransaction,\r\n  ]);\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    signers: settleFundsSigners,\r\n    wallet,\r\n    connection,\r\n    sendingMessage: 'Settling funds...',\r\n    sendNotification,\r\n  });\r\n}\r\n\r\nexport async function settleAllFunds({\r\n  connection,\r\n  wallet,\r\n  tokenAccounts,\r\n  markets,\r\n  selectedTokenAccounts,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  tokenAccounts: TokenAccount[];\r\n  markets: Market[];\r\n  selectedTokenAccounts?: SelectedTokenAccounts;\r\n}) {\r\n  if (!markets || !wallet || !connection || !tokenAccounts) {\r\n    return;\r\n  }\r\n\r\n  const programIds: PublicKey[] = [];\r\n  markets\r\n    .reduce((cumulative, m) => {\r\n      // @ts-ignore\r\n      cumulative.push(m._programId);\r\n      return cumulative;\r\n    }, [])\r\n    .forEach((programId) => {\r\n      if (!programIds.find((p) => p.equals(programId))) {\r\n        programIds.push(programId);\r\n      }\r\n    });\r\n\r\n  const getOpenOrdersAccountsForProgramId = async (programId) => {\r\n    const openOrdersAccounts = await OpenOrders.findForOwner(\r\n      connection,\r\n      wallet.publicKey,\r\n      programId,\r\n    );\r\n    return openOrdersAccounts.filter(\r\n      (openOrders) =>\r\n        openOrders.baseTokenFree.toNumber() ||\r\n        openOrders.quoteTokenFree.toNumber(),\r\n    );\r\n  };\r\n\r\n  const openOrdersAccountsForProgramIds = await Promise.all(\r\n    programIds.map((programId) => getOpenOrdersAccountsForProgramId(programId)),\r\n  );\r\n  const openOrdersAccounts = openOrdersAccountsForProgramIds.reduce(\r\n    (accounts, current) => accounts.concat(current),\r\n    [],\r\n  );\r\n\r\n  const settleTransactions = (\r\n    await Promise.all(\r\n      openOrdersAccounts.map((openOrdersAccount) => {\r\n        const market = markets.find((m) =>\r\n          // @ts-ignore\r\n          m._decoded?.ownAddress?.equals(openOrdersAccount.market),\r\n        );\r\n        if (\r\n          openOrdersAccount.baseTokenFree.isZero() &&\r\n          openOrdersAccount.quoteTokenFree.isZero()\r\n        ) {\r\n          // nothing to settle for this market.\r\n          return null;\r\n        }\r\n        const baseMint = market?.baseMintAddress;\r\n        const quoteMint = market?.quoteMintAddress;\r\n\r\n        const selectedBaseTokenAccount = getSelectedTokenAccountForMint(\r\n          tokenAccounts,\r\n          baseMint,\r\n          baseMint &&\r\n          selectedTokenAccounts &&\r\n          selectedTokenAccounts[baseMint.toBase58()],\r\n        )?.pubkey;\r\n        const selectedQuoteTokenAccount = getSelectedTokenAccountForMint(\r\n          tokenAccounts,\r\n          quoteMint,\r\n          quoteMint &&\r\n          selectedTokenAccounts &&\r\n          selectedTokenAccounts[quoteMint.toBase58()],\r\n        )?.pubkey;\r\n        if (!selectedBaseTokenAccount || !selectedQuoteTokenAccount) {\r\n          return null;\r\n        }\r\n        return (\r\n          market &&\r\n          market.makeSettleFundsTransaction(\r\n            connection,\r\n            openOrdersAccount,\r\n            selectedBaseTokenAccount,\r\n            selectedQuoteTokenAccount,\r\n          )\r\n        );\r\n      }),\r\n    )\r\n  ).filter(\r\n    (\r\n      x,\r\n    ): x is {\r\n      signers: Account[];\r\n      transaction: Transaction;\r\n      payer: PublicKey;\r\n    } => !!x,\r\n  );\r\n  if (!settleTransactions || settleTransactions.length === 0) return;\r\n\r\n  const transactions = settleTransactions.slice(0, 4).map((t) => t.transaction);\r\n  const signers: Array<Account> = [];\r\n  settleTransactions\r\n    .reduce((cumulative: Array<Account>, t) => cumulative.concat(t.signers), [])\r\n    .forEach((signer) => {\r\n      if (!signers.find((s) => s.publicKey.equals(signer.publicKey))) {\r\n        signers.push(signer);\r\n      }\r\n    });\r\n\r\n  const transaction = mergeTransactions(transactions);\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    signers,\r\n    wallet,\r\n    connection,\r\n  });\r\n}\r\n\r\nexport async function cancelOrder(params: {\r\n  market: Market;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  order: Order;\r\n}) {\r\n  return cancelOrders({ ...params, orders: [params.order] });\r\n}\r\n\r\nexport async function cancelOrders({\r\n  market,\r\n  wallet,\r\n  connection,\r\n  orders,\r\n}: {\r\n  market: Market;\r\n  wallet: WalletAdapter;\r\n  connection: Connection;\r\n  orders: Order[];\r\n}) {\r\n  const transaction = market.makeMatchOrdersTransaction(5);\r\n  orders.forEach((order) => {\r\n    transaction.add(\r\n      market.makeCancelOrderInstruction(connection, wallet.publicKey, order),\r\n    );\r\n  });\r\n  transaction.add(market.makeMatchOrdersTransaction(5));\r\n  return await sendTransaction({\r\n    transaction,\r\n    wallet,\r\n    connection,\r\n    sendingMessage: 'Sending cancel...',\r\n  });\r\n}\r\n\r\nexport async function placeOrder({\r\n  side,\r\n  price,\r\n  size,\r\n  orderType,\r\n  market,\r\n  connection,\r\n  wallet,\r\n  baseCurrencyAccount,\r\n  quoteCurrencyAccount,\r\n  feeDiscountPubkey = undefined,\r\n}: {\r\n  side: 'buy' | 'sell';\r\n  price: number;\r\n  size: number;\r\n  orderType: 'ioc' | 'postOnly' | 'limit';\r\n  market: Market | undefined | null;\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseCurrencyAccount: PublicKey | undefined;\r\n  quoteCurrencyAccount: PublicKey | undefined;\r\n  feeDiscountPubkey: PublicKey | undefined;\r\n}) {\r\n  let formattedMinOrderSize =\r\n    market?.minOrderSize?.toFixed(getDecimalCount(market.minOrderSize)) ||\r\n    market?.minOrderSize;\r\n  let formattedTickSize =\r\n    market?.tickSize?.toFixed(getDecimalCount(market.tickSize)) ||\r\n    market?.tickSize;\r\n  const isIncrement = (num, step) =>\r\n    Math.abs((num / step) % 1) < 1e-5 ||\r\n    Math.abs(((num / step) % 1) - 1) < 1e-5;\r\n  if (isNaN(price)) {\r\n    notify({ message: 'Invalid price', type: 'error' });\r\n    return;\r\n  }\r\n  if (isNaN(size)) {\r\n    notify({ message: 'Invalid size', type: 'error' });\r\n    return;\r\n  }\r\n  if (!wallet || !wallet.publicKey) {\r\n    notify({ message: 'Connect wallet', type: 'error' });\r\n    return;\r\n  }\r\n  if (!market) {\r\n    notify({ message: 'Invalid  market', type: 'error' });\r\n    return;\r\n  }\r\n  if (!isIncrement(size, market.minOrderSize)) {\r\n    notify({\r\n      message: `Size must be an increment of ${formattedMinOrderSize}`,\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  if (size < market.minOrderSize) {\r\n    notify({ message: 'Size too small', type: 'error' });\r\n    return;\r\n  }\r\n  if (!isIncrement(price, market.tickSize)) {\r\n    notify({\r\n      message: `Price must be an increment of ${formattedTickSize}`,\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  if (price < market.tickSize) {\r\n    notify({ message: 'Price under tick size', type: 'error' });\r\n    return;\r\n  }\r\n  const owner = wallet.publicKey;\r\n  const transaction = new Transaction();\r\n  const signers: Account[] = [];\r\n\r\n  if (!baseCurrencyAccount) {\r\n    const {\r\n      transaction: createAccountTransaction,\r\n      newAccountPubkey,\r\n    } = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.baseMintAddress,\r\n    });\r\n    transaction.add(createAccountTransaction);\r\n    baseCurrencyAccount = newAccountPubkey;\r\n  }\r\n  if (!quoteCurrencyAccount) {\r\n    const {\r\n      transaction: createAccountTransaction,\r\n      newAccountPubkey,\r\n    } = await createTokenAccountTransaction({\r\n      connection,\r\n      wallet,\r\n      mintPublicKey: market.quoteMintAddress,\r\n    });\r\n    transaction.add(createAccountTransaction);\r\n    quoteCurrencyAccount = newAccountPubkey;\r\n  }\r\n\r\n  const payer = side === 'sell' ? baseCurrencyAccount : quoteCurrencyAccount;\r\n  if (!payer) {\r\n    notify({\r\n      message: 'Need an SPL token account for cost currency',\r\n      type: 'error',\r\n    });\r\n    return;\r\n  }\r\n  const params = {\r\n    owner,\r\n    payer,\r\n    side,\r\n    price,\r\n    size,\r\n    orderType,\r\n    feeDiscountPubkey: feeDiscountPubkey || null,\r\n  };\r\n  console.log(params);\r\n\r\n  const matchOrderstransaction = market.makeMatchOrdersTransaction(5);\r\n  transaction.add(matchOrderstransaction);\r\n  const startTime = getUnixTs();\r\n  let {\r\n    transaction: placeOrderTx,\r\n    signers: placeOrderSigners,\r\n  } = await market.makePlaceOrderTransaction(\r\n    connection,\r\n    params,\r\n    120_000,\r\n    120_000,\r\n  );\r\n  const endTime = getUnixTs();\r\n  console.log(`Creating order transaction took ${endTime - startTime}`);\r\n  transaction.add(placeOrderTx);\r\n  transaction.add(market.makeMatchOrdersTransaction(5));\r\n  signers.push(...placeOrderSigners);\r\n\r\n  return await sendTransaction({\r\n    transaction,\r\n    wallet,\r\n    connection,\r\n    signers,\r\n    sendingMessage: 'Sending order...',\r\n  });\r\n}\r\n\r\nexport async function listMarket({\r\n  connection,\r\n  wallet,\r\n  baseMint,\r\n  quoteMint,\r\n  baseLotSize,\r\n  quoteLotSize,\r\n  dexProgramId,\r\n}: {\r\n  connection: Connection;\r\n  wallet: WalletAdapter;\r\n  baseMint: PublicKey;\r\n  quoteMint: PublicKey;\r\n  baseLotSize: number;\r\n  quoteLotSize: number;\r\n  dexProgramId: PublicKey;\r\n}) {\r\n  const market = new Account();\r\n  const requestQueue = new Account();\r\n  const eventQueue = new Account();\r\n  const bids = new Account();\r\n  const asks = new Account();\r\n  const baseVault = new Account();\r\n  const quoteVault = new Account();\r\n  const feeRateBps = 0;\r\n  const quoteDustThreshold = new BN(100);\r\n\r\n  async function getVaultOwnerAndNonce() {\r\n    const nonce = new BN(0);\r\n    while (true) {\r\n      try {\r\n        const vaultOwner = await PublicKey.createProgramAddress(\r\n          [market.publicKey.toBuffer(), nonce.toArrayLike(Buffer, 'le', 8)],\r\n          dexProgramId,\r\n        );\r\n        return [vaultOwner, nonce];\r\n      } catch (e) {\r\n        nonce.iaddn(1);\r\n      }\r\n    }\r\n  }\r\n  const [vaultOwner, vaultSignerNonce] = await getVaultOwnerAndNonce();\r\n\r\n  const tx1 = new Transaction();\r\n  tx1.add(\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: baseVault.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(165),\r\n      space: 165,\r\n      programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: quoteVault.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(165),\r\n      space: 165,\r\n      programId: TokenInstructions.TOKEN_PROGRAM_ID,\r\n    }),\r\n    TokenInstructions.initializeAccount({\r\n      account: baseVault.publicKey,\r\n      mint: baseMint,\r\n      owner: vaultOwner,\r\n    }),\r\n    TokenInstructions.initializeAccount({\r\n      account: quoteVault.publicKey,\r\n      mint: quoteMint,\r\n      owner: vaultOwner,\r\n    }),\r\n  );\r\n\r\n  const tx2 = new Transaction();\r\n  tx2.add(\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: market.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(\r\n        Market.getLayout(dexProgramId).span,\r\n      ),\r\n      space: Market.getLayout(dexProgramId).span,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: requestQueue.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(5120 + 12),\r\n      space: 5120 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: eventQueue.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(262144 + 12),\r\n      space: 262144 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: bids.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(65536 + 12),\r\n      space: 65536 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    SystemProgram.createAccount({\r\n      fromPubkey: wallet.publicKey,\r\n      newAccountPubkey: asks.publicKey,\r\n      lamports: await connection.getMinimumBalanceForRentExemption(65536 + 12),\r\n      space: 65536 + 12,\r\n      programId: dexProgramId,\r\n    }),\r\n    DexInstructions.initializeMarket({\r\n      market: market.publicKey,\r\n      requestQueue: requestQueue.publicKey,\r\n      eventQueue: eventQueue.publicKey,\r\n      bids: bids.publicKey,\r\n      asks: asks.publicKey,\r\n      baseVault: baseVault.publicKey,\r\n      quoteVault: quoteVault.publicKey,\r\n      baseMint,\r\n      quoteMint,\r\n      baseLotSize: new BN(baseLotSize),\r\n      quoteLotSize: new BN(quoteLotSize),\r\n      feeRateBps,\r\n      vaultSignerNonce,\r\n      quoteDustThreshold,\r\n      programId: dexProgramId,\r\n      authority: undefined,\r\n    }),\r\n  );\r\n\r\n  const signedTransactions = await signTransactions({\r\n    transactionsAndSigners: [\r\n      { transaction: tx1, signers: [baseVault, quoteVault] },\r\n      {\r\n        transaction: tx2,\r\n        signers: [market, requestQueue, eventQueue, bids, asks],\r\n      },\r\n    ],\r\n    wallet,\r\n    connection,\r\n  });\r\n  for (let signedTransaction of signedTransactions) {\r\n    await sendSignedTransaction({\r\n      signedTransaction,\r\n      connection,\r\n    });\r\n  }\r\n\r\n  return market.publicKey;\r\n}\r\n\r\nexport const getUnixTs = () => {\r\n  return new Date().getTime() / 1000;\r\n};\r\n\r\nconst DEFAULT_TIMEOUT = 15000;\r\n\r\nexport async function sendTransaction({\r\n  transaction,\r\n  wallet,\r\n  signers = [],\r\n  connection,\r\n  sendingMessage = 'Sending transaction...',\r\n  sentMessage = 'Transaction sent',\r\n  successMessage = 'Transaction confirmed',\r\n  timeout = DEFAULT_TIMEOUT,\r\n  sendNotification = true,\r\n}: {\r\n  transaction: Transaction;\r\n  wallet: WalletAdapter;\r\n  signers?: Array<Account>;\r\n  connection: Connection;\r\n  sendingMessage?: string;\r\n  sentMessage?: string;\r\n  successMessage?: string;\r\n  timeout?: number;\r\n  sendNotification?: boolean;\r\n}) {\r\n  const signedTransaction = await signTransaction({\r\n    transaction,\r\n    wallet,\r\n    signers,\r\n    connection,\r\n  });\r\n  return await sendSignedTransaction({\r\n    signedTransaction,\r\n    connection,\r\n    sendingMessage,\r\n    sentMessage,\r\n    successMessage,\r\n    timeout,\r\n    sendNotification,\r\n  });\r\n}\r\n\r\nexport async function signTransaction({\r\n  transaction,\r\n  wallet,\r\n  signers = [],\r\n  connection,\r\n}: {\r\n  transaction: Transaction;\r\n  wallet: WalletAdapter;\r\n  signers?: Array<Account>;\r\n  connection: Connection;\r\n}) {\r\n  transaction.recentBlockhash = (\r\n    await connection.getRecentBlockhash('max')\r\n  ).blockhash;\r\n  transaction.setSigners(wallet.publicKey, ...signers.map((s) => s.publicKey));\r\n  if (signers.length > 0) {\r\n    transaction.partialSign(...signers);\r\n  }\r\n  return await wallet.signTransaction(transaction);\r\n}\r\n\r\nexport async function signTransactions({\r\n  transactionsAndSigners,\r\n  wallet,\r\n  connection,\r\n}: {\r\n  transactionsAndSigners: {\r\n    transaction: Transaction;\r\n    signers?: Array<Account>;\r\n  }[];\r\n  wallet: WalletAdapter;\r\n  connection: Connection;\r\n}) {\r\n  const blockhash = (await connection.getRecentBlockhash('max')).blockhash;\r\n  transactionsAndSigners.forEach(({ transaction, signers = [] }) => {\r\n    transaction.recentBlockhash = blockhash;\r\n    transaction.setSigners(\r\n      wallet.publicKey,\r\n      ...signers.map((s) => s.publicKey),\r\n    );\r\n    if (signers?.length > 0) {\r\n      transaction.partialSign(...signers);\r\n    }\r\n  });\r\n  return await wallet.signAllTransactions(\r\n    transactionsAndSigners.map(({ transaction }) => transaction),\r\n  );\r\n}\r\n\r\nexport async function sendSignedTransaction({\r\n  signedTransaction,\r\n  connection,\r\n  sendingMessage = 'Sending transaction...',\r\n  sentMessage = 'Transaction sent',\r\n  successMessage = 'Transaction confirmed',\r\n  timeout = DEFAULT_TIMEOUT,\r\n  sendNotification = true,\r\n}: {\r\n  signedTransaction: Transaction;\r\n  connection: Connection;\r\n  sendingMessage?: string;\r\n  sentMessage?: string;\r\n  successMessage?: string;\r\n  timeout?: number;\r\n  sendNotification?: boolean;\r\n}): Promise<string> {\r\n  const rawTransaction = signedTransaction.serialize();\r\n  const startTime = getUnixTs();\r\n  if (sendNotification) {\r\n    notify({ message: sendingMessage });\r\n  }\r\n  const txid: TransactionSignature = await connection.sendRawTransaction(\r\n    rawTransaction,\r\n    {\r\n      skipPreflight: true,\r\n    },\r\n  );\r\n  if (sendNotification) {\r\n    notify({ message: sentMessage, type: 'success', txid });\r\n  }\r\n\r\n  console.log('Started awaiting confirmation for', txid);\r\n\r\n  let done = false;\r\n  (async () => {\r\n    while (!done && getUnixTs() - startTime < timeout) {\r\n      connection.sendRawTransaction(rawTransaction, {\r\n        skipPreflight: true,\r\n      });\r\n      await sleep(300);\r\n    }\r\n  })();\r\n  try {\r\n    await awaitTransactionSignatureConfirmation(txid, timeout, connection);\r\n  } catch (err) {\r\n    if (err.timeout) {\r\n      throw new Error('Timed out awaiting confirmation on transaction');\r\n    }\r\n    let simulateResult: SimulatedTransactionResponse | null = null;\r\n    try {\r\n      simulateResult = (\r\n        await simulateTransaction(connection, signedTransaction, 'single')\r\n      ).value;\r\n    } catch (e) { }\r\n    if (simulateResult && simulateResult.err) {\r\n      if (simulateResult.logs) {\r\n        for (let i = simulateResult.logs.length - 1; i >= 0; --i) {\r\n          const line = simulateResult.logs[i];\r\n          if (line.startsWith('Program log: ')) {\r\n            throw new Error(\r\n              'Transaction failed: ' + line.slice('Program log: '.length),\r\n            );\r\n          }\r\n        }\r\n      }\r\n      let parsedError;\r\n      if (\r\n        typeof simulateResult.err == 'object' &&\r\n        'InstructionError' in simulateResult.err\r\n      ) {\r\n        const parsedErrorInfo = parseInstructionErrorResponse(\r\n          signedTransaction,\r\n          simulateResult.err['InstructionError'],\r\n        );\r\n        parsedError = parsedErrorInfo.error;\r\n      } else {\r\n        parsedError = JSON.stringify(simulateResult.err);\r\n      }\r\n      throw new Error(parsedError);\r\n    }\r\n    throw new Error('Transaction failed');\r\n  } finally {\r\n    done = true;\r\n  }\r\n  if (sendNotification) {\r\n    notify({ message: successMessage, type: 'success', txid });\r\n  }\r\n\r\n  console.log('Latency', txid, getUnixTs() - startTime);\r\n  return txid;\r\n}\r\n\r\nasync function awaitTransactionSignatureConfirmation(\r\n  txid: TransactionSignature,\r\n  timeout: number,\r\n  connection: Connection,\r\n) {\r\n  let done = false;\r\n  const result = await new Promise((resolve, reject) => {\r\n    (async () => {\r\n      setTimeout(() => {\r\n        if (done) {\r\n          return;\r\n        }\r\n        done = true;\r\n        console.log('Timed out for txid', txid);\r\n        reject({ timeout: true });\r\n      }, timeout);\r\n      try {\r\n        connection.onSignature(\r\n          txid,\r\n          (result) => {\r\n            console.log('WS confirmed', txid, result);\r\n            done = true;\r\n            if (result.err) {\r\n              reject(result.err);\r\n            } else {\r\n              resolve(result);\r\n            }\r\n          },\r\n          'recent',\r\n        );\r\n        console.log('Set up WS connection', txid);\r\n      } catch (e) {\r\n        done = true;\r\n        console.log('WS error in setup', txid, e);\r\n      }\r\n      while (!done) {\r\n        // eslint-disable-next-line no-loop-func\r\n        (async () => {\r\n          try {\r\n            const signatureStatuses = await connection.getSignatureStatuses([\r\n              txid,\r\n            ]);\r\n            const result = signatureStatuses && signatureStatuses.value[0];\r\n            if (!done) {\r\n              if (!result) {\r\n                console.log('REST null result for', txid, result);\r\n              } else if (result.err) {\r\n                console.log('REST error for', txid, result);\r\n                done = true;\r\n                reject(result.err);\r\n              } else if (!result.confirmations) {\r\n                console.log('REST no confirmations for', txid, result);\r\n              } else {\r\n                console.log('REST confirmation for', txid, result);\r\n                done = true;\r\n                resolve(result);\r\n              }\r\n            }\r\n          } catch (e) {\r\n            if (!done) {\r\n              console.log('REST connection error: txid', txid, e);\r\n            }\r\n          }\r\n        })();\r\n        await sleep(300);\r\n      }\r\n    })();\r\n  });\r\n  done = true;\r\n  return result;\r\n}\r\n\r\nfunction mergeTransactions(transactions: (Transaction | undefined)[]) {\r\n  const transaction = new Transaction();\r\n  transactions\r\n    .filter((t): t is Transaction => t !== undefined)\r\n    .forEach((t) => {\r\n      transaction.add(t);\r\n    });\r\n  return transaction;\r\n}\r\n\r\nfunction jsonRpcResult(resultDescription: any) {\r\n  const jsonRpcVersion = struct.literal('2.0');\r\n  return struct.union([\r\n    struct({\r\n      jsonrpc: jsonRpcVersion,\r\n      id: 'string',\r\n      error: 'any',\r\n    }),\r\n    struct({\r\n      jsonrpc: jsonRpcVersion,\r\n      id: 'string',\r\n      error: 'null?',\r\n      result: resultDescription,\r\n    }),\r\n  ]);\r\n}\r\n\r\nfunction jsonRpcResultAndContext(resultDescription: any) {\r\n  return jsonRpcResult({\r\n    context: struct({\r\n      slot: 'number',\r\n    }),\r\n    value: resultDescription,\r\n  });\r\n}\r\n\r\nconst AccountInfoResult = struct({\r\n  executable: 'boolean',\r\n  owner: 'string',\r\n  lamports: 'number',\r\n  data: 'any',\r\n  rentEpoch: 'number?',\r\n});\r\n\r\nexport const GetMultipleAccountsAndContextRpcResult = jsonRpcResultAndContext(\r\n  struct.array([struct.union(['null', AccountInfoResult])]),\r\n);\r\n\r\nexport async function getMultipleSolanaAccounts(\r\n  connection: Connection,\r\n  publicKeys: PublicKey[],\r\n): Promise<\r\n  RpcResponseAndContext<{ [key: string]: AccountInfo<Buffer> | null }>\r\n> {\r\n  const args = [publicKeys.map((k) => k.toBase58()), { commitment: 'recent' }];\r\n  // @ts-ignore\r\n  const unsafeRes = await connection._rpcRequest('getMultipleAccounts', args);\r\n  const res = GetMultipleAccountsAndContextRpcResult(unsafeRes);\r\n  if (res.error) {\r\n    throw new Error(\r\n      'failed to get info about accounts ' +\r\n      publicKeys.map((k) => k.toBase58()).join(', ') +\r\n      ': ' +\r\n      res.error.message,\r\n    );\r\n  }\r\n  assert(typeof res.result !== 'undefined');\r\n  const accounts: Array<{\r\n    executable: any;\r\n    owner: PublicKey;\r\n    lamports: any;\r\n    data: Buffer;\r\n  } | null> = [];\r\n  for (const account of res.result.value) {\r\n    let value: {\r\n      executable: any;\r\n      owner: PublicKey;\r\n      lamports: any;\r\n      data: Buffer;\r\n    } | null = null;\r\n    if (res.result.value) {\r\n      const { executable, owner, lamports, data } = account;\r\n      assert(data[1] === 'base64');\r\n      value = {\r\n        executable,\r\n        owner: new PublicKey(owner),\r\n        lamports,\r\n        data: Buffer.from(data[0], 'base64'),\r\n      };\r\n    }\r\n    accounts.push(value);\r\n  }\r\n  return {\r\n    context: {\r\n      slot: res.result.context.slot,\r\n    },\r\n    value: Object.fromEntries(\r\n      accounts.map((account, i) => [publicKeys[i].toBase58(), account]),\r\n    ),\r\n  };\r\n}\r\n\r\n/** Copy of Connection.simulateTransaction that takes a commitment parameter. */\r\nasync function simulateTransaction(\r\n  connection: Connection,\r\n  transaction: Transaction,\r\n  commitment: Commitment,\r\n): Promise<RpcResponseAndContext<SimulatedTransactionResponse>> {\r\n  // @ts-ignore\r\n  transaction.recentBlockhash = await connection._recentBlockhash(\r\n    // @ts-ignore\r\n    connection._disableBlockhashCaching,\r\n  );\r\n\r\n  const signData = transaction.serializeMessage();\r\n  // @ts-ignore\r\n  const wireTransaction = transaction._serialize(signData);\r\n  const encodedTransaction = wireTransaction.toString('base64');\r\n  const config: any = { encoding: 'base64', commitment };\r\n  const args = [encodedTransaction, config];\r\n\r\n  // @ts-ignore\r\n  const res = await connection._rpcRequest('simulateTransaction', args);\r\n  if (res.error) {\r\n    throw new Error('failed to simulate transaction: ' + res.error.message);\r\n  }\r\n  return res.result;\r\n}\r\n","import * as BufferLayout from 'buffer-layout';\r\nimport {AccountInfo, Connection, PublicKey} from '@solana/web3.js';\r\nimport {WRAPPED_SOL_MINT} from '@project-serum/serum/lib/token-instructions';\r\nimport {TokenAccount} from './types';\r\nimport {TOKEN_MINTS} from '@project-serum/serum';\r\nimport {useAllMarkets, useCustomMarkets, useTokenAccounts} from './markets';\r\nimport {getMultipleSolanaAccounts} from './send';\r\nimport {useConnection} from './connection';\r\nimport {useAsyncData} from './fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\nimport BN from 'bn.js';\r\nimport {useMemo} from 'react';\r\n\r\nexport const ACCOUNT_LAYOUT = BufferLayout.struct([\r\n  BufferLayout.blob(32, 'mint'),\r\n  BufferLayout.blob(32, 'owner'),\r\n  BufferLayout.nu64('amount'),\r\n  BufferLayout.blob(93),\r\n]);\r\n\r\nexport const MINT_LAYOUT = BufferLayout.struct([\r\n  BufferLayout.blob(36),\r\n  BufferLayout.blob(8, 'supply'),\r\n  BufferLayout.u8('decimals'),\r\n  BufferLayout.u8('initialized'),\r\n  BufferLayout.blob(36),\r\n]);\r\n\r\nexport function parseTokenAccountData(\r\n  data: Buffer,\r\n): { mint: PublicKey; owner: PublicKey; amount: number } {\r\n  let { mint, owner, amount } = ACCOUNT_LAYOUT.decode(data);\r\n  return {\r\n    mint: new PublicKey(mint),\r\n    owner: new PublicKey(owner),\r\n    amount,\r\n  };\r\n}\r\n\r\nexport interface MintInfo {\r\n  decimals: number;\r\n  initialized: boolean;\r\n  supply: BN;\r\n}\r\n\r\nexport function parseTokenMintData(data): MintInfo {\r\n  let { decimals, initialized, supply } = MINT_LAYOUT.decode(data);\r\n  return {\r\n    decimals,\r\n    initialized: !!initialized,\r\n    supply: new BN(supply, 10, 'le'),\r\n  };\r\n}\r\n\r\nexport function getOwnedAccountsFilters(publicKey: PublicKey) {\r\n  return [\r\n    {\r\n      memcmp: {\r\n        offset: ACCOUNT_LAYOUT.offsetOf('owner'),\r\n        bytes: publicKey.toBase58(),\r\n      },\r\n    },\r\n    {\r\n      dataSize: ACCOUNT_LAYOUT.span,\r\n    },\r\n  ];\r\n}\r\n\r\nexport const TOKEN_PROGRAM_ID = new PublicKey(\r\n  'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA',\r\n);\r\n\r\nexport async function getOwnedTokenAccounts(\r\n  connection: Connection,\r\n  publicKey: PublicKey,\r\n): Promise<Array<{ publicKey: PublicKey; accountInfo: AccountInfo<Buffer> }>> {\r\n  let filters = getOwnedAccountsFilters(publicKey);\r\n  let resp = await connection.getProgramAccounts(\r\n    TOKEN_PROGRAM_ID,\r\n    {\r\n      filters,\r\n    },\r\n  );\r\n  return resp\r\n    .map(({ pubkey, account: { data, executable, owner, lamports } }) => ({\r\n      publicKey: new PublicKey(pubkey),\r\n      accountInfo: {\r\n        data,\r\n        executable,\r\n        owner: new PublicKey(owner),\r\n        lamports,\r\n      },\r\n    }))\r\n}\r\n\r\nexport async function getTokenAccountInfo(\r\n  connection: Connection,\r\n  ownerAddress: PublicKey,\r\n) {\r\n  let [splAccounts, account] = await Promise.all([\r\n    getOwnedTokenAccounts(connection, ownerAddress),\r\n    connection.getAccountInfo(ownerAddress),\r\n  ]);\r\n  const parsedSplAccounts: TokenAccount[] = splAccounts.map(\r\n    ({ publicKey, accountInfo }) => {\r\n      return {\r\n        pubkey: publicKey,\r\n        account: accountInfo,\r\n        effectiveMint: parseTokenAccountData(accountInfo.data).mint,\r\n      };\r\n    },\r\n  );\r\n  return parsedSplAccounts.concat({\r\n    pubkey: ownerAddress,\r\n    account,\r\n    effectiveMint: WRAPPED_SOL_MINT,\r\n  });\r\n}\r\n\r\n// todo: use this to map custom mints to custom tickers. Add functionality once custom markets store mints\r\nexport function useMintToTickers(): { [mint: string]: string } {\r\n  const { customMarkets } = useCustomMarkets();\r\n  return useMemo(() => {\r\n    return Object.fromEntries(\r\n      TOKEN_MINTS.map((mint) => [mint.address.toBase58(), mint.name]),\r\n    );\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [customMarkets.length]);\r\n}\r\n\r\nconst _VERY_SLOW_REFRESH_INTERVAL = 5000 * 1000;\r\n\r\n// todo: move this to using mints stored in static market infos once custom markets support that.\r\nexport function useMintInfos(): [\r\n  (\r\n    | {\r\n        [mintAddress: string]: {\r\n          decimals: number;\r\n          initialized: boolean;\r\n        } | null;\r\n      }\r\n    | null\r\n    | undefined\r\n  ),\r\n  boolean,\r\n] {\r\n  const connection = useConnection();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const [allMarkets] = useAllMarkets();\r\n\r\n  const allMints = (tokenAccounts || [])\r\n    .map((account) => account.effectiveMint)\r\n    .concat(\r\n      (allMarkets || []).map((marketInfo) => marketInfo.market.baseMintAddress),\r\n    )\r\n    .concat(\r\n      (allMarkets || []).map(\r\n        (marketInfo) => marketInfo.market.quoteMintAddress,\r\n      ),\r\n    );\r\n  const uniqueMints = [...new Set(allMints.map((mint) => mint.toBase58()))].map(\r\n    (stringMint) => new PublicKey(stringMint),\r\n  );\r\n\r\n  const getAllMintInfo = async () => {\r\n    const mintInfos = await getMultipleSolanaAccounts(connection, uniqueMints);\r\n    return Object.fromEntries(\r\n      Object.entries(mintInfos.value).map(([key, accountInfo]) => [\r\n        key,\r\n        accountInfo && parseTokenMintData(accountInfo.data),\r\n      ]),\r\n    );\r\n  };\r\n\r\n  return useAsyncData(\r\n    getAllMintInfo,\r\n    tuple(\r\n      'getAllMintInfo',\r\n      connection,\r\n      (tokenAccounts || []).length,\r\n      (allMarkets || []).length,\r\n    ),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n","import { BonfidaTrade } from './types';\r\n\r\nexport default class BonfidaApi {\r\n  static URL: string = 'https://serum-api.bonfida.com/';\r\n\r\n  static async get(path: string) {\r\n    try {\r\n      const response = await fetch(this.URL + path);\r\n      if (response.ok) {\r\n        const responseJson = await response.json();\r\n        return responseJson.success ? responseJson.data : null;\r\n      }\r\n    } catch (err) {\r\n      console.log(`Error fetching from Bonfida API ${path}: ${err}`);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  static async getRecentTrades(\r\n    marketAddress: string,\r\n  ): Promise<BonfidaTrade[] | null> {\r\n    return BonfidaApi.get(`trades/address/${marketAddress}`);\r\n  }\r\n}\r\n\r\nexport const BONFIDA_DATA_FEED = 'https://serum-api.bonfida.com/tv';\r\n","import {Market, MARKETS, OpenOrders, Orderbook, TOKEN_MINTS, TokenInstructions,} from '@project-serum/serum';\r\nimport {PublicKey} from '@solana/web3.js';\r\nimport React, {useContext, useEffect, useState} from 'react';\r\nimport {divideBnToNumber, floorToDecimal, getTokenMultiplierFromDecimals, sleep, useLocalStorageState,} from './utils';\r\nimport {refreshCache, useAsyncData} from './fetch-loop';\r\nimport {useAccountData, useAccountInfo, useConnection} from './connection';\r\nimport {useWallet} from './wallet';\r\nimport tuple from 'immutable-tuple';\r\nimport {notify} from './notifications';\r\nimport BN from 'bn.js';\r\nimport {getTokenAccountInfo, parseTokenAccountData, useMintInfos,} from './tokens';\r\nimport {\r\n  Balances,\r\n  CustomMarketInfo,\r\n  DeprecatedOpenOrdersBalances,\r\n  FullMarketInfo,\r\n  MarketContextValues,\r\n  MarketInfo,\r\n  OrderWithMarketAndMarketName,\r\n  SelectedTokenAccounts,\r\n  TokenAccount,\r\n} from './types';\r\nimport {WRAPPED_SOL_MINT} from '@project-serum/serum/lib/token-instructions';\r\nimport {Order} from '@project-serum/serum/lib/market';\r\nimport BonfidaApi from './bonfidaConnector';\r\n\r\n// Used in debugging, should be false in production\r\nconst _IGNORE_DEPRECATED = false;\r\n\r\nexport const USE_MARKETS: MarketInfo[] = _IGNORE_DEPRECATED\r\n  ? MARKETS.map((m) => ({ ...m, deprecated: false }))\r\n  : MARKETS;\r\n\r\nexport function useMarketsList() {\r\n  return USE_MARKETS.filter(({ name, deprecated }) => !deprecated && !process.env.REACT_APP_EXCLUDE_MARKETS?.includes(name));\r\n}\r\n\r\nexport function useAllMarkets() {\r\n  const connection = useConnection();\r\n  const { customMarkets } = useCustomMarkets();\r\n\r\n  const getAllMarkets = async () => {\r\n    const markets: Array<{\r\n      market: Market;\r\n      marketName: string;\r\n      programId: PublicKey;\r\n    } | null> = await Promise.all(\r\n      getMarketInfos(customMarkets).map(async (marketInfo) => {\r\n        try {\r\n          const market = await Market.load(\r\n            connection,\r\n            marketInfo.address,\r\n            {},\r\n            marketInfo.programId,\r\n          );\r\n          return {\r\n            market,\r\n            marketName: marketInfo.name,\r\n            programId: marketInfo.programId,\r\n          };\r\n        } catch (e) {\r\n          notify({\r\n            message: 'Error loading all market',\r\n            description: e.message,\r\n            type: 'error',\r\n          });\r\n          return null;\r\n        }\r\n      }),\r\n    );\r\n    return markets.filter(\r\n      (m): m is { market: Market; marketName: string; programId: PublicKey } =>\r\n        !!m,\r\n    );\r\n  };\r\n  return useAsyncData(\r\n    getAllMarkets,\r\n    tuple('getAllMarkets', customMarkets.length, connection),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useUnmigratedOpenOrdersAccounts() {\r\n  const connection = useConnection();\r\n  const { wallet } = useWallet();\r\n\r\n  async function getUnmigratedOpenOrdersAccounts(): Promise<OpenOrders[]> {\r\n    if (!wallet || !connection || !wallet.publicKey) {\r\n      return [];\r\n    }\r\n    console.log('refreshing useUnmigratedOpenOrdersAccounts');\r\n    let deprecatedOpenOrdersAccounts: OpenOrders[] = [];\r\n    const deprecatedProgramIds = Array.from(\r\n      new Set(\r\n        USE_MARKETS.filter(\r\n          ({ deprecated }) => deprecated,\r\n        ).map(({ programId }) => programId.toBase58()),\r\n      ),\r\n    ).map((publicKeyStr) => new PublicKey(publicKeyStr));\r\n    let programId: PublicKey;\r\n    for (programId of deprecatedProgramIds) {\r\n      try {\r\n        const openOrdersAccounts = await OpenOrders.findForOwner(\r\n          connection,\r\n          wallet.publicKey,\r\n          programId,\r\n        );\r\n        deprecatedOpenOrdersAccounts = deprecatedOpenOrdersAccounts.concat(\r\n          openOrdersAccounts\r\n            .filter(\r\n              (openOrders) =>\r\n                openOrders.baseTokenTotal.toNumber() ||\r\n                openOrders.quoteTokenTotal.toNumber(),\r\n            )\r\n            .filter((openOrders) =>\r\n              USE_MARKETS.some(\r\n                (market) =>\r\n                  market.deprecated && market.address.equals(openOrders.market),\r\n              ),\r\n            ),\r\n        );\r\n      } catch (e) {\r\n        console.log(\r\n          'Error loading deprecated markets',\r\n          programId?.toBase58(),\r\n          e.message,\r\n        );\r\n      }\r\n    }\r\n    // Maybe sort\r\n    return deprecatedOpenOrdersAccounts;\r\n  }\r\n\r\n  const cacheKey = tuple(\r\n    'getUnmigratedOpenOrdersAccounts',\r\n    connection,\r\n    wallet?.publicKey?.toBase58(),\r\n  );\r\n  const [accounts] = useAsyncData(getUnmigratedOpenOrdersAccounts, cacheKey, {\r\n    refreshInterval: _VERY_SLOW_REFRESH_INTERVAL,\r\n  });\r\n\r\n  return {\r\n    accounts,\r\n    refresh: (clearCache: boolean) => refreshCache(cacheKey, clearCache),\r\n  };\r\n}\r\n\r\nconst MarketContext: React.Context<null | MarketContextValues> = React.createContext<null | MarketContextValues>(\r\n  null,\r\n);\r\n\r\nconst _VERY_SLOW_REFRESH_INTERVAL = 5000 * 1000;\r\n\r\n// For things that don't really change\r\nconst _SLOW_REFRESH_INTERVAL = 5 * 1000;\r\n\r\n// For things that change frequently\r\nconst _FAST_REFRESH_INTERVAL = 1000;\r\n\r\nexport const DEFAULT_MARKET = USE_MARKETS.find(\r\n  ({ name, deprecated }) => name === 'SF/USDC' && !deprecated,\r\n);\r\n\r\nexport function getMarketDetails(\r\n  market: Market | undefined | null,\r\n  customMarkets: CustomMarketInfo[],\r\n): FullMarketInfo {\r\n  if (!market) {\r\n    return {};\r\n  }\r\n  const marketInfos = getMarketInfos(customMarkets);\r\n  const marketInfo = marketInfos.find((otherMarket) =>\r\n    otherMarket.address.equals(market.address),\r\n  );\r\n  const baseCurrency =\r\n    (market?.baseMintAddress &&\r\n      TOKEN_MINTS.find((token) => token.address.equals(market.baseMintAddress))\r\n        ?.name) ||\r\n    (marketInfo?.baseLabel && `${marketInfo?.baseLabel}*`) ||\r\n    'UNKNOWN';\r\n  const quoteCurrency =\r\n    (market?.quoteMintAddress &&\r\n      TOKEN_MINTS.find((token) => token.address.equals(market.quoteMintAddress))\r\n        ?.name) ||\r\n    (marketInfo?.quoteLabel && `${marketInfo?.quoteLabel}*`) ||\r\n    'UNKNOWN';\r\n\r\n  return {\r\n    ...marketInfo,\r\n    marketName: marketInfo?.name,\r\n    baseCurrency,\r\n    quoteCurrency,\r\n    marketInfo,\r\n  };\r\n}\r\n\r\nexport function useCustomMarkets() {\r\n  const [customMarkets, setCustomMarkets] = useLocalStorageState<\r\n    CustomMarketInfo[]\r\n  >('customMarkets', []);\r\n  return { customMarkets, setCustomMarkets };\r\n}\r\n\r\nexport function MarketProvider({ marketAddress, setMarketAddress, children }) {\r\n  const { customMarkets, setCustomMarkets } = useCustomMarkets();\r\n\r\n  const address = marketAddress && new PublicKey(marketAddress);\r\n  const connection = useConnection();\r\n  const marketInfos = getMarketInfos(customMarkets);\r\n  const marketInfo =\r\n    address && marketInfos.find((market) => market.address.equals(address));\r\n\r\n  // Replace existing market with a non-deprecated one on first load\r\n  useEffect(() => {\r\n    if (marketInfo && marketInfo.deprecated) {\r\n      console.log('Switching markets from deprecated', marketInfo);\r\n      if (DEFAULT_MARKET) {\r\n        setMarketAddress(DEFAULT_MARKET.address.toBase58());\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const [market, setMarket] = useState<Market | null>();\r\n  useEffect(() => {\r\n    if (\r\n      market &&\r\n      marketInfo &&\r\n      // @ts-ignore\r\n      market._decoded.ownAddress?.equals(marketInfo?.address)\r\n    ) {\r\n      return;\r\n    }\r\n    setMarket(null);\r\n    if (!marketInfo || !marketInfo.address) {\r\n      notify({\r\n        message: 'Error loading market',\r\n        description: 'Please select a market from the dropdown',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    Market.load(connection, marketInfo.address, {}, marketInfo.programId)\r\n      .then(setMarket)\r\n      .catch((e) =>\r\n        notify({\r\n          message: 'Error loading market',\r\n          description: e.message,\r\n          type: 'error',\r\n        }),\r\n      );\r\n    // eslint-disable-next-line\r\n  }, [connection, marketInfo]);\r\n\r\n  return (\r\n    <MarketContext.Provider\r\n      value={{\r\n        market,\r\n        ...getMarketDetails(market, customMarkets),\r\n        setMarketAddress,\r\n        customMarkets,\r\n        setCustomMarkets,\r\n      }}\r\n    >\r\n      {children}\r\n    </MarketContext.Provider>\r\n  );\r\n}\r\n\r\nexport function getTradePageUrl(marketAddress?: string) {\r\n  if (!marketAddress) {\r\n    const saved = localStorage.getItem('marketAddress');\r\n    if (saved) {\r\n      marketAddress = JSON.parse(saved);\r\n    }\r\n    marketAddress = marketAddress || DEFAULT_MARKET?.address.toBase58() || '';\r\n  }\r\n  return `/market/${marketAddress}`;\r\n}\r\n\r\nexport function useSelectedTokenAccounts(): [\r\n  SelectedTokenAccounts,\r\n  (newSelectedTokenAccounts: SelectedTokenAccounts) => void,\r\n] {\r\n  const [\r\n    selectedTokenAccounts,\r\n    setSelectedTokenAccounts,\r\n  ] = useLocalStorageState<SelectedTokenAccounts>('selectedTokenAccounts', {});\r\n  return [selectedTokenAccounts, setSelectedTokenAccounts];\r\n}\r\n\r\nexport function useMarket() {\r\n  const context = useContext(MarketContext);\r\n  if (!context) {\r\n    throw new Error('Missing market context');\r\n  }\r\n  return context;\r\n}\r\n\r\nexport function useMarkPrice() {\r\n  const [markPrice, setMarkPrice] = useState<null | number>(null);\r\n\r\n  const [orderbook] = useOrderbook();\r\n  const trades = useTrades();\r\n\r\n  useEffect(() => {\r\n    let bb = orderbook?.bids?.length > 0 && Number(orderbook.bids[0][0]);\r\n    let ba = orderbook?.asks?.length > 0 && Number(orderbook.asks[0][0]);\r\n    let last = trades && trades.length > 0 && trades[0].price;\r\n\r\n    let markPrice =\r\n      bb && ba\r\n        ? last\r\n          ? [bb, ba, last].sort((a, b) => a - b)[1]\r\n          : (bb + ba) / 2\r\n        : null;\r\n\r\n    setMarkPrice(markPrice);\r\n  }, [orderbook, trades]);\r\n\r\n  return markPrice;\r\n}\r\n\r\nexport function _useUnfilteredTrades(limit = 10000) {\r\n  const { market } = useMarket();\r\n  const connection = useConnection();\r\n  async function getUnfilteredTrades(): Promise<any[] | null> {\r\n    if (!market || !connection) {\r\n      return null;\r\n    }\r\n    return await market.loadFills(connection, limit);\r\n  }\r\n  const [trades] = useAsyncData(\r\n    getUnfilteredTrades,\r\n    tuple('getUnfilteredTrades', market, connection),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n  return trades;\r\n  // NOTE: For now, websocket is too expensive since the event queue is large\r\n  // and updates very frequently\r\n\r\n  // let data = useAccountData(market && market._decoded.eventQueue);\r\n  // if (!data) {\r\n  //   return null;\r\n  // }\r\n  // const events = decodeEventQueue(data, limit);\r\n  // return events\r\n  //   .filter((event) => event.eventFlags.fill && event.nativeQuantityPaid.gtn(0))\r\n  //   .map(market.parseFillEvent.bind(market));\r\n}\r\n\r\nexport function useBonfidaTrades() {\r\n  const { market } = useMarket();\r\n  const marketAddress = market?.address.toBase58();\r\n\r\n  async function getBonfidaTrades() {\r\n    if (!marketAddress) {\r\n      return null;\r\n    }\r\n    return await BonfidaApi.getRecentTrades(marketAddress);\r\n  }\r\n\r\n  return useAsyncData(\r\n    getBonfidaTrades,\r\n    tuple('getBonfidaTrades', marketAddress),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n    false,\r\n  );\r\n}\r\n\r\nexport function useOrderbookAccounts() {\r\n  const { market } = useMarket();\r\n  // @ts-ignore\r\n  let bidData = useAccountData(market && market._decoded.bids);\r\n  // @ts-ignore\r\n  let askData = useAccountData(market && market._decoded.asks);\r\n  return {\r\n    bidOrderbook: market && bidData ? Orderbook.decode(market, bidData) : null,\r\n    askOrderbook: market && askData ? Orderbook.decode(market, askData) : null,\r\n  };\r\n}\r\n\r\nexport function useOrderbook(\r\n  depth = 20,\r\n): [{ bids: number[][]; asks: number[][] }, boolean] {\r\n  const { bidOrderbook, askOrderbook } = useOrderbookAccounts();\r\n  const { market } = useMarket();\r\n  const bids =\r\n    !bidOrderbook || !market\r\n      ? []\r\n      : bidOrderbook.getL2(depth).map(([price, size]) => [price, size]);\r\n  const asks =\r\n    !askOrderbook || !market\r\n      ? []\r\n      : askOrderbook.getL2(depth).map(([price, size]) => [price, size]);\r\n  return [{ bids, asks }, !!bids || !!asks];\r\n}\r\n\r\n// Want the balances table to be fast-updating, dont want open orders to flicker\r\n// TODO: Update to use websocket\r\nexport function useOpenOrdersAccounts(fast = false) {\r\n  const { market } = useMarket();\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  async function getOpenOrdersAccounts() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!market) {\r\n      return null;\r\n    }\r\n    return await market.findOpenOrdersAccountsForOwner(\r\n      connection,\r\n      wallet.publicKey,\r\n    );\r\n  }\r\n  return useAsyncData<OpenOrders[] | null>(\r\n    getOpenOrdersAccounts,\r\n    tuple('getOpenOrdersAccounts', wallet, market, connected),\r\n    { refreshInterval: fast ? _FAST_REFRESH_INTERVAL : _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useSelectedOpenOrdersAccount(fast = false) {\r\n  const [accounts] = useOpenOrdersAccounts(fast);\r\n  if (!accounts) {\r\n    return null;\r\n  }\r\n  return accounts[0];\r\n}\r\n\r\nexport function useTokenAccounts(): [\r\n  TokenAccount[] | null | undefined,\r\n  boolean,\r\n] {\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  async function getTokenAccounts() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    return await getTokenAccountInfo(connection, wallet.publicKey);\r\n  }\r\n  return useAsyncData(\r\n    getTokenAccounts,\r\n    tuple('getTokenAccounts', wallet, connected),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function getSelectedTokenAccountForMint(\r\n  accounts: TokenAccount[] | undefined | null,\r\n  mint: PublicKey | undefined,\r\n  selectedPubKey?: string | PublicKey | null,\r\n) {\r\n  if (!accounts || !mint) {\r\n    return null;\r\n  }\r\n  const filtered = accounts.filter(\r\n    ({ effectiveMint, pubkey }) =>\r\n      mint.equals(effectiveMint) &&\r\n      (!selectedPubKey ||\r\n        (typeof selectedPubKey === 'string'\r\n          ? selectedPubKey\r\n          : selectedPubKey.toBase58()) === pubkey.toBase58()),\r\n  );\r\n  return filtered && filtered[0];\r\n}\r\n\r\nexport function useSelectedQuoteCurrencyAccount() {\r\n  const [accounts] = useTokenAccounts();\r\n  const { market } = useMarket();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const mintAddress = market?.quoteMintAddress;\r\n  return getSelectedTokenAccountForMint(\r\n    accounts,\r\n    mintAddress,\r\n    mintAddress && selectedTokenAccounts[mintAddress.toBase58()],\r\n  );\r\n}\r\n\r\nexport function useSelectedBaseCurrencyAccount() {\r\n  const [accounts] = useTokenAccounts();\r\n  const { market } = useMarket();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const mintAddress = market?.baseMintAddress;\r\n  return getSelectedTokenAccountForMint(\r\n    accounts,\r\n    mintAddress,\r\n    mintAddress && selectedTokenAccounts[mintAddress.toBase58()],\r\n  );\r\n}\r\n\r\n// TODO: Update to use websocket\r\nexport function useSelectedQuoteCurrencyBalances() {\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const { market } = useMarket();\r\n  const [accountInfo, loaded] = useAccountInfo(quoteCurrencyAccount?.pubkey);\r\n  if (!market || !quoteCurrencyAccount || !loaded || !accountInfo) {\r\n    return null;\r\n  }\r\n  if (market.quoteMintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT)) {\r\n    return accountInfo?.lamports / 1e9 ?? 0;\r\n  }\r\n  return market.quoteSplSizeToNumber(\r\n    new BN(accountInfo.data.slice(64, 72), 10, 'le'),\r\n  );\r\n}\r\n\r\n// TODO: Update to use websocket\r\nexport function useSelectedBaseCurrencyBalances() {\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const { market } = useMarket();\r\n  const [accountInfo, loaded] = useAccountInfo(baseCurrencyAccount?.pubkey);\r\n  if (!market || !baseCurrencyAccount || !loaded || !accountInfo) {\r\n    return null;\r\n  }\r\n  if (market.baseMintAddress.equals(TokenInstructions.WRAPPED_SOL_MINT)) {\r\n    return accountInfo?.lamports / 1e9 ?? 0;\r\n  }\r\n  return market.baseSplSizeToNumber(\r\n    new BN(accountInfo.data.slice(64, 72), 10, 'le'),\r\n  );\r\n}\r\n\r\nexport function useOpenOrders() {\r\n  const { market, marketName } = useMarket();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount();\r\n  const { bidOrderbook, askOrderbook } = useOrderbookAccounts();\r\n  if (!market || !openOrdersAccount || !bidOrderbook || !askOrderbook) {\r\n    return null;\r\n  }\r\n  return market\r\n    .filterForOpenOrders(bidOrderbook, askOrderbook, [openOrdersAccount])\r\n    .map((order) => ({ ...order, marketName, market }));\r\n}\r\n\r\nexport function useTrades(limit = 100) {\r\n  const trades = _useUnfilteredTrades(limit);\r\n  if (!trades) {\r\n    return null;\r\n  }\r\n  // Until partial fills are each given their own fill, use maker fills\r\n  return trades\r\n    .filter(({ eventFlags }) => eventFlags.maker)\r\n    .map((trade) => ({\r\n      ...trade,\r\n      side: trade.side === 'buy' ? 'sell' : 'buy',\r\n    }));\r\n}\r\n\r\nexport function useLocallyStoredFeeDiscountKey(): {\r\n  storedFeeDiscountKey: PublicKey | undefined;\r\n  setStoredFeeDiscountKey: (key: string) => void;\r\n} {\r\n  const [\r\n    storedFeeDiscountKey,\r\n    setStoredFeeDiscountKey,\r\n  ] = useLocalStorageState<string>(`feeDiscountKey`, undefined);\r\n  return {\r\n    storedFeeDiscountKey: storedFeeDiscountKey\r\n      ? new PublicKey(storedFeeDiscountKey)\r\n      : undefined,\r\n    setStoredFeeDiscountKey,\r\n  };\r\n}\r\n\r\nexport function useFeeDiscountKeys(): [\r\n  (\r\n    | {\r\n        pubkey: PublicKey;\r\n        feeTier: number;\r\n        balance: number;\r\n        mint: PublicKey;\r\n      }[]\r\n    | null\r\n    | undefined\r\n  ),\r\n  boolean,\r\n] {\r\n  const { market } = useMarket();\r\n  const { connected, wallet } = useWallet();\r\n  const connection = useConnection();\r\n  const { setStoredFeeDiscountKey } = useLocallyStoredFeeDiscountKey();\r\n  let getFeeDiscountKeys = async () => {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!market) {\r\n      return null;\r\n    }\r\n    const feeDiscountKey = await market.findFeeDiscountKeys(\r\n      connection,\r\n      wallet.publicKey,\r\n    );\r\n    if (feeDiscountKey) {\r\n      setStoredFeeDiscountKey(feeDiscountKey[0].pubkey.toBase58());\r\n    }\r\n    return feeDiscountKey;\r\n  };\r\n  return useAsyncData(\r\n    getFeeDiscountKeys,\r\n    tuple('getFeeDiscountKeys', wallet, market, connected),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useFills(limit = 100) {\r\n  const { marketName } = useMarket();\r\n  const fills = _useUnfilteredTrades(limit);\r\n  const [openOrdersAccounts] = useOpenOrdersAccounts();\r\n  if (!openOrdersAccounts || openOrdersAccounts.length === 0) {\r\n    return null;\r\n  }\r\n  if (!fills) {\r\n    return null;\r\n  }\r\n  return fills\r\n    .filter((fill) =>\r\n      openOrdersAccounts.some((openOrdersAccount) =>\r\n        fill.openOrders.equals(openOrdersAccount.publicKey),\r\n      ),\r\n    )\r\n    .map((fill) => ({ ...fill, marketName }));\r\n}\r\n\r\nexport function useAllOpenOrdersAccounts() {\r\n  const { wallet, connected } = useWallet();\r\n  const connection = useConnection();\r\n  const marketInfos = useMarketInfos();\r\n  const programIds = [\r\n    ...new Set(marketInfos.map((info) => info.programId.toBase58())),\r\n  ].map((stringProgramId) => new PublicKey(stringProgramId));\r\n\r\n  const getAllOpenOrdersAccounts = async () => {\r\n    if (!connected || !wallet) {\r\n      return [];\r\n    }\r\n    return (\r\n      await Promise.all(\r\n        programIds.map((programId) =>\r\n          OpenOrders.findForOwner(connection, wallet.publicKey, programId),\r\n        ),\r\n      )\r\n    ).flat();\r\n  };\r\n  return useAsyncData(\r\n    getAllOpenOrdersAccounts,\r\n    tuple(\r\n      'getAllOpenOrdersAccounts',\r\n      connection,\r\n      connected,\r\n      wallet?.publicKey?.toBase58(),\r\n      marketInfos.length,\r\n      (programIds || []).length,\r\n    ),\r\n    { refreshInterval: _SLOW_REFRESH_INTERVAL },\r\n  );\r\n}\r\n\r\nexport function useAllOpenOrdersBalances() {\r\n  const [\r\n    openOrdersAccounts,\r\n    loadedOpenOrdersAccounts,\r\n  ] = useAllOpenOrdersAccounts();\r\n  const [mintInfos, mintInfosConnected] = useMintInfos();\r\n  const [allMarkets] = useAllMarkets();\r\n  if (!loadedOpenOrdersAccounts || !mintInfosConnected) {\r\n    return {};\r\n  }\r\n\r\n  const marketsByAddress = Object.fromEntries(\r\n    (allMarkets || []).map((m) => [m.market.address.toBase58(), m]),\r\n  );\r\n  const openOrdersBalances: {\r\n    [mint: string]: { market: PublicKey; free: number; total: number }[];\r\n  } = {};\r\n  for (let account of openOrdersAccounts || []) {\r\n    const marketInfo = marketsByAddress[account.market.toBase58()];\r\n    const baseMint = marketInfo?.market.baseMintAddress.toBase58();\r\n    const quoteMint = marketInfo?.market.quoteMintAddress.toBase58();\r\n    if (!(baseMint in openOrdersBalances)) {\r\n      openOrdersBalances[baseMint] = [];\r\n    }\r\n    if (!(quoteMint in openOrdersBalances)) {\r\n      openOrdersBalances[quoteMint] = [];\r\n    }\r\n\r\n    const baseMintInfo = mintInfos && mintInfos[baseMint];\r\n    const baseFree = divideBnToNumber(\r\n      new BN(account.baseTokenFree),\r\n      getTokenMultiplierFromDecimals(baseMintInfo?.decimals || 0),\r\n    );\r\n    const baseTotal = divideBnToNumber(\r\n      new BN(account.baseTokenTotal),\r\n      getTokenMultiplierFromDecimals(baseMintInfo?.decimals || 0),\r\n    );\r\n    const quoteMintInfo = mintInfos && mintInfos[quoteMint];\r\n    const quoteFree = divideBnToNumber(\r\n      new BN(account.quoteTokenFree),\r\n      getTokenMultiplierFromDecimals(quoteMintInfo?.decimals || 0),\r\n    );\r\n    const quoteTotal = divideBnToNumber(\r\n      new BN(account.quoteTokenTotal),\r\n      getTokenMultiplierFromDecimals(quoteMintInfo?.decimals || 0),\r\n    );\r\n\r\n    openOrdersBalances[baseMint].push({\r\n      market: account.market,\r\n      free: baseFree,\r\n      total: baseTotal,\r\n    });\r\n    openOrdersBalances[quoteMint].push({\r\n      market: account.market,\r\n      free: quoteFree,\r\n      total: quoteTotal,\r\n    });\r\n  }\r\n  return openOrdersBalances;\r\n}\r\n\r\nexport const useAllOpenOrders = (): {\r\n  openOrders: { orders: Order[]; marketAddress: string }[] | null | undefined;\r\n  loaded: boolean;\r\n  refreshOpenOrders: () => void;\r\n} => {\r\n  const connection = useConnection();\r\n  const { connected, wallet } = useWallet();\r\n  const [loaded, setLoaded] = useState(false);\r\n  const [refresh, setRefresh] = useState(0);\r\n  const [openOrders, setOpenOrders] = useState<\r\n    { orders: Order[]; marketAddress: string }[] | null | undefined\r\n  >(null);\r\n  const [lastRefresh, setLastRefresh] = useState(0);\r\n\r\n  const refreshOpenOrders = () => {\r\n    if (new Date().getTime() - lastRefresh > 10 * 1000) {\r\n      setRefresh((prev) => prev + 1);\r\n    } else {\r\n      console.log('not refreshing');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (connected && wallet) {\r\n      const getAllOpenOrders = async () => {\r\n        setLoaded(false);\r\n        const _openOrders: { orders: Order[]; marketAddress: string }[] = [];\r\n        const getOpenOrdersForMarket = async (marketInfo: MarketInfo) => {\r\n          await sleep(1000 * Math.random()); // Try not to hit rate limit\r\n          try {\r\n            const market = await Market.load(\r\n              connection,\r\n              marketInfo.address,\r\n              undefined,\r\n              marketInfo.programId,\r\n            );\r\n            const orders = await market.loadOrdersForOwner(\r\n              connection,\r\n              wallet?.publicKey,\r\n              30000,\r\n            );\r\n            _openOrders.push({\r\n              orders: orders,\r\n              marketAddress: marketInfo.address.toBase58(),\r\n            });\r\n          } catch (e) {\r\n            console.warn(`Error loading open order ${marketInfo.name} - ${e}`);\r\n          }\r\n        };\r\n        await Promise.all(USE_MARKETS.map((m) => getOpenOrdersForMarket(m)));\r\n        setOpenOrders(_openOrders);\r\n        setLastRefresh(new Date().getTime());\r\n        setLoaded(true);\r\n      };\r\n      getAllOpenOrders();\r\n    }\r\n  }, [connection, connected, wallet, refresh]);\r\n  return {\r\n    openOrders: openOrders,\r\n    loaded: loaded,\r\n    refreshOpenOrders: refreshOpenOrders,\r\n  };\r\n};\r\n\r\nexport function useBalances(): Balances[] {\r\n  const baseCurrencyBalances = useSelectedBaseCurrencyBalances();\r\n  const quoteCurrencyBalances = useSelectedQuoteCurrencyBalances();\r\n  const openOrders = useSelectedOpenOrdersAccount(true);\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const baseExists =\r\n    openOrders && openOrders.baseTokenTotal && openOrders.baseTokenFree;\r\n  const quoteExists =\r\n    openOrders && openOrders.quoteTokenTotal && openOrders.quoteTokenFree;\r\n  if (\r\n    baseCurrency === 'UNKNOWN' ||\r\n    quoteCurrency === 'UNKNOWN' ||\r\n    !baseCurrency ||\r\n    !quoteCurrency\r\n  ) {\r\n    return [];\r\n  }\r\n  return [\r\n    {\r\n      market,\r\n      key: `${baseCurrency}${quoteCurrency}${baseCurrency}`,\r\n      coin: baseCurrency,\r\n      wallet: baseCurrencyBalances,\r\n      orders:\r\n        baseExists && market && openOrders\r\n          ? market.baseSplSizeToNumber(\r\n              openOrders.baseTokenTotal.sub(openOrders.baseTokenFree),\r\n            )\r\n          : null,\r\n      openOrders,\r\n      unsettled:\r\n        baseExists && market && openOrders\r\n          ? market.baseSplSizeToNumber(openOrders.baseTokenFree)\r\n          : null,\r\n    },\r\n    {\r\n      market,\r\n      key: `${quoteCurrency}${baseCurrency}${quoteCurrency}`,\r\n      coin: quoteCurrency,\r\n      wallet: quoteCurrencyBalances,\r\n      openOrders,\r\n      orders:\r\n        quoteExists && market && openOrders\r\n          ? market.quoteSplSizeToNumber(\r\n              openOrders.quoteTokenTotal.sub(openOrders.quoteTokenFree),\r\n            )\r\n          : null,\r\n      unsettled:\r\n        quoteExists && market && openOrders\r\n          ? market.quoteSplSizeToNumber(openOrders.quoteTokenFree)\r\n          : null,\r\n    },\r\n  ];\r\n}\r\n\r\nexport function useWalletBalancesForAllMarkets(): {\r\n  mint: string;\r\n  balance: number;\r\n}[] {\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const { connected } = useWallet();\r\n  const [mintInfos, mintInfosConnected] = useMintInfos();\r\n\r\n  if (!connected || !mintInfosConnected) {\r\n    return [];\r\n  }\r\n\r\n  let balances: { [mint: string]: number } = {};\r\n  for (let account of tokenAccounts || []) {\r\n    if (!account.account) {\r\n      continue;\r\n    }\r\n    let parsedAccount;\r\n    if (account.effectiveMint.equals(WRAPPED_SOL_MINT)) {\r\n      parsedAccount = {\r\n        mint: WRAPPED_SOL_MINT,\r\n        owner: account.pubkey,\r\n        amount: account.account.lamports,\r\n      };\r\n    } else {\r\n      parsedAccount = parseTokenAccountData(account.account.data);\r\n    }\r\n    if (!(parsedAccount.mint.toBase58() in balances)) {\r\n      balances[parsedAccount.mint.toBase58()] = 0;\r\n    }\r\n    const mintInfo = mintInfos && mintInfos[parsedAccount.mint.toBase58()];\r\n    const additionalAmount = divideBnToNumber(\r\n      new BN(parsedAccount.amount),\r\n      getTokenMultiplierFromDecimals(mintInfo?.decimals || 0),\r\n    );\r\n    balances[parsedAccount.mint.toBase58()] += additionalAmount;\r\n  }\r\n  return Object.entries(balances).map(([mint, balance]) => {\r\n    return { mint, balance };\r\n  });\r\n}\r\n\r\nexport function useUnmigratedDeprecatedMarkets() {\r\n  const connection = useConnection();\r\n  const { accounts } = useUnmigratedOpenOrdersAccounts();\r\n  const marketsList =\r\n    accounts &&\r\n    Array.from(new Set(accounts.map((openOrders) => openOrders.market)));\r\n  const deps = marketsList && marketsList.map((m) => m.toBase58());\r\n\r\n  const useUnmigratedDeprecatedMarketsInner = async () => {\r\n    if (!marketsList) {\r\n      return null;\r\n    }\r\n    const getMarket = async (address) => {\r\n      const marketInfo = USE_MARKETS.find((market) =>\r\n        market.address.equals(address),\r\n      );\r\n      if (!marketInfo) {\r\n        console.log('Failed loading market');\r\n        notify({\r\n          message: 'Error loading market',\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n      try {\r\n        console.log('Loading market', marketInfo.name);\r\n        // NOTE: Should this just be cached by (connection, marketInfo.address, marketInfo.programId)?\r\n        return await Market.load(\r\n          connection,\r\n          marketInfo.address,\r\n          {},\r\n          marketInfo.programId,\r\n        );\r\n      } catch (e) {\r\n        console.log('Failed loading market', marketInfo.name, e);\r\n        notify({\r\n          message: 'Error loading market',\r\n          description: e.message,\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n    };\r\n    return (await Promise.all(marketsList.map(getMarket))).filter((x) => x);\r\n  };\r\n  const [markets] = useAsyncData(\r\n    useUnmigratedDeprecatedMarketsInner,\r\n    tuple(\r\n      'useUnmigratedDeprecatedMarketsInner',\r\n      connection,\r\n      deps && deps.toString(),\r\n    ),\r\n    { refreshInterval: _VERY_SLOW_REFRESH_INTERVAL },\r\n  );\r\n  if (!markets) {\r\n    return null;\r\n  }\r\n  return markets.map((market) => ({\r\n    market,\r\n    openOrdersList: accounts?.filter(\r\n      (openOrders) => market && openOrders.market.equals(market.address),\r\n    ),\r\n  }));\r\n}\r\n\r\nexport function useGetOpenOrdersForDeprecatedMarkets(): {\r\n  openOrders: OrderWithMarketAndMarketName[] | null | undefined;\r\n  loaded: boolean;\r\n  refreshOpenOrders: () => void;\r\n} {\r\n  const { connected, wallet } = useWallet();\r\n  const { customMarkets } = useCustomMarkets();\r\n  const connection = useConnection();\r\n  const marketsAndOrders = useUnmigratedDeprecatedMarkets();\r\n  const marketsList =\r\n    marketsAndOrders && marketsAndOrders.map(({ market }) => market);\r\n\r\n  // This isn't quite right: open order balances could change\r\n  const deps =\r\n    marketsList &&\r\n    marketsList\r\n      .filter((market): market is Market => !!market)\r\n      .map((market) => market.address.toBase58());\r\n\r\n  async function getOpenOrdersForDeprecatedMarkets() {\r\n    if (!connected || !wallet) {\r\n      return null;\r\n    }\r\n    if (!marketsList) {\r\n      return null;\r\n    }\r\n    console.log('refreshing getOpenOrdersForDeprecatedMarkets');\r\n    const getOrders = async (market: Market | null) => {\r\n      if (!market) {\r\n        return null;\r\n      }\r\n      const { marketName } = getMarketDetails(market, customMarkets);\r\n      try {\r\n        console.log('Fetching open orders for', marketName);\r\n        // Can do better than this, we have the open orders accounts already\r\n        return (\r\n          await market.loadOrdersForOwner(connection, wallet.publicKey)\r\n        ).map((order) => ({ marketName, market, ...order }));\r\n      } catch (e) {\r\n        console.log('Failed loading open orders', market.address.toBase58(), e);\r\n        notify({\r\n          message: `Error loading open orders for deprecated ${marketName}`,\r\n          description: e.message,\r\n          type: 'error',\r\n        });\r\n        return null;\r\n      }\r\n    };\r\n    return (await Promise.all(marketsList.map(getOrders)))\r\n      .filter((x): x is OrderWithMarketAndMarketName[] => !!x)\r\n      .flat();\r\n  }\r\n\r\n  const cacheKey = tuple(\r\n    'getOpenOrdersForDeprecatedMarkets',\r\n    connected,\r\n    connection,\r\n    wallet,\r\n    deps && deps.toString(),\r\n  );\r\n  const [openOrders, loaded] = useAsyncData(\r\n    getOpenOrdersForDeprecatedMarkets,\r\n    cacheKey,\r\n    {\r\n      refreshInterval: _VERY_SLOW_REFRESH_INTERVAL,\r\n    },\r\n  );\r\n  console.log('openOrders', openOrders);\r\n  return {\r\n    openOrders,\r\n    loaded,\r\n    refreshOpenOrders: () => refreshCache(cacheKey),\r\n  };\r\n}\r\n\r\nexport function useBalancesForDeprecatedMarkets() {\r\n  const markets = useUnmigratedDeprecatedMarkets();\r\n  const [customMarkets] = useLocalStorageState<CustomMarketInfo[]>(\r\n    'customMarkets',\r\n    [],\r\n  );\r\n  if (!markets) {\r\n    return null;\r\n  }\r\n\r\n  const openOrderAccountBalances: DeprecatedOpenOrdersBalances[] = [];\r\n  markets.forEach(({ market, openOrdersList }) => {\r\n    const { baseCurrency, quoteCurrency, marketName } = getMarketDetails(\r\n      market,\r\n      customMarkets,\r\n    );\r\n    if (!baseCurrency || !quoteCurrency || !market) {\r\n      return;\r\n    }\r\n    (openOrdersList || []).forEach((openOrders) => {\r\n      const inOrdersBase =\r\n        openOrders?.baseTokenTotal &&\r\n        openOrders?.baseTokenFree &&\r\n        market.baseSplSizeToNumber(\r\n          openOrders.baseTokenTotal.sub(openOrders.baseTokenFree),\r\n        );\r\n      const inOrdersQuote =\r\n        openOrders?.quoteTokenTotal &&\r\n        openOrders?.quoteTokenFree &&\r\n        market.baseSplSizeToNumber(\r\n          openOrders.quoteTokenTotal.sub(openOrders.quoteTokenFree),\r\n        );\r\n      const unsettledBase =\r\n        openOrders?.baseTokenFree &&\r\n        market.baseSplSizeToNumber(openOrders.baseTokenFree);\r\n      const unsettledQuote =\r\n        openOrders?.quoteTokenFree &&\r\n        market.baseSplSizeToNumber(openOrders.quoteTokenFree);\r\n\r\n      openOrderAccountBalances.push({\r\n        marketName,\r\n        market,\r\n        coin: baseCurrency,\r\n        key: `${marketName}${baseCurrency}`,\r\n        orders: inOrdersBase,\r\n        unsettled: unsettledBase,\r\n        openOrders,\r\n      });\r\n      openOrderAccountBalances.push({\r\n        marketName,\r\n        market,\r\n        coin: quoteCurrency,\r\n        key: `${marketName}${quoteCurrency}`,\r\n        orders: inOrdersQuote,\r\n        unsettled: unsettledQuote,\r\n        openOrders,\r\n      });\r\n    });\r\n  });\r\n  return openOrderAccountBalances;\r\n}\r\n\r\nexport function getMarketInfos(\r\n  customMarkets: CustomMarketInfo[],\r\n): MarketInfo[] {\r\n  const customMarketsInfo = customMarkets.map((m) => ({\r\n    ...m,\r\n    address: new PublicKey(m.address),\r\n    programId: new PublicKey(m.programId),\r\n    deprecated: false,\r\n  }));\r\n\r\n  return [...customMarketsInfo, ...USE_MARKETS];\r\n}\r\n\r\nexport function useMarketInfos() {\r\n  const { customMarkets } = useCustomMarkets();\r\n  return getMarketInfos(customMarkets);\r\n}\r\n\r\n/**\r\n * If selling, choose min tick size. If buying choose a price\r\n * s.t. given the state of the orderbook, the order will spend\r\n * `cost` cost currency.\r\n *\r\n * @param orderbook serum Orderbook object\r\n * @param cost quantity to spend. Base currency if selling,\r\n *  quote currency if buying.\r\n * @param tickSizeDecimals size of price increment of the market\r\n */\r\nexport function getMarketOrderPrice(\r\n  orderbook: Orderbook,\r\n  cost: number,\r\n  tickSizeDecimals?: number,\r\n) {\r\n  if (orderbook.isBids) {\r\n    return orderbook.market.tickSize;\r\n  }\r\n  let spentCost = 0;\r\n  let price, sizeAtLevel, costAtLevel: number;\r\n  const asks = orderbook.getL2(1000);\r\n  for ([price, sizeAtLevel] of asks) {\r\n    costAtLevel = price * sizeAtLevel;\r\n    if (spentCost + costAtLevel > cost) {\r\n      break;\r\n    }\r\n    spentCost += costAtLevel;\r\n  }\r\n  const sendPrice = Math.min(price * 1.02, asks[0][0] * 1.05);\r\n  let formattedPrice;\r\n  if (tickSizeDecimals) {\r\n    formattedPrice = floorToDecimal(sendPrice, tickSizeDecimals);\r\n  } else {\r\n    formattedPrice = sendPrice;\r\n  }\r\n  return formattedPrice;\r\n}\r\n\r\nexport function getExpectedFillPrice(\r\n  orderbook: Orderbook,\r\n  cost: number,\r\n  tickSizeDecimals?: number,\r\n) {\r\n  let spentCost = 0;\r\n  let avgPrice = 0;\r\n  let price, sizeAtLevel, costAtLevel: number;\r\n  for ([price, sizeAtLevel] of orderbook.getL2(1000)) {\r\n    costAtLevel = (orderbook.isBids ? 1 : price) * sizeAtLevel;\r\n    if (spentCost + costAtLevel > cost) {\r\n      avgPrice += (cost - spentCost) * price;\r\n      spentCost = cost;\r\n      break;\r\n    }\r\n    avgPrice += costAtLevel * price;\r\n    spentCost += costAtLevel;\r\n  }\r\n  const totalAvgPrice = avgPrice / Math.min(cost, spentCost);\r\n  let formattedPrice;\r\n  if (tickSizeDecimals) {\r\n    formattedPrice = floorToDecimal(totalAvgPrice, tickSizeDecimals);\r\n  } else {\r\n    formattedPrice = totalAvgPrice;\r\n  }\r\n  return formattedPrice;\r\n}\r\n\r\nexport function useCurrentlyAutoSettling(): [boolean, (currentlyAutoSettling: boolean) => void] {\r\n  const [currentlyAutoSettling, setCurrentlyAutosettling] = useState<boolean>(false);\r\n  return [currentlyAutoSettling, setCurrentlyAutosettling];\r\n}\r\n","import { useRef, useEffect } from 'react';\r\n\r\nexport function useInterval(callback, delay) {\r\n  const savedCallback = useRef<() => void>();\r\n\r\n  // Remember the latest callback.\r\n  useEffect(() => {\r\n    savedCallback.current = callback;\r\n  }, [callback]);\r\n\r\n  // Set up the interval.\r\n  useEffect(() => {\r\n    function tick() {\r\n      savedCallback.current && savedCallback.current();\r\n    }\r\n    if (delay !== null) {\r\n      let id = setInterval(tick, delay);\r\n      return () => {\r\n        clearInterval(id);\r\n      };\r\n    }\r\n  }, [delay]);\r\n}\r\n","import React from 'react';\r\nimport styled from 'styled-components';\r\n\r\nconst Wrapper = styled.div`\r\n  margin: 5px;\r\n  padding: 20px;\r\n  background-color: #191919;\r\n  `;\r\n\r\nexport default function FloatingElement({\r\n  style = undefined,\r\n  children,\r\n  stretchVertical = false,\r\n}) {\r\n  return (\r\n    <Wrapper\r\n      style={{\r\n        height: stretchVertical ? 'calc(100% - 10px)' : undefined,\r\n        ...style,\r\n      }}\r\n    >\r\n      {children}\r\n    </Wrapper>\r\n  );\r\n}\r\n","import { Col, Row } from 'antd';\r\nimport React, { useRef, useEffect, useState } from 'react';\r\nimport styled, { css } from 'styled-components';\r\nimport { useMarket, useOrderbook, useMarkPrice } from '../utils/markets';\r\nimport { isEqual, getDecimalCount } from '../utils/utils';\r\nimport { useInterval } from '../utils/useInterval';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport usePrevious from '../utils/usePrevious';\r\nimport { ArrowUpOutlined, ArrowDownOutlined } from '@ant-design/icons';\r\n\r\nconst Title = styled.div`\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\n\r\nconst SizeTitle = styled(Row)`\r\n  padding: 20px 0 14px;\r\n  color: #434a59;\r\n`;\r\n\r\nconst MarkPriceTitle = styled(Row)`\r\n  padding: 20px 0 14px;\r\n  font-weight: 700;\r\n`;\r\n\r\nconst Line = styled.div`\r\n  text-align: right;\r\n  float: right;\r\n  height: 100%;\r\n  ${(props) =>\r\n    props['data-width'] &&\r\n    css`\r\n      width: ${props['data-width']};\r\n    `}\r\n  ${(props) =>\r\n    props['data-bgcolor'] &&\r\n    css`\r\n      background-color: ${props['data-bgcolor']};\r\n    `}\r\n`;\r\n\r\nconst Price = styled.div`\r\n  position: absolute;\r\n  right: 5px;\r\n  color: white;\r\n`;\r\n\r\nexport default function Orderbook({ smallScreen, depth = 7, onPrice, onSize }) {\r\n  const markPrice = useMarkPrice();\r\n  const [orderbook] = useOrderbook();\r\n  const { baseCurrency, quoteCurrency } = useMarket();\r\n\r\n  const currentOrderbookData = useRef(null);\r\n  const lastOrderbookData = useRef(null);\r\n\r\n  const [orderbookData, setOrderbookData] = useState(null);\r\n\r\n  useInterval(() => {\r\n    if (\r\n      !currentOrderbookData.current ||\r\n      JSON.stringify(currentOrderbookData.current) !==\r\n        JSON.stringify(lastOrderbookData.current)\r\n    ) {\r\n      let bids = orderbook?.bids || [];\r\n      let asks = orderbook?.asks || [];\r\n\r\n      let sum = (total, [, size], index) =>\r\n        index < depth ? total + size : total;\r\n      let totalSize = bids.reduce(sum, 0) + asks.reduce(sum, 0);\r\n\r\n      let bidsToDisplay = getCumulativeOrderbookSide(bids, totalSize, false);\r\n      let asksToDisplay = getCumulativeOrderbookSide(asks, totalSize, true);\r\n\r\n      currentOrderbookData.current = {\r\n        bids: orderbook?.bids,\r\n        asks: orderbook?.asks,\r\n      };\r\n\r\n      setOrderbookData({ bids: bidsToDisplay, asks: asksToDisplay });\r\n    }\r\n  }, 250);\r\n\r\n  useEffect(() => {\r\n    lastOrderbookData.current = {\r\n      bids: orderbook?.bids,\r\n      asks: orderbook?.asks,\r\n    };\r\n  }, [orderbook]);\r\n\r\n  function getCumulativeOrderbookSide(orders, totalSize, backwards = false) {\r\n    let cumulative = orders\r\n      .slice(0, depth)\r\n      .reduce((cumulative, [price, size], i) => {\r\n        const cumulativeSize = (cumulative[i - 1]?.cumulativeSize || 0) + size;\r\n        cumulative.push({\r\n          price,\r\n          size,\r\n          cumulativeSize,\r\n          sizePercent: Math.round((cumulativeSize / (totalSize || 1)) * 100),\r\n        });\r\n        return cumulative;\r\n      }, []);\r\n    if (backwards) {\r\n      cumulative = cumulative.reverse();\r\n    }\r\n    return cumulative;\r\n  }\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={\r\n        smallScreen ? { flex: 1 } : { height: '500px', overflow: 'hidden' }\r\n      }\r\n    >\r\n      <Title>Orderbook</Title>\r\n      <SizeTitle>\r\n        <Col span={12} style={{ textAlign: 'left' }}>\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          Price ({quoteCurrency})\r\n        </Col>\r\n      </SizeTitle>\r\n      {orderbookData?.asks.map(({ price, size, sizePercent }) => (\r\n        <OrderbookRow\r\n          key={price + ''}\r\n          price={price}\r\n          size={size}\r\n          side={'sell'}\r\n          sizePercent={sizePercent}\r\n          onPriceClick={() => onPrice(price)}\r\n          onSizeClick={() => onSize(size)}\r\n        />\r\n      ))}\r\n      <MarkPriceComponent markPrice={markPrice} />\r\n      {orderbookData?.bids.map(({ price, size, sizePercent }) => (\r\n        <OrderbookRow\r\n          key={price + ''}\r\n          price={price}\r\n          size={size}\r\n          side={'buy'}\r\n          sizePercent={sizePercent}\r\n          onPriceClick={() => onPrice(price)}\r\n          onSizeClick={() => onSize(size)}\r\n        />\r\n      ))}\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nconst OrderbookRow = React.memo(\r\n  ({ side, price, size, sizePercent, onSizeClick, onPriceClick }) => {\r\n    const element = useRef();\r\n\r\n    const { market } = useMarket();\r\n\r\n    useEffect(() => {\r\n      // eslint-disable-next-line\r\n      !element.current?.classList.contains('flash') &&\r\n        element.current?.classList.add('flash');\r\n      const id = setTimeout(\r\n        () =>\r\n          element.current?.classList.contains('flash') &&\r\n          element.current?.classList.remove('flash'),\r\n        250,\r\n      );\r\n      return () => clearTimeout(id);\r\n    }, [price, size]);\r\n\r\n    let formattedSize =\r\n      market?.minOrderSize && !isNaN(size)\r\n        ? Number(size).toFixed(getDecimalCount(market.minOrderSize) + 1)\r\n        : size;\r\n\r\n    let formattedPrice =\r\n      market?.tickSize && !isNaN(price)\r\n        ? Number(price).toFixed(getDecimalCount(market.tickSize) + 1)\r\n        : price;\r\n\r\n    return (\r\n      <Row ref={element} style={{ marginBottom: 1 }} onClick={onSizeClick}>\r\n        <Col span={12} style={{ textAlign: 'left' }}>\r\n          {formattedSize}\r\n        </Col>\r\n        <Col span={12} style={{ textAlign: 'right' }}>\r\n          <Line\r\n            data-width={sizePercent + '%'}\r\n            data-bgcolor={\r\n              side === 'buy'\r\n                ? 'rgba(65, 199, 122, 0.6)'\r\n                : 'rgba(242, 60, 105, 0.6)'\r\n            }\r\n          />\r\n          <Price onClick={onPriceClick}>{formattedPrice}</Price>\r\n        </Col>\r\n      </Row>\r\n    );\r\n  },\r\n  (prevProps, nextProps) =>\r\n    isEqual(prevProps, nextProps, ['price', 'size', 'sizePercent']),\r\n);\r\n\r\nconst MarkPriceComponent = React.memo(\r\n  ({ markPrice }) => {\r\n    const { market } = useMarket();\r\n    const previousMarkPrice = usePrevious(markPrice);\r\n\r\n    let markPriceColor =\r\n      markPrice > previousMarkPrice\r\n        ? '#41C77A'\r\n        : markPrice < previousMarkPrice\r\n        ? '#F23B69'\r\n        : 'white';\r\n\r\n    let formattedMarkPrice =\r\n      markPrice &&\r\n      market?.tickSize &&\r\n      markPrice.toFixed(getDecimalCount(market.tickSize));\r\n\r\n    return (\r\n      <MarkPriceTitle justify=\"center\">\r\n        <Col style={{ color: markPriceColor }}>\r\n          {markPrice > previousMarkPrice && (\r\n            <ArrowUpOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {markPrice < previousMarkPrice && (\r\n            <ArrowDownOutlined style={{ marginRight: 5 }} />\r\n          )}\r\n          {formattedMarkPrice || '----'}\r\n        </Col>\r\n      </MarkPriceTitle>\r\n    );\r\n  },\r\n  (prevProps, nextProps) => isEqual(prevProps, nextProps, ['markPrice']),\r\n);\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport default function usePrevious(value) {\r\n  // The ref object is a generic container whose current property is mutable ...\r\n  // ... and can hold any value, similar to an instance property on a class\r\n  const ref = useRef();\r\n\r\n  // Store current value in ref\r\n  useEffect(() => {\r\n    ref.current = value;\r\n  }, [value]); // Only re-run if value changes\r\n\r\n  // Return previous value (happens before update in useEffect above)\r\n  return ref.current;\r\n}\r\n","import React from 'react';\r\nimport { ConfigProvider, Table } from 'antd';\r\n\r\nexport default function DataTable({\r\n  dataSource,\r\n  columns,\r\n  emptyLabel = 'No data',\r\n  pagination = false,\r\n  loading = false,\r\n  pageSize = 10,\r\n}) {\r\n  const customizeRenderEmpty = () => (\r\n    <div\r\n      style={{\r\n        padding: '20px',\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n      }}\r\n    >\r\n      {emptyLabel}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ConfigProvider renderEmpty={customizeRenderEmpty}>\r\n      <Table\r\n        dataSource={dataSource}\r\n        columns={columns}\r\n        pagination={pagination ? { pagination: true, pageSize } : false}\r\n        loading={loading}\r\n      />\r\n    </ConfigProvider>\r\n  );\r\n}\r\n","import React, { useContext, useEffect, useState } from 'react';\r\nimport { useConnection } from './connection';\r\nimport { PublicKey } from '@solana/web3.js';\r\nimport {\r\n  NameRegistryState,\r\n  getHashedName,\r\n  getNameAccountKey,\r\n  getTwitterRegistry,\r\n} from '@solana/spl-name-service';\r\nimport { TOKEN_PROGRAM_ID } from '@solana/spl-token';\r\nimport { useLocalStorageState } from './utils';\r\n\r\ninterface ReferrerContextValues {\r\n  usdcRef: PublicKey | undefined;\r\n  usdtRef: PublicKey | undefined;\r\n  setRefCode: (arg: any) => void;\r\n  refCode: string | undefined;\r\n  allowRefLink: boolean;\r\n}\r\n\r\nconst ReferrerContext: React.Context<null | ReferrerContextValues> = React.createContext<null | ReferrerContextValues>(\r\n  null,\r\n);\r\n\r\nexport const ASSOCIATED_TOKEN_PROGRAM_ID: PublicKey = new PublicKey(\r\n  'ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL',\r\n);\r\n\r\nconst USDC_MINT = new PublicKey('EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v');\r\nconst USDT_MINT = new PublicKey('Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB');\r\n\r\nexport async function findAssociatedTokenAddress(\r\n  walletAddress: PublicKey,\r\n  tokenMintAddress: PublicKey,\r\n): Promise<PublicKey> {\r\n  return (\r\n    await PublicKey.findProgramAddress(\r\n      [\r\n        walletAddress.toBuffer(),\r\n        TOKEN_PROGRAM_ID.toBuffer(),\r\n        tokenMintAddress.toBuffer(),\r\n      ],\r\n      ASSOCIATED_TOKEN_PROGRAM_ID,\r\n    )\r\n  )[0];\r\n}\r\n\r\n// Address of the SOL TLD\r\nexport const SOL_TLD_AUTHORITY = new PublicKey(\r\n  '58PwtjSDuFHuUkYjH9BYnnQKHfwo9reZhC2zMJv9JPkx',\r\n);\r\n\r\nexport const getInputKey = async (input: string) => {\r\n  let hashed_input_name = await getHashedName(input);\r\n  let inputDomainKey = await getNameAccountKey(\r\n    hashed_input_name,\r\n    undefined,\r\n    SOL_TLD_AUTHORITY,\r\n  );\r\n  return { inputDomainKey: inputDomainKey, hashedInputName: hashed_input_name };\r\n};\r\n\r\nexport const useFeesAccountsFromRefCode = (refCode: string | undefined) => {\r\n  const connection = useConnection();\r\n  const [usdc, setUsdc] = useState<PublicKey | undefined>(undefined);\r\n  const [usdt, setUsdt] = useState<PublicKey | undefined>(undefined);\r\n\r\n  useEffect(() => {\r\n    const fn = async () => {\r\n      let usdcAddress: undefined | PublicKey = undefined;\r\n      let usdtAddress: undefined | PublicKey = undefined;\r\n      if (!refCode) {\r\n        setUsdc(\r\n          process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS\r\n            ? new PublicKey(process.env.REACT_APP_USDC_REFERRAL_FEES_ADDRESS)\r\n            : undefined,\r\n        );\r\n        setUsdt(\r\n          process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS\r\n            ? new PublicKey(process.env.REACT_APP_USDT_REFERRAL_FEES_ADDRESS)\r\n            : undefined,\r\n        );\r\n        return;\r\n      }\r\n      try {\r\n        let nameRegistryState: NameRegistryState;\r\n        if (refCode.includes('.sol')) {\r\n          const { inputDomainKey } = await getInputKey(\r\n            refCode.replace('.sol', ''),\r\n          );\r\n          nameRegistryState = await NameRegistryState.retrieve(\r\n            connection,\r\n            inputDomainKey,\r\n          );\r\n        } else {\r\n          nameRegistryState = await getTwitterRegistry(connection, refCode);\r\n        }\r\n        usdcAddress = await findAssociatedTokenAddress(\r\n          nameRegistryState.owner,\r\n          USDC_MINT,\r\n        );\r\n        usdtAddress = await findAssociatedTokenAddress(\r\n          nameRegistryState.owner,\r\n          USDT_MINT,\r\n        );\r\n        const usdcAccountInfo = await connection.getAccountInfo(usdcAddress);\r\n        const usdtAccountInfo = await connection.getAccountInfo(usdtAddress);\r\n        if (!!usdcAccountInfo?.data) setUsdc(usdcAddress);\r\n        if (!!usdtAccountInfo?.data) setUsdt(usdtAddress);\r\n      } catch (err) {\r\n        console.warn(`Error getting refcode ${err}`);\r\n      }\r\n    };\r\n    fn();\r\n  }, [connection, refCode]);\r\n  return { usdcRef: usdc, usdtRef: usdt };\r\n};\r\n\r\nexport const ReferrerProvider = ({ children }) => {\r\n  const allowRefLink = process.env.REACT_APP_ALLOW_REF_LINK === 'true';\r\n  const [refCode, setRefCode] = useLocalStorageState('refCode');\r\n  const { usdcRef, usdtRef } = useFeesAccountsFromRefCode(\r\n    allowRefLink ? refCode : undefined,\r\n  );\r\n  useEffect(() => {\r\n    if (!allowRefLink) setRefCode(null);\r\n  }, [allowRefLink, setRefCode]);\r\n  return (\r\n    <ReferrerContext.Provider\r\n      value={{ usdcRef, usdtRef, setRefCode, refCode, allowRefLink }}\r\n    >\r\n      {children}\r\n    </ReferrerContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useReferrer = () => {\r\n  const context = useContext(ReferrerContext);\r\n  if (!context) throw new Error('Missing referrer context');\r\n  return {\r\n    usdcRef: context.usdcRef,\r\n    usdtRef: context.usdtRef,\r\n    setRefCode: context.setRefCode,\r\n    refCode: context.refCode,\r\n    allowRefLink: context.allowRefLink,\r\n  };\r\n};\r\n","import { Button } from 'antd';\r\nimport React from 'react';\r\nimport {\r\n  useTokenAccounts,\r\n  getSelectedTokenAccountForMint,\r\n} from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\nimport { useSendConnection } from '../../utils/connection';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport { settleFunds } from '../../utils/send';\r\nimport { notify } from '../../utils/notifications';\r\nimport { useReferrer } from '../../utils/referrer';\r\n\r\nexport default function BalancesTable({\r\n  balances,\r\n  showMarket,\r\n  hideWalletBalance,\r\n  onSettleSuccess,\r\n}) {\r\n  const [accounts] = useTokenAccounts();\r\n  const connection = useSendConnection();\r\n  const { wallet } = useWallet();\r\n  const { usdcRef, usdtRef } = useReferrer();\r\n\r\n  async function onSettleFunds(market, openOrders) {\r\n    try {\r\n      await settleFunds({\r\n        market,\r\n        openOrders,\r\n        connection,\r\n        wallet,\r\n        baseCurrencyAccount: getSelectedTokenAccountForMint(\r\n          accounts,\r\n          market?.baseMintAddress,\r\n        ),\r\n        quoteCurrencyAccount: getSelectedTokenAccountForMint(\r\n          accounts,\r\n          market?.quoteMintAddress,\r\n        ),\r\n        usdcRef,\r\n        usdtRef,\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    onSettleSuccess && onSettleSuccess();\r\n  }\r\n\r\n  const columns = [\r\n    showMarket\r\n      ? {\r\n          title: 'Market',\r\n          dataIndex: 'marketName',\r\n          key: 'marketName',\r\n        }\r\n      : null,\r\n    {\r\n      title: 'Coin',\r\n      dataIndex: 'coin',\r\n      key: 'coin',\r\n    },\r\n    hideWalletBalance\r\n      ? null\r\n      : {\r\n          title: 'Wallet Balance',\r\n          dataIndex: 'wallet',\r\n          key: 'wallet',\r\n        },\r\n    {\r\n      title: 'Orders',\r\n      dataIndex: 'orders',\r\n      key: 'orders',\r\n    },\r\n    {\r\n      title: 'Unsettled',\r\n      dataIndex: 'unsettled',\r\n      key: 'unsettled',\r\n    },\r\n    {\r\n      key: 'action',\r\n      render: ({ market, openOrders, marketName }) => (\r\n        <div style={{ textAlign: 'right' }}>\r\n          <Button\r\n            ghost\r\n            style={{ marginRight: 12 }}\r\n            onClick={() => onSettleFunds(market, openOrders)}\r\n          >\r\n            Settle {marketName}\r\n          </Button>\r\n        </div>\r\n      ),\r\n    },\r\n  ].filter((x) => x);\r\n  return (\r\n    <DataTable\r\n      emptyLabel=\"No balances\"\r\n      dataSource={balances}\r\n      columns={columns}\r\n      pagination={false}\r\n    />\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport DataTable from '../layout/DataTable';\r\n\r\nimport styled from 'styled-components';\r\nimport { Button, Col, Row, Tag } from 'antd';\r\nimport { cancelOrder } from '../../utils/send';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport { useSendConnection } from '../../utils/connection';\r\nimport { notify } from '../../utils/notifications';\r\nimport { DeleteOutlined } from '@ant-design/icons';\r\nimport { OrderWithMarketAndMarketName } from '../../utils/types';\r\n\r\nconst CancelButton = styled(Button)`\r\n  color: #f23b69;\r\n  border: 1px solid #f23b69;\r\n`;\r\n\r\nexport default function OpenOrderTable({\r\n  openOrders,\r\n  onCancelSuccess,\r\n  pageSize,\r\n  loading,\r\n  marketFilter,\r\n}: {\r\n  openOrders: OrderWithMarketAndMarketName[] | null | undefined;\r\n  onCancelSuccess?: () => void;\r\n  pageSize?: number;\r\n  loading?: boolean;\r\n  marketFilter?: boolean;\r\n}) {\r\n  let { wallet } = useWallet();\r\n  let connection = useSendConnection();\r\n\r\n  const [cancelId, setCancelId] = useState(null);\r\n\r\n  async function cancel(order) {\r\n    setCancelId(order?.orderId);\r\n    try {\r\n      if (!wallet) {\r\n        return null;\r\n      }\r\n\r\n      await cancelOrder({\r\n        order,\r\n        market: order.market,\r\n        connection,\r\n        wallet,\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error cancelling order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    } finally {\r\n      setCancelId(null);\r\n    }\r\n    onCancelSuccess && onCancelSuccess();\r\n  }\r\n\r\n  const marketFilters = [\r\n    ...new Set((openOrders || []).map((orderInfos) => orderInfos.marketName)),\r\n  ].map((marketName) => {\r\n    return { text: marketName, value: marketName };\r\n  });\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Market',\r\n      dataIndex: 'marketName',\r\n      key: 'marketName',\r\n      filters: marketFilter ? marketFilters : undefined,\r\n      onFilter: (value, record) => record.marketName.indexOf(value) === 0,\r\n    },\r\n    {\r\n      title: 'Side',\r\n      dataIndex: 'side',\r\n      key: 'side',\r\n      render: (side) => (\r\n        <Tag\r\n          color={side === 'buy' ? '#41C77A' : '#F23B69'}\r\n          style={{ fontWeight: 700 }}\r\n        >\r\n          {side.charAt(0).toUpperCase() + side.slice(1)}\r\n        </Tag>\r\n      ),\r\n      sorter: (a, b) => {\r\n        if (a.side === b.side) {\r\n          return 0;\r\n        } else if (a.side === 'buy') {\r\n          return 1;\r\n        } else {\r\n          return -1;\r\n        }\r\n      },\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      title: 'Size',\r\n      dataIndex: 'size',\r\n      key: 'size',\r\n      sorter: (a, b) => b.size - a.size,\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      title: 'Price',\r\n      dataIndex: 'price',\r\n      key: 'price',\r\n      sorter: (a, b) => b.price - a.price,\r\n      showSorterTooltip: false,\r\n    },\r\n    {\r\n      key: 'orderId',\r\n      render: (order) => (\r\n        <div style={{ textAlign: 'right' }}>\r\n          <CancelButton\r\n            icon={<DeleteOutlined />}\r\n            onClick={() => cancel(order)}\r\n            loading={cancelId + '' === order?.orderId + ''}\r\n          >\r\n            Cancel\r\n          </CancelButton>\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n  const dataSource = (openOrders || []).map((order) => ({\r\n    ...order,\r\n    key: order.orderId,\r\n  }));\r\n\r\n  return (\r\n    <Row>\r\n      <Col span={24}>\r\n        <DataTable\r\n          emptyLabel=\"No open orders\"\r\n          dataSource={dataSource}\r\n          columns={columns}\r\n          pagination={true}\r\n          pageSize={pageSize ? pageSize : 5}\r\n          loading={loading !== undefined && loading}\r\n        />\r\n      </Col>\r\n    </Row>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Row, Col, Tag } from 'antd';\r\nimport { useFills, useMarket } from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\n\r\nexport default function FillsTable() {\r\n  const fills = useFills();\r\n\r\n  const { quoteCurrency } = useMarket();\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Market',\r\n      dataIndex: 'marketName',\r\n      key: 'marketName',\r\n    },\r\n    {\r\n      title: 'Side',\r\n      dataIndex: 'side',\r\n      key: 'side',\r\n      render: (side) => (\r\n        <Tag\r\n          color={side === 'buy' ? '#41C77A' : '#F23B69'}\r\n          style={{ fontWeight: 700 }}\r\n        >\r\n          {side.charAt(0).toUpperCase() + side.slice(1)}\r\n        </Tag>\r\n      ),\r\n    },\r\n    {\r\n      title: `Size`,\r\n      dataIndex: 'size',\r\n      key: 'size',\r\n    },\r\n    {\r\n      title: `Price`,\r\n      dataIndex: 'price',\r\n      key: 'price',\r\n    },\r\n    {\r\n      title: `Liquidity`,\r\n      dataIndex: 'liquidity',\r\n      key: 'liquidity',\r\n    },\r\n    {\r\n      title: quoteCurrency ? `Fees (${quoteCurrency})` : 'Fees',\r\n      dataIndex: 'feeCost',\r\n      key: 'feeCost',\r\n    },\r\n  ];\r\n\r\n  const dataSource = (fills || []).map((fill) => ({\r\n    ...fill,\r\n    key: `${fill.orderId}${fill.side}`,\r\n    liquidity: fill.eventFlags.maker ? 'Maker' : 'Taker',\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col span={24}>\r\n          <DataTable\r\n            dataSource={dataSource}\r\n            columns={columns}\r\n            pagination={true}\r\n            pageSize={5}\r\n            emptyLabel=\"No fills\"\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Row, Col, Typography, Tag } from 'antd';\r\nimport { useFeeDiscountKeys } from '../../utils/markets';\r\nimport DataTable from '../layout/DataTable';\r\nimport { TokenInstructions, getFeeRates } from '@project-serum/serum';\r\nimport { percentFormat } from '../../utils/utils';\r\n\r\nexport default function FeesTable() {\r\n  const [feeAccounts] = useFeeDiscountKeys();\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Fee Tier',\r\n      dataIndex: 'feeTier',\r\n      key: 'feeTier',\r\n      render: (feeTier, row) => (\r\n        <div style={{ display: 'flex' }}>\r\n          <Typography>{feeTier}</Typography>\r\n          {row.index === 0 ? (\r\n            <div style={{ marginLeft: 10 }}>\r\n              <Tag color={'#41C77A'} style={{ fontWeight: 700 }}>\r\n                Selected\r\n              </Tag>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Taker',\r\n      dataIndex: 'taker',\r\n      key: 'taker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).taker),\r\n    },\r\n    {\r\n      title: 'Maker',\r\n      dataIndex: 'maker',\r\n      key: 'maker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).maker),\r\n    },\r\n    {\r\n      title: `Public Key`,\r\n      dataIndex: 'pubkey',\r\n      key: 'pubkey',\r\n      render: (pubkey) => pubkey.toBase58(),\r\n    },\r\n    {\r\n      title: `Balance`,\r\n      dataIndex: 'balance',\r\n      key: 'balance',\r\n    },\r\n    {\r\n      title: `Mint`,\r\n      dataIndex: 'mint',\r\n      key: 'mint',\r\n      render: (_, row) =>\r\n        row.mint.equals(TokenInstructions.SRM_MINT)\r\n          ? 'SRM'\r\n          : row.mint.equals(TokenInstructions.MSRM_MINT)\r\n          ? 'MSRM'\r\n          : 'UNKNOWN',\r\n    },\r\n  ];\r\n\r\n  const dataSource = (feeAccounts || []).map((account, index) => ({\r\n    ...account,\r\n    index,\r\n    key: account.pubkey.toBase58(),\r\n  }));\r\n\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col span={24}>\r\n          <DataTable\r\n            dataSource={dataSource}\r\n            columns={columns}\r\n            pagination={true}\r\n            pageSize={5}\r\n            emptyLabel=\"No (M)SRM accounts\"\r\n          />\r\n        </Col>\r\n      </Row>\r\n      <Row style={{ marginTop: 8 }}>\r\n        <Col>\r\n          <Typography>\r\n            Holding SRM or MSRM makes you eligible for fee discounts:\r\n          </Typography>\r\n          <FeeScheduleTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction FeeScheduleTable() {\r\n  // Representation of serum-js/src/fees.ts\r\n  const dataSource = [\r\n    { feeTier: 0, taker: 0.0022, maker: -0.0003, token: '', balance: '' },\r\n    { feeTier: 1, taker: 0.002, maker: -0.0003, token: 'SRM', balance: 100 },\r\n    { feeTier: 2, taker: 0.0018, maker: -0.0003, token: 'SRM', balance: 1000 },\r\n    { feeTier: 3, taker: 0.0016, maker: -0.0003, token: 'SRM', balance: 10000 },\r\n    {\r\n      feeTier: 4,\r\n      taker: 0.0014,\r\n      maker: -0.0003,\r\n      token: 'SRM',\r\n      balance: 100000,\r\n    },\r\n    {\r\n      feeTier: 5,\r\n      taker: 0.0012,\r\n      maker: -0.0003,\r\n      token: 'SRM',\r\n      balance: 1000000,\r\n    },\r\n    { feeTier: 6, taker: 0.001, maker: -0.0005, token: 'MSRM', balance: 1 },\r\n  ];\r\n  const columns = [\r\n    {\r\n      title: 'Fee Tier',\r\n      dataIndex: 'feeTier',\r\n      key: 'feeTier',\r\n    },\r\n    {\r\n      title: 'Taker',\r\n      dataIndex: 'taker',\r\n      key: 'taker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).taker),\r\n    },\r\n    {\r\n      title: 'Maker',\r\n      dataIndex: 'maker',\r\n      key: 'maker',\r\n      render: (feeTier, row) =>\r\n        percentFormat.format(getFeeRates(row.feeTier).maker),\r\n    },\r\n    {\r\n      title: 'Requirements',\r\n      dataIndex: 'requirements',\r\n      key: 'requirements',\r\n      render: (_, row) => (\r\n        <Typography>\r\n          {!row.balance ? 'None' : `≥ ${row.balance} ${row.token}`}\r\n        </Typography>\r\n      ),\r\n    },\r\n  ];\r\n  return (\r\n    <DataTable\r\n      dataSource={dataSource.map((info) => ({ ...info, key: info.feeTier }))}\r\n      columns={columns}\r\n    />\r\n  );\r\n}\r\n","import BalancesTable from './BalancesTable';\r\nimport OpenOrderTable from './OpenOrderTable';\r\nimport React from 'react';\r\nimport { Tabs, Typography } from 'antd';\r\nimport FillsTable from './FillsTable';\r\nimport FloatingElement from '../layout/FloatingElement';\r\nimport FeesTable from './FeesTable';\r\nimport { useOpenOrders, useBalances, useMarket } from '../../utils/markets';\r\n\r\nconst { Paragraph } = Typography;\r\nconst { TabPane } = Tabs;\r\n\r\nexport default function Index() {\r\n  const { market } = useMarket();\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 2 }}>\r\n      <Typography>\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n          Make sure to go to Balances and click Settle to send out your funds.\r\n        </Paragraph>\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n          To fund your wallet, <a href=\"https://www.sollet.io\">sollet.io</a>.\r\n          You can get SOL from FTX, Binance, BitMax, and others. You can get\r\n          other tokens from FTX.{' '}\r\n        </Paragraph>\r\n      </Typography>\r\n      <Tabs defaultActiveKey=\"orders\">\r\n        <TabPane tab=\"Open Orders\" key=\"orders\">\r\n          <OpenOrdersTab />\r\n        </TabPane>\r\n        <TabPane tab=\"Recent Trade History\" key=\"fills\">\r\n          <FillsTable />\r\n        </TabPane>\r\n        <TabPane tab=\"Balances\" key=\"balances\">\r\n          <BalancesTab />\r\n        </TabPane>\r\n        {market && market.supportsSrmFeeDiscounts ? (\r\n          <TabPane tab=\"Fee discounts\" key=\"fees\">\r\n            <FeesTable />\r\n          </TabPane>\r\n        ) : null}\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n\r\nconst OpenOrdersTab = () => {\r\n  const openOrders = useOpenOrders();\r\n\r\n  return <OpenOrderTable openOrders={openOrders} />;\r\n};\r\n\r\nconst BalancesTab = () => {\r\n  const balances = useBalances();\r\n\r\n  return <BalancesTable balances={balances} />;\r\n};\r\n","import React from 'react';\r\nimport { Modal } from 'antd';\r\nimport {\r\n  useSelectedBaseCurrencyAccount,\r\n  useMarket,\r\n  useSelectedQuoteCurrencyAccount,\r\n} from '../utils/markets';\r\nimport { useWallet } from '../utils/wallet';\r\nimport Link from './Link';\r\n\r\nexport default function DepositDialog({ onClose, baseOrQuote }) {\r\n  const { market, baseCurrency, quoteCurrency } = useMarket();\r\n\r\n  const { providerName, providerUrl } = useWallet();\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  let coinMint;\r\n  let account;\r\n  let depositCoin;\r\n  if (baseOrQuote === 'base') {\r\n    coinMint = market?.baseMintAddress;\r\n    account = baseCurrencyAccount;\r\n    depositCoin = baseCurrency;\r\n  } else if (baseOrQuote === 'quote') {\r\n    coinMint = market?.quoteMintAddress;\r\n    account = quoteCurrencyAccount;\r\n    depositCoin = quoteCurrency;\r\n  } else {\r\n    account = null;\r\n  }\r\n  if (!coinMint) {\r\n    return null;\r\n  }\r\n  return (\r\n    <Modal\r\n      title={depositCoin}\r\n      visible={!!coinMint}\r\n      onOk={onClose}\r\n      onCancel={onClose}\r\n    >\r\n      <div style={{ paddingTop: '20px' }}>\r\n        <p style={{ color: 'white' }}>Mint address:</p>\r\n        <p style={{ color: 'rgba(255,255,255,0.5)' }}>{coinMint.toBase58()}</p>\r\n        <div>\r\n          <p style={{ color: 'white' }}>SPL Deposit address:</p>\r\n          <p style={{ color: 'rgba(255,255,255,0.5)' }}>\r\n            {account ? (\r\n              account.pubkey.toBase58()\r\n            ) : (\r\n              <>\r\n                Visit{' '}\r\n                <Link external to={providerUrl}>\r\n                  {providerName}\r\n                </Link>{' '}\r\n                to create an account for this mint\r\n              </>\r\n            )}\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { TokenAccount } from '../utils/types';\r\nimport { useSelectedTokenAccounts } from '../utils/markets';\r\nimport { Button, Col, Select, Typography } from 'antd';\r\nimport { CopyOutlined } from '@ant-design/icons';\r\nimport { abbreviateAddress } from '../utils/utils';\r\nimport { notify } from '../utils/notifications';\r\n\r\nexport default function StandaloneTokenAccountsSelect({\r\n  accounts,\r\n  mint,\r\n  label,\r\n}: {\r\n  accounts: TokenAccount[] | null | undefined;\r\n  mint: string | undefined;\r\n  label?: boolean;\r\n}) {\r\n  const [\r\n    selectedTokenAccounts,\r\n    setSelectedTokenAccounts,\r\n  ] = useSelectedTokenAccounts();\r\n\r\n  let selectedValue: string | undefined;\r\n  if (mint && mint in selectedTokenAccounts) {\r\n    selectedValue = selectedTokenAccounts[mint];\r\n  } else if (accounts && accounts?.length > 0) {\r\n    selectedValue = accounts[0].pubkey.toBase58();\r\n  } else {\r\n    selectedValue = undefined;\r\n  }\r\n\r\n  const setTokenAccountForCoin = (value) => {\r\n    if (!mint) {\r\n      notify({\r\n        message: 'Error selecting token account',\r\n        description: 'Mint is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    const newSelectedTokenAccounts = { ...selectedTokenAccounts };\r\n    newSelectedTokenAccounts[mint] = value;\r\n    setSelectedTokenAccounts(newSelectedTokenAccounts);\r\n  };\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {label && <Col span={8}>Token account:</Col>}\r\n      <Col span={label ? 13 : 21}>\r\n        <Select\r\n          style={{ width: '100%' }}\r\n          value={selectedValue}\r\n          onSelect={setTokenAccountForCoin}\r\n        >\r\n          {accounts?.map((account) => (\r\n            <Select.Option\r\n              key={account.pubkey.toBase58()}\r\n              value={account.pubkey.toBase58()}\r\n            >\r\n              <Typography.Text code>\r\n                {label\r\n                  ? abbreviateAddress(account.pubkey, 8)\r\n                  : account.pubkey.toBase58()}\r\n              </Typography.Text>\r\n            </Select.Option>\r\n          ))}\r\n        </Select>\r\n      </Col>\r\n      <Col span={2} offset={1}>\r\n        <Button\r\n          shape=\"round\"\r\n          icon={<CopyOutlined />}\r\n          size={'small'}\r\n          onClick={() =>\r\n            selectedValue && navigator.clipboard.writeText(selectedValue)\r\n          }\r\n        />\r\n      </Col>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Button } from 'antd';\r\nimport { LinkOutlined } from '@ant-design/icons';\r\n\r\nexport default function LinkAddress({\r\n  title,\r\n  address,\r\n  shorten = false,\r\n}: {\r\n  title?: undefined | any;\r\n  address: string;\r\n  shorten?: boolean;\r\n}) {\r\n  return (\r\n    <div>\r\n      {title && <p style={{ color: 'white' }}>{title}</p>}\r\n      <Button\r\n        type=\"link\"\r\n        icon={<LinkOutlined />}\r\n        href={'https://solscan.io/address/' + address}\r\n        target=\"_blank\"\r\n        rel=\"noopener noreferrer\"\r\n        style={{ cursor: 'pointer' }}\r\n      >\r\n        {shorten ? `${address.slice(0, 4)}...${address.slice(-4)}` : address}\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n","import React, {useContext, useState} from 'react';\r\nimport {sleep, useLocalStorageState} from './utils';\r\nimport {useInterval} from './useInterval';\r\nimport {useConnection} from './connection';\r\nimport {useWallet} from './wallet';\r\nimport {\r\n  useMarketInfos,\r\n  useTokenAccounts,\r\n} from './markets';\r\nimport {settleAllFunds} from './send';\r\nimport {PreferencesContextValues} from './types';\r\nimport {Market} from \"@project-serum/serum\";\r\n\r\nexport const AUTO_SETTLE_DISABLED_OVERRIDE = true;\r\n\r\nconst PreferencesContext = React.createContext<PreferencesContextValues | null>(\r\n  null,\r\n);\r\n\r\nexport function PreferencesProvider({ children }) {\r\n  const [autoSettleEnabled, setAutoSettleEnabled] = useLocalStorageState(\r\n    'autoSettleEnabled',\r\n    true,\r\n  );\r\n\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const { connected, wallet } = useWallet();\r\n  const marketInfoList = useMarketInfos();\r\n  const [currentlyFetchingMarkets, setCurrentlyFetchingMarkets] = useState<boolean>(false);\r\n  const [markets, setMarkets] = useState<Map<string, Market>>(new Map())\r\n  const addToMarketsMap = (marketId, market) => {\r\n    setMarkets(prev => new Map(prev).set(marketId, market));\r\n  }\r\n  const connection = useConnection();\r\n\r\n  useInterval(() => {\r\n    const autoSettle = async () => {\r\n\t\t\tif (AUTO_SETTLE_DISABLED_OVERRIDE) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n      if (!wallet) {\r\n        return;\r\n      }\r\n      try {\r\n        console.log('Settling funds...');\r\n        await settleAllFunds({\r\n          connection,\r\n          wallet,\r\n          tokenAccounts: tokenAccounts || [],\r\n          markets: [...markets.values()],\r\n        });\r\n      } catch (e) {\r\n        console.log('Error auto settling funds: ' + e.message);\r\n        return;\r\n      }\r\n      console.log('Finished settling funds.');\r\n    };\r\n    (\r\n      connected &&\r\n      wallet?.autoApprove &&\r\n      autoSettleEnabled &&\r\n      autoSettle()\r\n    );\r\n  }, 20000);\r\n\r\n  // warms up the market and open orders cache for auto-settlement\r\n  useInterval(() => {\r\n    const fetchMarkets = async () => {\r\n      if (!wallet) {\r\n        // only need these markets for auto-settlement, so don't fetch unless we are connected.\r\n        return;\r\n      }\r\n      setCurrentlyFetchingMarkets(true);\r\n      for (const marketInfo of marketInfoList) {\r\n        if (markets.has(marketInfo.address.toString())) {\r\n          continue;\r\n        }\r\n        try {\r\n          const market = await Market.load(connection, marketInfo.address, {}, marketInfo.programId)\r\n          addToMarketsMap(marketInfo.address.toString(), market);\r\n          await sleep(1000);\r\n        } catch (e) {\r\n          console.log('Error fetching market: ' + e.message);\r\n        }\r\n      }\r\n      setCurrentlyFetchingMarkets(false);\r\n    }\r\n    (\r\n      connected &&\r\n      wallet?.autoApprove &&\r\n      autoSettleEnabled &&\r\n      !currentlyFetchingMarkets &&\r\n      fetchMarkets()\r\n    );\r\n  }, 60000)\r\n\r\n  return (\r\n    <PreferencesContext.Provider\r\n      value={{\r\n        autoSettleEnabled,\r\n        setAutoSettleEnabled,\r\n      }}\r\n    >\r\n      {children}\r\n    </PreferencesContext.Provider>\r\n  );\r\n}\r\n\r\nexport function usePreferences() {\r\n  const context = useContext(PreferencesContext);\r\n  if (!context) {\r\n    throw new Error('Missing preferences context');\r\n  }\r\n  return {\r\n    autoSettleEnabled: context.autoSettleEnabled,\r\n    setAutoSettleEnabled: context.setAutoSettleEnabled,\r\n  };\r\n}\r\n","import { Button, Col, Divider, Popover, Row } from 'antd';\r\nimport React, { useState } from 'react';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport styled from 'styled-components';\r\nimport {\r\n  useBalances,\r\n  useMarket,\r\n  useSelectedBaseCurrencyAccount,\r\n  useSelectedOpenOrdersAccount,\r\n  useSelectedQuoteCurrencyAccount,\r\n  useTokenAccounts,\r\n} from '../utils/markets';\r\nimport DepositDialog from './DepositDialog';\r\nimport { useWallet } from '../utils/wallet';\r\nimport Link from './Link';\r\nimport { settleFunds } from '../utils/send';\r\nimport { useSendConnection } from '../utils/connection';\r\nimport { notify } from '../utils/notifications';\r\nimport { Balances } from '../utils/types';\r\nimport StandaloneTokenAccountsSelect from './StandaloneTokenAccountSelect';\r\nimport LinkAddress from './LinkAddress';\r\nimport { InfoCircleOutlined } from '@ant-design/icons';\r\nimport { useInterval } from '../utils/useInterval';\r\nimport { useLocalStorageState } from '../utils/utils';\r\nimport { AUTO_SETTLE_DISABLED_OVERRIDE } from '../utils/preferences';\r\nimport { useReferrer } from '../utils/referrer';\r\n\r\nconst RowBox = styled(Row)`\r\n  padding-bottom: 20px;\r\n`;\r\n\r\nconst Tip = styled.p`\r\n  font-size: 12px;\r\n  padding-top: 6px;\r\n`;\r\n\r\nconst ActionButton = styled(Button)`\r\n  color: #3ea018;\r\n  background-color: #191919;\r\n  border-width: 0px;\r\n`;\r\n\r\nexport default function StandaloneBalancesDisplay() {\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const balances = useBalances();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount(true);\r\n  const connection = useSendConnection();\r\n  const { providerUrl, providerName, wallet, connected } = useWallet();\r\n  const [baseOrQuote, setBaseOrQuote] = useState('');\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const [tokenAccounts] = useTokenAccounts();\r\n  const baseCurrencyBalances =\r\n    balances && balances.find((b) => b.coin === baseCurrency);\r\n  const quoteCurrencyBalances =\r\n    balances && balances.find((b) => b.coin === quoteCurrency);\r\n  const [autoSettleEnabled] = useLocalStorageState('autoSettleEnabled', true);\r\n  const [lastSettledAt, setLastSettledAt] = useState<number>(0);\r\n  const { usdcRef, usdtRef } = useReferrer();\r\n  async function onSettleFunds() {\r\n    if (!wallet) {\r\n      notify({\r\n        message: 'Wallet not connected',\r\n        description: 'wallet is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    if (!market) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'market is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!openOrdersAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!baseCurrencyAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n    if (!quoteCurrencyAccount) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: 'Open orders account is undefined',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await settleFunds({\r\n        market,\r\n        openOrders: openOrdersAccount,\r\n        connection,\r\n        wallet,\r\n        baseCurrencyAccount,\r\n        quoteCurrencyAccount,\r\n        usdcRef,\r\n        usdtRef,\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    }\r\n  }\r\n\r\n  useInterval(() => {\r\n    const autoSettle = async () => {\r\n      if (\r\n        AUTO_SETTLE_DISABLED_OVERRIDE ||\r\n        !wallet ||\r\n        !market ||\r\n        !openOrdersAccount ||\r\n        !baseCurrencyAccount ||\r\n        !quoteCurrencyAccount ||\r\n        !autoSettleEnabled\r\n      ) {\r\n        return;\r\n      }\r\n      if (\r\n        !baseCurrencyBalances?.unsettled &&\r\n        !quoteCurrencyBalances?.unsettled\r\n      ) {\r\n        return;\r\n      }\r\n      if (Date.now() - lastSettledAt < 15000) {\r\n        return;\r\n      }\r\n      try {\r\n        console.log('Settling funds...');\r\n        setLastSettledAt(Date.now());\r\n        await settleFunds({\r\n          market,\r\n          openOrders: openOrdersAccount,\r\n          connection,\r\n          wallet,\r\n          baseCurrencyAccount,\r\n          quoteCurrencyAccount,\r\n          usdcRef,\r\n          usdtRef,\r\n        });\r\n      } catch (e) {\r\n        console.log('Error auto settling funds: ' + e.message);\r\n        return;\r\n      }\r\n      console.log('Finished settling funds.');\r\n    };\r\n    connected && wallet?.autoApprove && autoSettleEnabled && autoSettle();\r\n  }, 1000);\r\n\r\n  const formattedBalances: [\r\n    string | undefined,\r\n    Balances | undefined,\r\n    string,\r\n    string | undefined,\r\n  ][] = [\r\n    [\r\n      baseCurrency,\r\n      baseCurrencyBalances,\r\n      'base',\r\n      market?.baseMintAddress.toBase58(),\r\n    ],\r\n    [\r\n      quoteCurrency,\r\n      quoteCurrencyBalances,\r\n      'quote',\r\n      market?.quoteMintAddress.toBase58(),\r\n    ],\r\n  ];\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      {formattedBalances.map(\r\n        ([currency, balances, baseOrQuote, mint], index) => (\r\n          <React.Fragment key={index}>\r\n            <Divider style={{ borderColor: 'white' }}>\r\n              {currency}{' '}\r\n              {mint && (\r\n                <Popover\r\n                  content={<LinkAddress address={mint} />}\r\n                  placement=\"bottomRight\"\r\n                  title=\"Token mint\"\r\n                  trigger=\"hover\"\r\n                >\r\n                  <InfoCircleOutlined style={{ color: '#3ea018' }} />\r\n                </Popover>\r\n              )}\r\n            </Divider>\r\n            {connected && (\r\n              <RowBox align=\"middle\" style={{ paddingBottom: 10 }}>\r\n                <StandaloneTokenAccountsSelect\r\n                  accounts={tokenAccounts?.filter(\r\n                    (account) => account.effectiveMint.toBase58() === mint,\r\n                  )}\r\n                  mint={mint}\r\n                  label\r\n                />\r\n              </RowBox>\r\n            )}\r\n            <RowBox\r\n              align=\"middle\"\r\n              justify=\"space-between\"\r\n              style={{ paddingBottom: 12 }}\r\n            >\r\n              <Col>Wallet balance:</Col>\r\n              <Col>{balances && balances.wallet}</Col>\r\n            </RowBox>\r\n            <RowBox\r\n              align=\"middle\"\r\n              justify=\"space-between\"\r\n              style={{ paddingBottom: 12 }}\r\n            >\r\n              <Col>Unsettled balance:</Col>\r\n              <Col>{balances && balances.unsettled}</Col>\r\n            </RowBox>\r\n            <RowBox align=\"middle\" justify=\"space-around\">\r\n              <Col style={{ width: 150 }}>\r\n                <ActionButton\r\n                  block\r\n                  size=\"large\"\r\n                  onClick={() => setBaseOrQuote(baseOrQuote)}\r\n                >\r\n                  Deposit\r\n                </ActionButton>\r\n              </Col>\r\n              <Col style={{ width: 150 }}>\r\n                <ActionButton block size=\"large\" onClick={onSettleFunds}>\r\n                  Settle\r\n                </ActionButton>\r\n              </Col>\r\n            </RowBox>\r\n            <Tip>\r\n              All deposits go to your{' '}\r\n              <Link external to={providerUrl}>\r\n                {providerName}\r\n              </Link>{' '}\r\n              wallet\r\n            </Tip>\r\n          </React.Fragment>\r\n        ),\r\n      )}\r\n      <DepositDialog\r\n        baseOrQuote={baseOrQuote}\r\n        onClose={() => setBaseOrQuote('')}\r\n      />\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import {Button, Input, Radio, Slider, Switch} from 'antd';\r\nimport React, {useEffect, useState} from 'react';\r\nimport styled from 'styled-components';\r\nimport {\r\n  useFeeDiscountKeys,\r\n  useLocallyStoredFeeDiscountKey,\r\n  useMarket,\r\n  useMarkPrice,\r\n  useSelectedBaseCurrencyAccount,\r\n  useSelectedBaseCurrencyBalances,\r\n  useSelectedOpenOrdersAccount,\r\n  useSelectedQuoteCurrencyAccount,\r\n  useSelectedQuoteCurrencyBalances,\r\n} from '../utils/markets';\r\nimport {useWallet} from '../utils/wallet';\r\nimport {notify} from '../utils/notifications';\r\nimport {floorToDecimal, getDecimalCount, roundToDecimal,} from '../utils/utils';\r\nimport {useSendConnection} from '../utils/connection';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport {getUnixTs, placeOrder} from '../utils/send';\r\nimport {SwitchChangeEventHandler} from 'antd/es/switch';\r\nimport {refreshCache} from '../utils/fetch-loop';\r\nimport tuple from 'immutable-tuple';\r\n\r\nconst SellButton = styled(Button)`\r\n  margin: 20px 0px 0px 0px;\r\n  background: #f23b69;\r\n  border-color: #f23b69;\r\n`;\r\n\r\nconst BuyButton = styled(Button)`\r\n  margin: 20px 0px 0px 0px;\r\n  background: #02bf76;\r\n  border-color: #02bf76;\r\n`;\r\n\r\nconst sliderMarks = {\r\n  0: '0%',\r\n  25: '25%',\r\n  50: '50%',\r\n  75: '75%',\r\n  100: '100%',\r\n};\r\n\r\nexport default function TradeForm({\r\n  style,\r\n  setChangeOrderRef,\r\n}: {\r\n  style?: any;\r\n  setChangeOrderRef?: (\r\n    ref: ({ size, price }: { size?: number; price?: number }) => void,\r\n  ) => void;\r\n}) {\r\n  const [side, setSide] = useState<'buy' | 'sell'>('buy');\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const baseCurrencyBalances = useSelectedBaseCurrencyBalances();\r\n  const quoteCurrencyBalances = useSelectedQuoteCurrencyBalances();\r\n  const baseCurrencyAccount = useSelectedBaseCurrencyAccount();\r\n  const quoteCurrencyAccount = useSelectedQuoteCurrencyAccount();\r\n  const openOrdersAccount = useSelectedOpenOrdersAccount(true);\r\n  const { wallet, connected } = useWallet();\r\n  const sendConnection = useSendConnection();\r\n  const markPrice = useMarkPrice();\r\n  useFeeDiscountKeys();\r\n  const {\r\n    storedFeeDiscountKey: feeDiscountKey,\r\n  } = useLocallyStoredFeeDiscountKey();\r\n\r\n  const [postOnly, setPostOnly] = useState(false);\r\n  const [ioc, setIoc] = useState(false);\r\n  const [baseSize, setBaseSize] = useState<number | undefined>(undefined);\r\n  const [quoteSize, setQuoteSize] = useState<number | undefined>(undefined);\r\n  const [price, setPrice] = useState<number | undefined>(undefined);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [sizeFraction, setSizeFraction] = useState(0);\r\n\r\n  const availableQuote =\r\n    openOrdersAccount && market\r\n      ? market.quoteSplSizeToNumber(openOrdersAccount.quoteTokenFree)\r\n      : 0;\r\n\r\n  let quoteBalance = (quoteCurrencyBalances || 0) + (availableQuote || 0);\r\n  let baseBalance = baseCurrencyBalances || 0;\r\n  let sizeDecimalCount =\r\n    market?.minOrderSize && getDecimalCount(market.minOrderSize);\r\n  let priceDecimalCount = market?.tickSize && getDecimalCount(market.tickSize);\r\n\r\n  const publicKey = wallet?.publicKey;\r\n\r\n  useEffect(() => {\r\n    setChangeOrderRef && setChangeOrderRef(doChangeOrder);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [setChangeOrderRef]);\r\n\r\n  useEffect(() => {\r\n    baseSize && price && onSliderChange(sizeFraction);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [side]);\r\n\r\n  useEffect(() => {\r\n    updateSizeFraction();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [price, baseSize]);\r\n\r\n  useEffect(() => {\r\n    const warmUpCache = async () => {\r\n      try {\r\n        if (!wallet || !publicKey || !market) {\r\n          console.log(`Skipping refreshing accounts`);\r\n          return;\r\n        }\r\n        const startTime = getUnixTs();\r\n        console.log(`Refreshing accounts for ${market.address}`);\r\n        await market?.findOpenOrdersAccountsForOwner(sendConnection, publicKey);\r\n        await market?.findBestFeeDiscountKey(sendConnection, publicKey);\r\n        const endTime = getUnixTs();\r\n        console.log(\r\n          `Finished refreshing accounts for ${market.address} after ${\r\n            endTime - startTime\r\n          }`,\r\n        );\r\n      } catch (e) {\r\n        console.log(`Encountered error when refreshing trading accounts: ${e}`);\r\n      }\r\n    };\r\n    warmUpCache();\r\n    const id = setInterval(warmUpCache, 30_000);\r\n    return () => clearInterval(id);\r\n  }, [market, sendConnection, wallet, publicKey]);\r\n\r\n  const onSetBaseSize = (baseSize: number | undefined) => {\r\n    setBaseSize(baseSize);\r\n    if (!baseSize) {\r\n      setQuoteSize(undefined);\r\n      return;\r\n    }\r\n    let usePrice = price || markPrice;\r\n    if (!usePrice) {\r\n      setQuoteSize(undefined);\r\n      return;\r\n    }\r\n    const rawQuoteSize = baseSize * usePrice;\r\n    const quoteSize =\r\n      baseSize && roundToDecimal(rawQuoteSize, sizeDecimalCount);\r\n    setQuoteSize(quoteSize);\r\n  };\r\n\r\n  const onSetQuoteSize = (quoteSize: number | undefined) => {\r\n    setQuoteSize(quoteSize);\r\n    if (!quoteSize) {\r\n      setBaseSize(undefined);\r\n      return;\r\n    }\r\n    let usePrice = price || markPrice;\r\n    if (!usePrice) {\r\n      setBaseSize(undefined);\r\n      return;\r\n    }\r\n    const rawBaseSize = quoteSize / usePrice;\r\n    const baseSize = quoteSize && roundToDecimal(rawBaseSize, sizeDecimalCount);\r\n    setBaseSize(baseSize);\r\n  };\r\n\r\n  const doChangeOrder = ({\r\n    size,\r\n    price,\r\n  }: {\r\n    size?: number;\r\n    price?: number;\r\n  }) => {\r\n    const formattedSize = size && roundToDecimal(size, sizeDecimalCount);\r\n    const formattedPrice = price && roundToDecimal(price, priceDecimalCount);\r\n    formattedSize && onSetBaseSize(formattedSize);\r\n    formattedPrice && setPrice(formattedPrice);\r\n  };\r\n\r\n  const updateSizeFraction = () => {\r\n    const rawMaxSize =\r\n      side === 'buy' ? quoteBalance / (price || markPrice || 1) : baseBalance;\r\n    const maxSize = floorToDecimal(rawMaxSize, sizeDecimalCount);\r\n    const sizeFraction = Math.min(((baseSize || 0) / maxSize) * 100, 100);\r\n    setSizeFraction(sizeFraction);\r\n  };\r\n\r\n  const onSliderChange = (value) => {\r\n    if (!price && markPrice) {\r\n      let formattedMarkPrice: number | string = priceDecimalCount\r\n        ? markPrice.toFixed(priceDecimalCount)\r\n        : markPrice;\r\n      setPrice(\r\n        typeof formattedMarkPrice === 'number'\r\n          ? formattedMarkPrice\r\n          : parseFloat(formattedMarkPrice),\r\n      );\r\n    }\r\n\r\n    let newSize;\r\n    if (side === 'buy') {\r\n      if (price || markPrice) {\r\n        newSize = ((quoteBalance / (price || markPrice || 1)) * value) / 100;\r\n      }\r\n    } else {\r\n      newSize = (baseBalance * value) / 100;\r\n    }\r\n\r\n    // round down to minOrderSize increment\r\n    let formatted = floorToDecimal(newSize, sizeDecimalCount);\r\n\r\n    onSetBaseSize(formatted);\r\n  };\r\n\r\n  const postOnChange: SwitchChangeEventHandler = (checked) => {\r\n    if (checked) {\r\n      setIoc(false);\r\n    }\r\n    setPostOnly(checked);\r\n  };\r\n  const iocOnChange: SwitchChangeEventHandler = (checked) => {\r\n    if (checked) {\r\n      setPostOnly(false);\r\n    }\r\n    setIoc(checked);\r\n  };\r\n\r\n  async function onSubmit() {\r\n    if (!price) {\r\n      console.warn('Missing price');\r\n      notify({\r\n        message: 'Missing price',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    } else if (!baseSize) {\r\n      console.warn('Missing size');\r\n      notify({\r\n        message: 'Missing size',\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      if (!wallet) {\r\n        return null;\r\n      }\r\n\r\n      await placeOrder({\r\n        side,\r\n        price,\r\n        size: baseSize,\r\n        orderType: ioc ? 'ioc' : postOnly ? 'postOnly' : 'limit',\r\n        market,\r\n        connection: sendConnection,\r\n        wallet,\r\n        baseCurrencyAccount: baseCurrencyAccount?.pubkey,\r\n        quoteCurrencyAccount: quoteCurrencyAccount?.pubkey,\r\n        feeDiscountPubkey: feeDiscountKey,\r\n      });\r\n      refreshCache(tuple('getTokenAccounts', wallet, connected));\r\n      setPrice(undefined);\r\n      onSetBaseSize(undefined);\r\n    } catch (e) {\r\n      console.warn(e);\r\n      notify({\r\n        message: 'Error placing order',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={{ display: 'flex', flexDirection: 'column', ...style }}\r\n    >\r\n      <div style={{ flex: 1 }}>\r\n        <Radio.Group\r\n          onChange={(e) => setSide(e.target.value)}\r\n          value={side}\r\n          buttonStyle=\"solid\"\r\n          style={{\r\n            marginBottom: 8,\r\n            width: '100%',\r\n          }}\r\n        >\r\n          <Radio.Button\r\n            value=\"buy\"\r\n            style={{\r\n              width: '50%',\r\n              textAlign: 'center',\r\n              background: side === 'buy' ? '#02bf76' : '',\r\n              borderColor: side === 'buy' ? '#02bf76' : '',\r\n            }}\r\n          >\r\n            BUY\r\n          </Radio.Button>\r\n          <Radio.Button\r\n            value=\"sell\"\r\n            style={{\r\n              width: '50%',\r\n              textAlign: 'center',\r\n              background: side === 'sell' ? '#F23B69' : '',\r\n              borderColor: side === 'sell' ? '#F23B69' : '',\r\n            }}\r\n          >\r\n            SELL\r\n          </Radio.Button>\r\n        </Radio.Group>\r\n        <Input\r\n          style={{ textAlign: 'right', paddingBottom: 8 }}\r\n          addonBefore={<div style={{ width: '30px' }}>Price</div>}\r\n          suffix={\r\n            <span style={{ fontSize: 10, opacity: 0.5 }}>{quoteCurrency}</span>\r\n          }\r\n          value={price}\r\n          type=\"number\"\r\n          step={market?.tickSize || 1}\r\n          onChange={(e) => setPrice(parseFloat(e.target.value))}\r\n        />\r\n        <Input.Group compact style={{ paddingBottom: 8 }}>\r\n          <Input\r\n            style={{ width: 'calc(50% + 30px)', textAlign: 'right' }}\r\n            addonBefore={<div style={{ width: '30px' }}>Size</div>}\r\n            suffix={\r\n              <span style={{ fontSize: 10, opacity: 0.5 }}>{baseCurrency}</span>\r\n            }\r\n            value={baseSize}\r\n            type=\"number\"\r\n            step={market?.minOrderSize || 1}\r\n            onChange={(e) => onSetBaseSize(parseFloat(e.target.value))}\r\n          />\r\n          <Input\r\n            style={{ width: 'calc(50% - 30px)', textAlign: 'right' }}\r\n            suffix={\r\n              <span style={{ fontSize: 10, opacity: 0.5 }}>\r\n                {quoteCurrency}\r\n              </span>\r\n            }\r\n            value={quoteSize}\r\n            type=\"number\"\r\n            step={market?.minOrderSize || 1}\r\n            onChange={(e) => onSetQuoteSize(parseFloat(e.target.value))}\r\n          />\r\n        </Input.Group>\r\n        <Slider\r\n          value={sizeFraction}\r\n          tipFormatter={(value) => `${value}%`}\r\n          marks={sliderMarks}\r\n          onChange={onSliderChange}\r\n        />\r\n        <div style={{ paddingTop: 18 }}>\r\n          {'POST '}\r\n          <Switch\r\n            checked={postOnly}\r\n            onChange={postOnChange}\r\n            style={{ marginRight: 40 }}\r\n          />\r\n          {'IOC '}\r\n          <Switch checked={ioc} onChange={iocOnChange} />\r\n        </div>\r\n      </div>\r\n      {side === 'buy' ? (\r\n        <BuyButton\r\n          disabled={!price || !baseSize}\r\n          onClick={onSubmit}\r\n          block\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          loading={submitting}\r\n        >\r\n          Buy {baseCurrency}\r\n        </BuyButton>\r\n      ) : (\r\n        <SellButton\r\n          disabled={!price || !baseSize}\r\n          onClick={onSubmit}\r\n          block\r\n          type=\"primary\"\r\n          size=\"large\"\r\n          loading={submitting}\r\n        >\r\n          Sell {baseCurrency}\r\n        </SellButton>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import { Col, Row } from 'antd';\r\nimport React from 'react';\r\nimport styled from 'styled-components';\r\nimport { useMarket, useBonfidaTrades } from '../utils/markets';\r\nimport { getDecimalCount } from '../utils/utils';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport { BonfidaTrade } from '../utils/types';\r\n\r\nconst Title = styled.div`\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\nconst SizeTitle = styled(Row)`\r\n  padding: 0px 0 14px;\r\n  color: rgba(255, 255, 255, 1);\r\n`;\r\n\r\nexport default function PublicTrades({ smallScreen }) {\r\n  const { baseCurrency, quoteCurrency, market } = useMarket();\r\n  const [trades, loaded] = useBonfidaTrades();\r\n\r\n  return (\r\n    <FloatingElement\r\n      style={\r\n        smallScreen\r\n          ? { flex: 1 }\r\n          : {\r\n              marginTop: '10px',\r\n              minHeight: '270px',\r\n              maxHeight: 'calc(100vh - 700px)',\r\n            }\r\n      }\r\n    >\r\n      <Title>Recent Market trades</Title>\r\n      <SizeTitle>\r\n        <Col span={8}>Price ({quoteCurrency}) </Col>\r\n        <Col span={8} style={{ textAlign: 'right' }}>\r\n          Size ({baseCurrency})\r\n        </Col>\r\n        <Col span={8} style={{ textAlign: 'right' }}>\r\n          Time\r\n        </Col>\r\n      </SizeTitle>\r\n      {!!trades && loaded && (\r\n        <div\r\n          style={{\r\n            marginRight: '-20px',\r\n            paddingRight: '5px',\r\n            overflowY: 'scroll',\r\n            maxHeight: smallScreen\r\n              ? 'calc(100% - 75px)'\r\n              : 'calc(100vh - 570px)',\r\n          }}\r\n        >\r\n          {trades.map((trade: BonfidaTrade, i: number) => (\r\n            <Row key={i} style={{ marginBottom: 4 }}>\r\n              <Col\r\n                span={8}\r\n                style={{\r\n                  color: trade.side === 'buy' ? '#41C77A' : '#F23B69',\r\n                }}\r\n              >\r\n                {market?.tickSize && !isNaN(trade.price)\r\n                  ? Number(trade.price).toFixed(\r\n                      getDecimalCount(market.tickSize),\r\n                    )\r\n                  : trade.price}\r\n              </Col>\r\n              <Col span={8} style={{ textAlign: 'right' }}>\r\n                {market?.minOrderSize && !isNaN(trade.size)\r\n                  ? Number(trade.size).toFixed(\r\n                      getDecimalCount(market.minOrderSize),\r\n                    )\r\n                  : trade.size}\r\n              </Col>\r\n              <Col span={8} style={{ textAlign: 'right', color: '#44a59' }}>\r\n                {trade.time && new Date(trade.time).toLocaleTimeString()}\r\n              </Col>\r\n            </Row>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import { Button, Divider, Spin, Typography } from 'antd';\r\nimport React from 'react';\r\nimport {\r\n  useGetOpenOrdersForDeprecatedMarkets,\r\n  useBalancesForDeprecatedMarkets,\r\n  useUnmigratedOpenOrdersAccounts,\r\n} from '../utils/markets';\r\nimport FloatingElement from './layout/FloatingElement';\r\nimport CheckOutlined from '@ant-design/icons/lib/icons/CheckOutlined';\r\nimport BalancesTable from './UserInfoTable/BalancesTable';\r\nimport OpenOrderTable from './UserInfoTable/OpenOrderTable';\r\nimport SyncOutlined from '@ant-design/icons/lib/icons/SyncOutlined';\r\n\r\nconst { Title } = Typography;\r\n\r\nexport default function DeprecatedMarketsInstructions({ switchToLiveMarkets }) {\r\n  const balances = useBalancesForDeprecatedMarkets();\r\n  const {\r\n    openOrders,\r\n    loaded,\r\n    refreshOpenOrders,\r\n  } = useGetOpenOrdersForDeprecatedMarkets();\r\n\r\n  const { refresh } = useUnmigratedOpenOrdersAccounts();\r\n  const needToCancelOrders = !openOrders || openOrders.length > 0;\r\n  const filteredBalances =\r\n    balances &&\r\n    balances.filter(({ orders, unsettled }) => orders > 0 || unsettled > 0);\r\n  const needToSettleFunds = filteredBalances && filteredBalances.length > 0;\r\n  return (\r\n    <FloatingElement>\r\n      <Title level={4} style={{ color: 'rgba(255, 255, 255, 1)' }}>\r\n        Migrate new markets\r\n      </Title>\r\n      <Typography>\r\n        Markets on older versions of the DEX or using Wrapped USDT are now deprecated. To migrate over\r\n        to the new markets, please cancel your orders and settle your funds on old markets. To convert\r\n        from Wrapped USDT to Native USDT use sollet.io.\r\n      </Typography>\r\n      <div style={{ marginTop: 20, display: 'flex', justifyContent: 'center' }}>\r\n        <Button onClick={() => refresh(true)}>\r\n          <SyncOutlined /> Refresh data\r\n        </Button>\r\n      </div>\r\n      {!balances ? (\r\n        <Spin size=\"large\" />\r\n      ) : (\r\n        <>\r\n          <Divider>\r\n            {!needToCancelOrders && <CheckOutlined />} Cancel your orders\r\n          </Divider>\r\n          {needToCancelOrders ? (\r\n            loaded ? (\r\n              <OpenOrderTable\r\n                openOrders={openOrders}\r\n                onCancelSuccess={() => {\r\n                  setTimeout(() => {\r\n                    refresh();\r\n                    refreshOpenOrders();\r\n                  }, 1000); // Wait so that on-chain account state reflects the update\r\n                }}\r\n              />\r\n            ) : (\r\n              <Spin size=\"large\" />\r\n            )\r\n          ) : null}\r\n          <Divider>\r\n            {!needToSettleFunds && <CheckOutlined />} Settle your funds\r\n          </Divider>\r\n          {needToSettleFunds && (\r\n            <BalancesTable\r\n              balances={filteredBalances}\r\n              hideWalletBalance\r\n              showMarket\r\n              onSettleSuccess={() => {\r\n                setTimeout(refresh, 1000); // Wait so that on-chain account state reflects the update\r\n              }}\r\n            />\r\n          )}\r\n          <Divider>Switch to upgraded markets</Divider>\r\n          <div style={{ display: 'flex', justifyContent: 'center' }}>\r\n            <Button\r\n              onClick={switchToLiveMarkets}\r\n              disabled={needToSettleFunds || needToCancelOrders}\r\n            >\r\n              Switch to new markets\r\n            </Button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { Button, Col, Popover, Row, Select, Typography } from 'antd';\r\nimport styled from 'styled-components';\r\nimport Orderbook from '../components/Orderbook';\r\nimport UserInfoTable from '../components/UserInfoTable';\r\nimport StandaloneBalancesDisplay from '../components/StandaloneBalancesDisplay';\r\nimport {\r\n  getMarketInfos,\r\n  getTradePageUrl,\r\n  MarketProvider,\r\n  useMarket,\r\n  useMarketsList,\r\n  useUnmigratedDeprecatedMarkets,\r\n} from '../utils/markets';\r\nimport TradeForm from '../components/TradeForm';\r\nimport TradesTable from '../components/TradesTable';\r\nimport LinkAddress from '../components/LinkAddress';\r\nimport DeprecatedMarketsInstructions from '../components/DeprecatedMarketsInstructions';\r\nimport {\r\n  DeleteOutlined,\r\n  InfoCircleOutlined,\r\n} from '@ant-design/icons';\r\nimport { useHistory, useParams } from 'react-router-dom';\r\nimport { nanoid } from 'nanoid';\r\n\r\n// import { TVChartContainer } from '../components/TradingView';\r\n// Use following stub for quick setup without the TradingView private dependency\r\n// function TVChartContainer() {\r\n//   return <></>\r\n// }\r\n\r\nconst { Option, OptGroup } = Select;\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 16px 16px;\r\n  .borderNone .ant-select-selector {\r\n    border: none !important;\r\n  }\r\n`;\r\n\r\nexport default function TradePage() {\r\n  const { marketAddress } = useParams();\r\n  useEffect(() => {\r\n    if (marketAddress) {\r\n      localStorage.setItem('marketAddress', JSON.stringify(marketAddress));\r\n    }\r\n  }, [marketAddress]);\r\n  const history = useHistory();\r\n  function setMarketAddress(address) {\r\n    history.push(getTradePageUrl(address));\r\n  }\r\n\r\n  return (\r\n    <MarketProvider\r\n      marketAddress={marketAddress}\r\n      setMarketAddress={setMarketAddress}\r\n    >\r\n      <TradePageInner />\r\n    </MarketProvider>\r\n  );\r\n}\r\n\r\nfunction TradePageInner() {\r\n  const {\r\n    market,\r\n    marketName,\r\n    customMarkets,\r\n  } = useMarket();\r\n  const markets = useMarketsList();\r\n  const [handleDeprecated, setHandleDeprecated] = useState(false);\r\n  const deprecatedMarkets = useUnmigratedDeprecatedMarkets();\r\n  const [dimensions, setDimensions] = useState({\r\n    height: window.innerHeight,\r\n    width: window.innerWidth,\r\n  });\r\n\r\n  useEffect(() => {\r\n    document.title = marketName ? `${marketName} — Serum` : 'Serum';\r\n  }, [marketName]);\r\n\r\n  const changeOrderRef = useRef<\r\n    ({ size, price }: { size?: number; price?: number }) => void\r\n  >();\r\n\r\n  useEffect(() => {\r\n    const handleResize = () => {\r\n      setDimensions({\r\n        height: window.innerHeight,\r\n        width: window.innerWidth,\r\n      });\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, []);\r\n\r\n  const width = dimensions?.width;\r\n  const componentProps = {\r\n    onChangeOrderRef: (ref) => (changeOrderRef.current = ref),\r\n    onPrice: useCallback(\r\n      (price) => changeOrderRef.current && changeOrderRef.current({ price }),\r\n      [],\r\n    ),\r\n    onSize: useCallback(\r\n      (size) => changeOrderRef.current && changeOrderRef.current({ size }),\r\n      [],\r\n    ),\r\n  };\r\n  const component = (() => {\r\n    if (handleDeprecated) {\r\n      return (\r\n        <DeprecatedMarketsPage\r\n          switchToLiveMarkets={() => setHandleDeprecated(false)}\r\n        />\r\n      );\r\n    } else if (width < 1000) {\r\n      return <RenderSmaller {...componentProps} />;\r\n    } else if (width < 1450) {\r\n      return <RenderSmall {...componentProps} />;\r\n    } else {\r\n      return <RenderSmall {...componentProps} />;\r\n    }\r\n  })();\r\n\r\n\r\n  return (\r\n    <>\r\n      <Wrapper>\r\n        <Row\r\n          align=\"middle\"\r\n          style={{ paddingLeft: 5, paddingRight: 5 }}\r\n          gutter={16}\r\n        >\r\n          <Col>\r\n            <MarketSelector\r\n              markets={markets}\r\n              setHandleDeprecated={setHandleDeprecated}\r\n              placeholder={'Select market'}\r\n              customMarkets={customMarkets}\r\n              onDeleteCustomMarket={\"onDeleteCustomMarket\"}\r\n            />\r\n          </Col>\r\n          {market ? (\r\n            <Col>\r\n              <Popover\r\n                content={<LinkAddress address={market.publicKey.toBase58()} />}\r\n                placement=\"bottomRight\"\r\n                title=\"Market address\"\r\n                trigger=\"click\"\r\n              >\r\n                <InfoCircleOutlined style={{ color: '#3ea018' }} />\r\n              </Popover>\r\n            </Col>\r\n          ) : null}\r\n          <Col>\r\n          </Col>\r\n          {deprecatedMarkets && deprecatedMarkets.length > 0 && (\r\n            <React.Fragment>\r\n              <Col>\r\n                <Typography>\r\n                  You have unsettled funds on old markets! Please go through\r\n                  them to claim your funds.\r\n                </Typography>\r\n              </Col>\r\n              <Col>\r\n                <Button onClick={() => setHandleDeprecated(!handleDeprecated)}>\r\n                  {handleDeprecated ? 'View new markets' : 'Handle old markets'}\r\n                </Button>\r\n              </Col>\r\n            </React.Fragment>\r\n          )}\r\n        </Row>\r\n        {component}\r\n      </Wrapper>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction MarketSelector({\r\n  markets,\r\n  placeholder,\r\n  setHandleDeprecated,\r\n  customMarkets,\r\n  onDeleteCustomMarket,\r\n}) {\r\n  const { market, setMarketAddress } = useMarket();\r\n\r\n  const onSetMarketAddress = (marketAddress) => {\r\n    setHandleDeprecated(false);\r\n    setMarketAddress(marketAddress);\r\n  };\r\n\r\n  const extractBase = (a) => a.split('/')[0];\r\n  const extractQuote = (a) => a.split('/')[1];\r\n\r\n  const selectedMarket = getMarketInfos(customMarkets)\r\n    .find(\r\n      (proposedMarket) =>\r\n        market?.address && proposedMarket.address.equals(market.address),\r\n    )\r\n    ?.address?.toBase58();\r\n\r\n  return (\r\n    <Select\r\n      showSearch\r\n      size={'large'}\r\n      style={{ width: 200 }}\r\n      placeholder={placeholder || 'Select a market'}\r\n      optionFilterProp=\"name\"\r\n      onSelect={onSetMarketAddress}\r\n      listHeight={400}\r\n      value={selectedMarket}\r\n      filterOption={(input, option) =>\r\n        option?.name?.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n      }\r\n    >\r\n      {customMarkets && customMarkets.length > 0 && (\r\n        <OptGroup label=\"Custom\">\r\n          {customMarkets.map(({ address, name }, i) => (\r\n            <Option\r\n              value={address}\r\n              key={nanoid()}\r\n              name={name}\r\n              style={{\r\n                padding: '10px',\r\n                // @ts-ignore\r\n                backgroundColor: i % 2 === 0 ? 'rgb(39, 44, 61)' : null,\r\n              }}\r\n            >\r\n              <Row>\r\n                <Col flex=\"auto\">{name}</Col>\r\n                {selectedMarket !== address && (\r\n                  <Col>\r\n                    <DeleteOutlined\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        e.nativeEvent.stopImmediatePropagation();\r\n                        onDeleteCustomMarket && onDeleteCustomMarket(address);\r\n                      }}\r\n                    />\r\n                  </Col>\r\n                )}\r\n              </Row>\r\n            </Option>\r\n          ))}\r\n        </OptGroup>\r\n      )}\r\n      <OptGroup label=\"Markets\">\r\n        {markets\r\n          .sort((a, b) =>\r\n            extractQuote(a.name) === 'USDT' && extractQuote(b.name) !== 'USDT'\r\n              ? -1\r\n              : extractQuote(a.name) !== 'USDT' &&\r\n                extractQuote(b.name) === 'USDT'\r\n              ? 1\r\n              : 0,\r\n          )\r\n          .sort((a, b) =>\r\n            extractBase(a.name) < extractBase(b.name)\r\n              ? -1\r\n              : extractBase(a.name) > extractBase(b.name)\r\n              ? 1\r\n              : 0,\r\n          )\r\n          .map(({ address, name, deprecated }, i) => (\r\n            <Option\r\n              value={address.toBase58()}\r\n              key={nanoid()}\r\n              name={name}\r\n              style={{\r\n                padding: '10px',\r\n                // @ts-ignore\r\n                backgroundColor: i % 2 === 0 ? 'rgb(39, 44, 61)' : null,\r\n              }}\r\n            >\r\n              {name} {deprecated ? ' (Deprecated)' : null}\r\n            </Option>\r\n          ))}\r\n      </OptGroup>\r\n    </Select>\r\n  );\r\n}\r\n\r\nconst DeprecatedMarketsPage = ({ switchToLiveMarkets }) => {\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <DeprecatedMarketsInstructions\r\n            switchToLiveMarkets={switchToLiveMarkets}\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n\r\nconst RenderNormal = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <Row\r\n      style={{\r\n        minHeight: '900px',\r\n        flexWrap: 'nowrap',\r\n      }}\r\n    >\r\n      <Col flex=\"auto\" style={{ height: '50vh' }}>\r\n        {/* <Row style={{ height: '0%' }}>\r\n          <TVChartContainer />\r\n        </Row> */}\r\n        <Row style={{ height: '70%' }}>\r\n          <UserInfoTable />\r\n        </Row>\r\n      </Col>\r\n      <Col flex={'360px'} style={{ height: '100%' }}>\r\n        <Orderbook smallScreen={false} onPrice={onPrice} onSize={onSize} />\r\n        <TradesTable smallScreen={false} />\r\n      </Col>\r\n      <Col\r\n        flex=\"400px\"\r\n        style={{ height: '100%', display: 'flex', flexDirection: 'column' }}\r\n      >\r\n        <TradeForm setChangeOrderRef={onChangeOrderRef} />\r\n        <StandaloneBalancesDisplay />\r\n      </Col>\r\n    </Row>\r\n  );\r\n};\r\n\r\nconst RenderSmall = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <>\r\n      {/* <Row style={{ height: '30vh' }}>\r\n        <TVChartContainer />\r\n      </Row> */}\r\n      <Row\r\n        style={{\r\n          height: '900px',\r\n        }}\r\n      >\r\n        <Col flex=\"auto\" style={{ height: '100%', display: 'flex' }}>\r\n          <Orderbook\r\n            smallScreen={true}\r\n            depth={13}\r\n            onPrice={onPrice}\r\n            onSize={onSize}\r\n          />\r\n        </Col>\r\n        <Col flex=\"auto\" style={{ height: '100%', display: 'flex' }}>\r\n          <TradesTable smallScreen={true} />\r\n        </Col>\r\n        <Col\r\n          flex=\"400px\"\r\n          style={{ height: '100%', display: 'flex', flexDirection: 'column' }}\r\n        >\r\n          <TradeForm setChangeOrderRef={onChangeOrderRef} />\r\n          <StandaloneBalancesDisplay />\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <UserInfoTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n\r\nconst RenderSmaller = ({ onChangeOrderRef, onPrice, onSize }) => {\r\n  return (\r\n    <>\r\n      {/* <Row style={{ height: '50vh' }}>\r\n        <TVChartContainer />\r\n      </Row> */}\r\n      <Row>\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <TradeForm style={{ flex: 1 }} setChangeOrderRef={onChangeOrderRef} />\r\n        </Col>\r\n        <Col xs={24} sm={12}>\r\n          <StandaloneBalancesDisplay />\r\n        </Col>\r\n      </Row>\r\n      <Row\r\n        style={{\r\n          height: '500px',\r\n        }}\r\n      >\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <Orderbook smallScreen={true} onPrice={onPrice} onSize={onSize} />\r\n        </Col>\r\n        <Col xs={24} sm={12} style={{ height: '100%', display: 'flex' }}>\r\n          <TradesTable smallScreen={true} />\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col flex=\"auto\">\r\n          <UserInfoTable />\r\n        </Col>\r\n      </Row>\r\n    </>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { Dropdown, Menu } from 'antd';\r\nimport { useWallet } from '../utils/wallet';\r\nimport LinkAddress from './LinkAddress';\r\n\r\nexport default function WalletConnect() {\r\n  const { connected, wallet, select, connect, disconnect } = useWallet();\r\n  const publicKey = (connected && wallet?.publicKey?.toBase58()) || '';\r\n\r\n  const menu = (\r\n    <Menu>\r\n      {connected && <LinkAddress shorten={true} address={publicKey} />}\r\n      <Menu.Item key=\"3\" onClick={select}>\r\n        Change Wallet\r\n      </Menu.Item>\r\n    </Menu>\r\n  );\r\n\r\n  return (\r\n    <Dropdown.Button onClick={connected ? disconnect : connect} overlay={menu}>\r\n      {connected ? 'Disconnect' : 'Connect'}\r\n    </Dropdown.Button>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport FloatingElement from '../components/layout/FloatingElement';\r\nimport {\r\n  useAllMarkets,\r\n  useAllOpenOrders,\r\n  useMarketInfos,\r\n} from '../utils/markets';\r\nimport OpenOrderTable from '../components/UserInfoTable/OpenOrderTable';\r\nimport { Button, Row } from 'antd';\r\nimport { OrderWithMarketAndMarketName } from '../utils/types';\r\nimport { useWallet } from '../utils/wallet';\r\nimport WalletConnect from '../components/WalletConnect';\r\n\r\nexport default function OpenOrdersPage() {\r\n  const { connected } = useWallet();\r\n  const { openOrders, loaded, refreshOpenOrders } = useAllOpenOrders();\r\n  let marketInfos = useMarketInfos();\r\n  let marketAddressesToNames = Object.fromEntries(\r\n    marketInfos.map((info) => [info.address.toBase58(), info.name]),\r\n  );\r\n  let [allMarkets] = useAllMarkets();\r\n  const marketsByAddress = Object.fromEntries(\r\n    (allMarkets || []).map((marketInfo) => [\r\n      marketInfo.market.address.toBase58(),\r\n      marketInfo.market,\r\n    ]),\r\n  );\r\n\r\n  const dataSource: OrderWithMarketAndMarketName[] = (openOrders || [])\r\n    .map((orderInfos) =>\r\n      orderInfos.orders.map((order) => {\r\n        return {\r\n          marketName: marketAddressesToNames[orderInfos.marketAddress],\r\n          market: marketsByAddress[orderInfos.marketAddress],\r\n          ...order,\r\n        };\r\n      }),\r\n    )\r\n    .flat();\r\n\r\n  if (!connected) {\r\n    return (\r\n      <Row\r\n        justify=\"center\"\r\n        style={{\r\n          marginTop: '10%',\r\n        }}\r\n      >\r\n        <WalletConnect />\r\n      </Row>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      <Button onClick={refreshOpenOrders} loading={!loaded}>\r\n        Refresh\r\n      </Button>\r\n      <OpenOrderTable\r\n        openOrders={dataSource}\r\n        pageSize={25}\r\n        loading={!loaded}\r\n        onCancelSuccess={refreshOpenOrders}\r\n        marketFilter\r\n      />\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport DataTable from '../layout/DataTable';\r\nimport { Button, Row } from 'antd';\r\nimport { settleAllFunds } from '../../utils/send';\r\nimport { notify } from '../../utils/notifications';\r\nimport { useConnection } from '../../utils/connection';\r\nimport { useWallet } from '../../utils/wallet';\r\nimport {\r\n  useAllMarkets,\r\n  useSelectedTokenAccounts,\r\n  useTokenAccounts,\r\n} from '../../utils/markets';\r\nimport StandaloneTokenAccountsSelect from '../StandaloneTokenAccountSelect';\r\nimport { abbreviateAddress } from '../../utils/utils';\r\nimport { PublicKey } from '@solana/web3.js';\r\n\r\nexport default function WalletBalancesTable({\r\n  walletBalances,\r\n}: {\r\n  walletBalances: {\r\n    coin: string;\r\n    mint: string;\r\n    walletBalance: number;\r\n    openOrdersFree: number;\r\n    openOrdersTotal: number;\r\n  }[];\r\n}) {\r\n  const connection = useConnection();\r\n  const { wallet, connected } = useWallet();\r\n  const [selectedTokenAccounts] = useSelectedTokenAccounts();\r\n  const [tokenAccounts, tokenAccountsConnected] = useTokenAccounts();\r\n  const [allMarkets, allMarketsConnected] = useAllMarkets();\r\n  const [settlingFunds, setSettlingFunds] = useState(false);\r\n\r\n  async function onSettleFunds() {\r\n    setSettlingFunds(true);\r\n    try {\r\n      if (!wallet) {\r\n        notify({\r\n          message: 'Wallet not connected',\r\n          description: 'Wallet not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (!tokenAccounts || !tokenAccountsConnected) {\r\n        notify({\r\n          message: 'Error settling funds',\r\n          description: 'TokenAccounts not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      if (!allMarkets || !allMarketsConnected) {\r\n        notify({\r\n          message: 'Error settling funds',\r\n          description: 'Markets not connected',\r\n          type: 'error',\r\n        });\r\n        return;\r\n      }\r\n      await settleAllFunds({\r\n        connection,\r\n        tokenAccounts,\r\n        selectedTokenAccounts,\r\n        wallet,\r\n        markets: allMarkets.map((marketInfo) => marketInfo.market),\r\n      });\r\n    } catch (e) {\r\n      notify({\r\n        message: 'Error settling funds',\r\n        description: e.message,\r\n        type: 'error',\r\n      });\r\n    } finally {\r\n      setSettlingFunds(false);\r\n    }\r\n  }\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Coin',\r\n      key: 'coin',\r\n      width: '20%',\r\n      render: (walletBalance) => (\r\n        <Row align=\"middle\">\r\n          <a\r\n            href={`https://solscan.io/address/${walletBalance.mint}`}\r\n            target={'_blank'}\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            {walletBalance.coin ||\r\n              abbreviateAddress(new PublicKey(walletBalance.mint))}\r\n          </a>\r\n        </Row>\r\n      ),\r\n    },\r\n    {\r\n      title: 'Wallet Balance',\r\n      dataIndex: 'walletBalance',\r\n      key: 'walletBalance',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Open orders total balances',\r\n      dataIndex: 'openOrdersTotal',\r\n      key: 'openOrdersTotal',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Unsettled balances',\r\n      dataIndex: 'openOrdersFree',\r\n      key: 'openOrdersFree',\r\n      width: '20%',\r\n    },\r\n    {\r\n      title: 'Selected token account',\r\n      key: 'selectTokenAccount',\r\n      width: '20%',\r\n      render: (walletBalance) => (\r\n        <Row align=\"middle\" style={{ width: '430px' }}>\r\n          <StandaloneTokenAccountsSelect\r\n            accounts={tokenAccounts?.filter(\r\n              (t) => t.effectiveMint.toBase58() === walletBalance.mint,\r\n            )}\r\n            mint={walletBalance.mint}\r\n          />\r\n        </Row>\r\n      ),\r\n    },\r\n  ];\r\n  return (\r\n    <React.Fragment>\r\n      <DataTable\r\n        emptyLabel=\"No balances\"\r\n        dataSource={walletBalances}\r\n        columns={columns}\r\n        pagination={false}\r\n      />\r\n      {connected && (\r\n        <Button onClick={onSettleFunds} loading={settlingFunds}>\r\n          Settle all funds\r\n        </Button>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Tabs } from 'antd';\r\nimport {\r\n  useAllOpenOrdersBalances,\r\n  useWalletBalancesForAllMarkets,\r\n} from '../utils/markets';\r\nimport FloatingElement from '../components/layout/FloatingElement';\r\nimport WalletBalancesTable from '../components/UserInfoTable/WalletBalancesTable';\r\nimport { useMintToTickers } from '../utils/tokens';\r\n\r\nconst { TabPane } = Tabs;\r\n\r\nexport default function BalancesPage() {\r\n  const walletBalances = useWalletBalancesForAllMarkets();\r\n  const mintToTickers = useMintToTickers();\r\n  const openOrdersBalances = useAllOpenOrdersBalances();\r\n\r\n  const data = (walletBalances || []).map((balance) => {\r\n    const balances = {\r\n      coin: mintToTickers[balance.mint],\r\n      mint: balance.mint,\r\n      walletBalance: balance.balance,\r\n      openOrdersFree: 0,\r\n      openOrdersTotal: 0,\r\n    };\r\n    for (let openOrdersAccount of openOrdersBalances[balance.mint] || []) {\r\n      balances['openOrdersFree'] += openOrdersAccount.free;\r\n      balances['openOrdersTotal'] += openOrdersAccount.total;\r\n    }\r\n    return balances;\r\n  });\r\n\r\n  return (\r\n    <FloatingElement style={{ flex: 1, paddingTop: 10 }}>\r\n      <Tabs defaultActiveKey=\"walletBalances\">\r\n        <TabPane tab=\"Wallet Balances\" key=\"walletBalances\">\r\n          <WalletBalancesTable walletBalances={data} />\r\n        </TabPane>\r\n      </Tabs>\r\n    </FloatingElement>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Switch, Typography } from 'antd';\r\nimport { usePreferences } from '../utils/preferences';\r\n\r\nconst { Paragraph } = Typography;\r\n\r\nexport default function Settings({ autoApprove }) {\r\n  const { autoSettleEnabled, setAutoSettleEnabled } = usePreferences();\r\n\r\n  return (\r\n    <div>\r\n      <Switch\r\n        style={{ marginRight: 10 }}\r\n        disabled={!autoApprove}\r\n        checked={autoApprove && autoSettleEnabled}\r\n        onChange={setAutoSettleEnabled}\r\n      />{' '}\r\n      Auto settle\r\n      {!autoApprove && (\r\n        <Paragraph style={{ color: 'rgba(255,255,255,0.5)', marginTop: 10 }}>\r\n          To use auto settle, first enable auto approval in your wallet\r\n        </Paragraph>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { Col, Input, Modal, Row } from 'antd';\r\nimport { EndpointInfo } from '../utils/types';\r\n\r\nexport default function CustomClusterEndpointDialog({\r\n  visible,\r\n  testingConnection,\r\n  onAddCustomEndpoint,\r\n  onClose,\r\n}: {\r\n  visible: boolean;\r\n  testingConnection: boolean;\r\n  onAddCustomEndpoint: (info: EndpointInfo) => void;\r\n  onClose?: () => void;\r\n}) {\r\n  const [customEndpoint, setCustomEndpoint] = useState('');\r\n  const [customEndpointName, setCustomEndpointName] = useState('');\r\n\r\n  const onSubmit = () => {\r\n    const fullEndpoint = 'https://' + customEndpoint;\r\n    const params = {\r\n      name: customEndpointName,\r\n      endpoint: fullEndpoint,\r\n      custom: true,\r\n    };\r\n    onAddCustomEndpoint(params);\r\n    onDoClose();\r\n  };\r\n  const onDoClose = () => {\r\n    setCustomEndpoint('');\r\n    setCustomEndpointName('');\r\n    onClose && onClose();\r\n  };\r\n  const canSubmit = customEndpoint !== '' && customEndpointName !== '';\r\n\r\n  return (\r\n    <Modal\r\n      title={'Add custom endpoint'}\r\n      visible={visible}\r\n      onOk={onSubmit}\r\n      okText={'Add'}\r\n      onCancel={onDoClose}\r\n      okButtonProps={{ disabled: !canSubmit, loading: testingConnection }}\r\n    >\r\n      <Row style={{ marginBottom: 8 }}>\r\n        <Col span={24}>\r\n          <Input\r\n            placeholder=\"Cluster Name\"\r\n            value={customEndpointName}\r\n            onChange={(e) => setCustomEndpointName(e.target.value)}\r\n          />\r\n        </Col>\r\n      </Row>\r\n      <Row style={{ marginBottom: 8 }}>\r\n        <Col span={24}>\r\n          <Input\r\n            placeholder=\"Cluster Endpoint\"\r\n            value={customEndpoint}\r\n            addonBefore={'https://'}\r\n            onChange={(e) => setCustomEndpoint(e.target.value)}\r\n          />\r\n        </Col>\r\n      </Row>\r\n    </Modal>\r\n  );\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport { Select, Typography } from 'antd';\r\nimport { SearchOutlined } from '@ant-design/icons';\r\nimport { TOKEN_MINTS } from '@project-serum/serum';\r\nimport apps from '@project-serum/awesome-serum';\r\n\r\nconst { Option } = Select;\r\n\r\nconst appsAndTokens = apps.concat(\r\n  TOKEN_MINTS.map((mint) => {\r\n    return {\r\n      name: `${mint.name} SPL`,\r\n      url: `https://solscan.io/address/${mint.address.toBase58()}`,\r\n      description: `${mint.name} SPL token`,\r\n      icon: '',\r\n      tags: [\r\n        'token',\r\n        'blockchain',\r\n        'solana',\r\n        'spl',\r\n        'solana',\r\n        mint.address.toBase58(),\r\n      ],\r\n    };\r\n  }),\r\n);\r\n\r\ninterface App {\r\n  name: string;\r\n  url: string;\r\n  description: string;\r\n  tags: string[];\r\n}\r\n\r\nexport default function AppSearch(props) {\r\n  const [searchMatches, setSearchMatches] = useState<App[]>([]);\r\n  const [searchValue, setSearchValue] = useState<string | undefined>(undefined);\r\n\r\n  const matchApp = (searchString: string, app: App) => {\r\n    const lowerSearchStr = searchString.toLowerCase();\r\n    return (\r\n      app.name.toLowerCase().includes(lowerSearchStr) ||\r\n      app.tags.some(\r\n        (tag) =>\r\n          tag.toLowerCase().includes(lowerSearchStr) ||\r\n          lowerSearchStr.includes(tag.toLowerCase()),\r\n      )\r\n    );\r\n  };\r\n\r\n  const handleSearch = (value) => {\r\n    setSearchValue(value === '' ? undefined : value);\r\n    const filteredApps = appsAndTokens.filter((app) => matchApp(value, app));\r\n    setSearchMatches(filteredApps);\r\n  };\r\n\r\n  const handleSelect = (value, option) => {\r\n    window.open(option.href, '_blank');\r\n    handleClear();\r\n  };\r\n\r\n  const handleClear = () => {\r\n    setSearchMatches([]);\r\n    setSearchValue(undefined);\r\n  };\r\n\r\n  const options = searchMatches.map((d) => (\r\n    <Option key={d.name} value={d.name} href={d.url}>\r\n      <h3>{d.name}</h3>\r\n      <Typography.Text type=\"secondary\">\r\n        {d.url.replace('https://', '')}\r\n      </Typography.Text>\r\n    </Option>\r\n  ));\r\n\r\n  const ref = useRef<any>();\r\n  return (\r\n    <Select\r\n      ref={ref}\r\n      showSearch\r\n      allowClear\r\n      value={searchValue}\r\n      placeholder={\r\n        props.focussed || props.focussed === undefined\r\n          ? 'Search for dex, swap, wallet, token...'\r\n          : ''\r\n      }\r\n      onSearch={handleSearch}\r\n      onClear={handleClear}\r\n      onSelect={handleSelect}\r\n      onFocus={props.onFocus}\r\n      onBlur={() => {\r\n        props.onBlur();\r\n        handleClear();\r\n      }}\r\n      notFoundContent={null} // todo: make this search history\r\n      style={{\r\n        width: props.width || '300px',\r\n        transition: props.focussed ? 'width 0.1s ease 0.1s' : '',\r\n      }}\r\n      dropdownStyle={{\r\n        width: props.width || '300px',\r\n      }}\r\n      dropdownMatchSelectWidth={false}\r\n      suffixIcon={\r\n        <SearchOutlined onClick={() => ref.current && ref.current.focus()} />\r\n      }\r\n      filterOption={false}\r\n    >\r\n      {options}\r\n    </Select>\r\n  );\r\n}\r\n","import {\r\n  InfoCircleOutlined,\r\n  PlusCircleOutlined,\r\n  SettingOutlined,\r\n} from '@ant-design/icons';\r\nimport { Button, Col, Menu, Popover, Row, Select } from 'antd';\r\nimport React, { useCallback, useEffect, useState } from 'react';\r\nimport { useHistory, useLocation } from 'react-router-dom';\r\nimport logo from '../assets/logo.png';\r\nimport styled from 'styled-components';\r\nimport { useWallet } from '../utils/wallet';\r\nimport { ENDPOINTS, useConnectionConfig } from '../utils/connection';\r\nimport Settings from './Settings';\r\nimport CustomClusterEndpointDialog from './CustomClusterEndpointDialog';\r\nimport { EndpointInfo } from '../utils/types';\r\nimport { notify } from '../utils/notifications';\r\nimport { Connection } from '@solana/web3.js';\r\nimport WalletConnect from './WalletConnect';\r\nimport AppSearch from './AppSearch';\r\nimport { getTradePageUrl } from '../utils/markets';\r\n\r\nconst Wrapper = styled.div`\r\n  background-color: #191919;\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: flex-end;\r\n  padding: 0px 30px;\r\n  flex-wrap: wrap;\r\n`;\r\nconst LogoWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  color: #3ea018;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  img {\r\n    height: 30px;\r\n    margin-right: 8px;\r\n  }\r\n`;\r\n\r\nconst EXTERNAL_LINKS = {\r\n  '/learn': 'https://docs.projectserum.com/trade-on-serum-dex/trade-on-serum-dex-1',\r\n  '/add-market': 'https://serum-academy.com/en/add-market/',\r\n  '/wallet-support': 'https://serum-academy.com/en/wallet-support',\r\n  '/dex-list': 'https://serum-academy.com/en/dex-list/',\r\n  '/developer-resources': 'https://serum-academy.com/en/developer-resources/',\r\n  '/explorer': 'https://solscan.io',\r\n  '/srm-faq': 'https://projectserum.com/srm-faq',\r\n};\r\n\r\nexport default function TopBar() {\r\n  const { connected, wallet } = useWallet();\r\n  const {\r\n    endpoint,\r\n    endpointInfo,\r\n    setEndpoint,\r\n    availableEndpoints,\r\n    setCustomEndpoints,\r\n  } = useConnectionConfig();\r\n  const [addEndpointVisible, setAddEndpointVisible] = useState(false);\r\n  const [testingConnection, setTestingConnection] = useState(false);\r\n  const location = useLocation();\r\n  const history = useHistory();\r\n  const [searchFocussed, setSearchFocussed] = useState(false);\r\n\r\n  const handleClick = useCallback(\r\n    (e) => {\r\n      if (!(e.key in EXTERNAL_LINKS)) {\r\n        history.push(e.key);\r\n      }\r\n    },\r\n    [history],\r\n  );\r\n\r\n  const onAddCustomEndpoint = (info: EndpointInfo) => {\r\n    const existingEndpoint = availableEndpoints.some(\r\n      (e) => e.endpoint === info.endpoint,\r\n    );\r\n    if (existingEndpoint) {\r\n      notify({\r\n        message: `An endpoint with the given url already exists`,\r\n        type: 'error',\r\n      });\r\n      return;\r\n    }\r\n\r\n    const handleError = (e) => {\r\n      console.log(`Connection to ${info.endpoint} failed: ${e}`);\r\n      notify({\r\n        message: `Failed to connect to ${info.endpoint}`,\r\n        type: 'error',\r\n      });\r\n    };\r\n\r\n    try {\r\n      const connection = new Connection(info.endpoint, 'recent');\r\n      connection\r\n        .getBlockTime(0)\r\n        .then(() => {\r\n          setTestingConnection(true);\r\n          console.log(`testing connection to ${info.endpoint}`);\r\n          const newCustomEndpoints = [\r\n            ...availableEndpoints.filter((e) => e.custom),\r\n            info,\r\n          ];\r\n          setEndpoint(info.endpoint);\r\n          setCustomEndpoints(newCustomEndpoints);\r\n        })\r\n        .catch(handleError);\r\n    } catch (e) {\r\n      handleError(e);\r\n    } finally {\r\n      setTestingConnection(false);\r\n    }\r\n  };\r\n\r\n  const endpointInfoCustom = endpointInfo && endpointInfo.custom;\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      if (endpointInfoCustom) {\r\n        setEndpoint(ENDPOINTS[0].endpoint);\r\n      }\r\n    };\r\n    window.addEventListener('beforeunload', handler);\r\n    return () => window.removeEventListener('beforeunload', handler);\r\n  }, [endpointInfoCustom, setEndpoint]);\r\n\r\n  const tradePageUrl = location.pathname.startsWith('/market/')\r\n    ? location.pathname\r\n    : getTradePageUrl();\r\n\r\n  return (\r\n    <>\r\n      <CustomClusterEndpointDialog\r\n        visible={addEndpointVisible}\r\n        testingConnection={testingConnection}\r\n        onAddCustomEndpoint={onAddCustomEndpoint}\r\n        onClose={() => setAddEndpointVisible(false)}\r\n      />\r\n      <Wrapper>\r\n        <LogoWrapper onClick={() => history.push(tradePageUrl)}>\r\n          <img src={logo} alt=\"\" />\r\n          {'SeeleFinance DEX'}\r\n        </LogoWrapper>\r\n        <Menu\r\n          mode=\"horizontal\"\r\n          onClick={handleClick}\r\n          selectedKeys={[location.pathname]}\r\n          style={{\r\n            borderBottom: 'none',\r\n            backgroundColor: 'transparent',\r\n            display: 'flex',\r\n            alignItems: 'flex-end',\r\n            flex: 1,\r\n          }}\r\n        >\r\n          <Menu.Item key={tradePageUrl} style={{ color: 'white'}}>\r\n           TRADE\r\n          </Menu.Item>\r\n          {connected && (!searchFocussed || location.pathname === '/balances') && (\r\n            <Menu.Item key=\"/balances\" style={{ margin: 'white' }}>\r\n              BALANCES\r\n            </Menu.Item>\r\n          )}\r\n          {connected && (!searchFocussed || location.pathname === '/orders') && (\r\n            <Menu.Item key=\"/orders\" style={{ margin: 'white' }}>\r\n              ORDERS\r\n            </Menu.Item>\r\n          )}\r\n          {/* {connected && (!searchFocussed || location.pathname === '/convert') && (\r\n            <Menu.Item key=\"/convert\" style={{ margin: '0 10px' }}>\r\n              CONVERT\r\n            </Menu.Item>\r\n          )} */}\r\n          {/* {(!searchFocussed || location.pathname === '/list-new-market') && (\r\n            <Menu.Item key=\"/list-new-market\" style={{ margin: '0 10px' }}>\r\n              ADD MARKET\r\n            </Menu.Item>\r\n          )} */}\r\n          {!searchFocussed && (\r\n            <Menu.SubMenu\r\n              // title=\"LEARN\"\r\n              // onTitleClick={() =>\r\n              //   window.open(EXTERNAL_LINKS['/learn'], '_blank')\r\n              // }\r\n              // style={{ margin: '0 0px 0 10px' }}\r\n            >\r\n              <Menu.Item key=\"/add-market\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/add-market']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Adding a market\r\n                </a>\r\n              </Menu.Item>\r\n              <Menu.Item key=\"/wallet-support\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/wallet-support']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Supported wallets\r\n                </a>\r\n              </Menu.Item>\r\n              <Menu.Item key=\"/dex-list\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/dex-list']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  DEX list\r\n                </a>\r\n              </Menu.Item>\r\n              <Menu.Item key=\"/developer-resources\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/developer-resources']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Developer resources\r\n                </a>\r\n              </Menu.Item>\r\n              <Menu.Item key=\"/explorer\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/explorer']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  Solana block explorer\r\n                </a>\r\n              </Menu.Item>\r\n              <Menu.Item key=\"/srm-faq\">\r\n                <a\r\n                  href={EXTERNAL_LINKS['/srm-faq']}\r\n                  target=\"_blank\"\r\n                  rel=\"noopener noreferrer\"\r\n                >\r\n                  SRM FAQ\r\n                </a>\r\n              </Menu.Item>\r\n            </Menu.SubMenu>\r\n          )}\r\n        </Menu>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            paddingRight: 5,\r\n          }}\r\n        >\r\n          <AppSearch\r\n            onFocus={() => setSearchFocussed(true)}\r\n            onBlur={() => setSearchFocussed(false)}\r\n            focussed={searchFocussed}\r\n            width={searchFocussed ? '350px' : '35px'}\r\n          />\r\n        </div>\r\n        <div>\r\n          <Row\r\n            align=\"middle\"\r\n            style={{ paddingLeft: 5, paddingRight: 5 }}\r\n            gutter={16}\r\n          >\r\n            <Col>\r\n              <PlusCircleOutlined\r\n                style={{ color: '#3ea018' }}\r\n                onClick={() => setAddEndpointVisible(true)}\r\n              />\r\n            </Col>\r\n            <Col>\r\n              <Popover\r\n                content={endpoint}\r\n                placement=\"bottomRight\"\r\n                title=\"URL\"\r\n                trigger=\"hover\"\r\n              >\r\n                <InfoCircleOutlined style={{ color: '#3ea018' }} />\r\n              </Popover>\r\n            </Col>\r\n            <Col>\r\n              <Select\r\n                onSelect={setEndpoint}\r\n                value={endpoint}\r\n                style={{ marginRight: 8, width: '150px' }}\r\n              >\r\n                {availableEndpoints.map(({ name, endpoint }) => (\r\n                  <Select.Option value={endpoint} key={endpoint}>\r\n                    {name}\r\n                  </Select.Option>\r\n                ))}\r\n              </Select>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n        {connected && (\r\n          <div>\r\n            <Popover\r\n              content={<Settings autoApprove={wallet?.autoApprove} />}\r\n              placement=\"bottomRight\"\r\n              title=\"Settings\"\r\n              trigger=\"click\"\r\n            >\r\n              <Button style={{ marginRight: 8 }}>\r\n                <SettingOutlined />\r\n                Settings\r\n              </Button>\r\n            </Popover>\r\n          </div>\r\n        )}\r\n        <div>\r\n          <WalletConnect />\r\n        </div>\r\n      </Wrapper>\r\n    </>\r\n  );\r\n}\r\n","import { Layout } from 'antd';\r\nimport React, { useEffect } from 'react';\r\nimport TopBar from './TopBar';\r\nimport { useReferrer } from '../utils/referrer';\r\nimport queryString from 'query-string';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { notify } from '../utils/notifications';\r\nconst { Header, Content } = Layout;\r\n\r\nexport default function BasicLayout({ children }) {\r\n  const { refCode, setRefCode, allowRefLink } = useReferrer();\r\n  const { search } = useLocation();\r\n  const parsed = queryString.parse(search);\r\n\r\n  useEffect(() => {\r\n    if (!!parsed.refCode && parsed.refCode !== refCode && allowRefLink) {\r\n      notify({ message: `New referrer ${parsed.refCode} added` });\r\n      setRefCode(parsed.refCode);\r\n    }\r\n  }, [parsed, refCode, setRefCode, allowRefLink]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Layout\r\n        style={{ display: 'flex', minHeight: '100vh', flexDirection: 'column' }}\r\n      >\r\n        <Header style={{ padding: 0, minHeight: 0, height: 'unset'}}>\r\n          <TopBar />\r\n        </Header>\r\n        <Content style={{ flex: 1}}>{children}</Content>\r\n      </Layout>\r\n    </React.Fragment>\r\n  );\r\n}\r\n","import { HashRouter, Route, Switch, Redirect } from 'react-router-dom';\r\nimport TradePage from './pages/TradePage';\r\nimport OpenOrdersPage from './pages/OpenOrdersPage';\r\nimport React from 'react';\r\nimport BalancesPage from './pages/BalancesPage';\r\nimport BasicLayout from './components/BasicLayout';\r\nimport { getTradePageUrl } from './utils/markets';\r\n\r\nexport function Routes() {\r\n  return (\r\n    <>\r\n      <HashRouter basename={'/'}>\r\n        <BasicLayout>\r\n          <Switch>\r\n            <Route exact path=\"/\">\r\n              <Redirect to={getTradePageUrl()} />\r\n            </Route>\r\n            <Route exact path=\"/market/:marketAddress\">\r\n              <TradePage />\r\n            </Route>\r\n            <Route exact path=\"/orders\" component={OpenOrdersPage} />\r\n            <Route exact path=\"/balances\" component={BalancesPage} />\r\n          </Switch>\r\n        </BasicLayout>\r\n      </HashRouter>\r\n    </>\r\n  );\r\n}\r\n","import React, { Suspense } from 'react';\r\nimport './App.less';\r\nimport { ConnectionProvider } from './utils/connection';\r\nimport { WalletProvider } from './utils/wallet';\r\nimport { GlobalStyle } from './global_style';\r\nimport { Spin } from 'antd';\r\nimport ErrorBoundary from './components/ErrorBoundary';\r\nimport { Routes } from './routes';\r\nimport { PreferencesProvider } from './utils/preferences';\r\nimport { ReferrerProvider } from './utils/referrer';\r\n\r\nexport default function App() {\r\n  return (\r\n    <Suspense fallback={() => <Spin size=\"large\" />}>\r\n      <GlobalStyle />\r\n      <ErrorBoundary>\r\n        <ConnectionProvider>\r\n          <ReferrerProvider>\r\n            <WalletProvider>\r\n              <PreferencesProvider>\r\n                <Suspense fallback={() => <Spin size=\"large\" />}>\r\n                  <Routes />\r\n                </Suspense>\r\n              </PreferencesProvider>\r\n            </WalletProvider>\r\n          </ReferrerProvider>\r\n        </ConnectionProvider>\r\n      </ErrorBoundary>\r\n    </Suspense>\r\n  );\r\n}\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\r\n    ),\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then((registration) => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then((response) => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then((registration) => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.',\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then((registration) => {\r\n        registration.unregister();\r\n      })\r\n      .catch((error) => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root'),\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}